{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2024/11/9/tanstack-table-row-selection/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/66f339c632404ac5bc9418e2b9a4eeb9/d71bc/img.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRrgAAABXRUJQVlA4IKwAAAAwBQCdASoUABQAPtFgqU+oJSOiKAgBABoJZQDCgYs2d8zFj0efXJGzrtnEuj91wD0qAAD+6ydJUyNfT9+zJMWl0jU8sY+FJSqgmWFBcIUhVdHCYzO/OWZxMisktV17YCN5ulsHoijfs845HlGF8qdX5L/8V5aubH31S3i6XziJNlnpOGdaJdgQrUCtNKM3q5zM5Gf+oXph6CvWipW8YKjpHF+vgztai0qUG7AA'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/66f339c632404ac5bc9418e2b9a4eeb9/a59e9/img.webp 192w,\n/static/66f339c632404ac5bc9418e2b9a4eeb9/0ca9f/img.webp 384w,\n/static/66f339c632404ac5bc9418e2b9a4eeb9/dc9b9/img.webp 768w,\n/static/66f339c632404ac5bc9418e2b9a4eeb9/d71bc/img.webp 1024w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/66f339c632404ac5bc9418e2b9a4eeb9/a59e9/img.webp 192w,\n/static/66f339c632404ac5bc9418e2b9a4eeb9/0ca9f/img.webp 384w,\n/static/66f339c632404ac5bc9418e2b9a4eeb9/dc9b9/img.webp 768w,\n/static/66f339c632404ac5bc9418e2b9a4eeb9/d71bc/img.webp 1024w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/66f339c632404ac5bc9418e2b9a4eeb9/dc9b9/img.webp\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><a href=\"https://geuni620.github.io/blog/2024/9/28/tanstack-table-row-selection/\" target=\"_blank\" rel=\"nofollow\">이전 글</a>을 살펴보다가, 추가로 궁금한 점이 생겼다.<br>\ntanstack-table에선 체크박스의 상태를 관리하기 위해 rowSelection이라는 상태를 만들고 적용하는데, 일반적으로 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>rowSelection<span class=\"token punctuation\">,</span> setRowSelection<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 여기에 onChange와 state를 저장해주면 된다.</span>\n    onRowSelectionChange<span class=\"token operator\">:</span> setRowSelection<span class=\"token punctuation\">,</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      rowSelection<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>setRowSelection은 setState인데, 이를 함수로 받아서 사용해야하는 경우도 있다.<br>\n예를들면, 이전 글에서 예시로 들었던, <a href=\"https://geuni620.github.io/blog/2024/9/28/tanstack-table-row-selection/#1-onrowselectionchange\" target=\"_blank\" rel=\"nofollow\">onRowSelectionChangeHandler</a>를 만들어서, setRowSelection을 업데이트하는 것이다.</p>\n<br/>\n<p>나의 경우 최초엔, 다음과 같이 반영하려했다.<br>\n단순 rowSelection을 넘겨받아서, setState에 담아주겠거니 생각했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onRowSelectionChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>rowSelection<span class=\"token operator\">:</span> RowSelectionState<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setRowSelection</span><span class=\"token punctuation\">(</span>rowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n\n    onRowSelectionChange<span class=\"token operator\">:</span> onRowSelectionChange<span class=\"token punctuation\">,</span> <span class=\"token comment\">// here 🙋‍♂️!!!</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      rowSelection\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>하지만 이렇게 했을 땐, onRowSelectionChange에서 타입에러가 발생한다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5e645adef4a855049d9e3b04a9646b9c/bb7f4/ts2322-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACJ0lEQVQoz11Sy27bMBDUv6SJH4ltSaQoPkSKEvWyZCdB2h6CoGjRngr0/69TcJ0ETQ+DXa6o4ezsJkJU2AqD29LiVtdYiwrXWYnrXBJuXkG1//ApFR/O8V6iXQCrPFJlwWyD0vdIpQW3LVLlsGUSO2FQ+B6Z8RAugNuGctMvKNsRZTMit4FIkxWTWL8hl9gwRdgW+pLzmBvspMNd7CJ2IyrCVlTYFIaw5vpCGImY8aRqLy1y09A5045U51ULXvfgdQfRDISoNipbMfWh7UiaxCTV9aVt48FcR+1eCB1yU9N3GY6QYSJCFY7vit78jSoPpkESjd9yDeU7lK6FDSPFKkxQUVGs9UfodkRhW/CqAY++uw5Xh+J9OPGBtGqRxBdWubwokfYVFfZlBWZbyGagKHxPPt9kJd2PiqK3G66xZgp30mKnHJKrA8dVKsi/XaHIP+l7UmS6iaa8yUtkuqZpx3iQFlnVkJepDdhpD+577HWNhDcD9tqjaEYymrkA2R3hlkcIP4H5HjyuRT2gaCdkrkNe94Q1M8iFBi819qW5tOyXR1TjAt0vcPMDzHiCGU5wx3uoMNMjzXxPrdvpTGcVRph+RmE7qMqDlQa3haY1Sur5EapboLoZZjhD9zPcdKYfbCTvZ9QxdhNkHEzd0fLrMBJUmJC7DoUfaI2S8/MvTF9e8PXnH3z+/htuecLp+RvOLz/QPjzBHs+Qwwk3TNGKrF7jv4i1t/pfmZWRnZBvqp8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5e645adef4a855049d9e3b04a9646b9c/a59e9/ts2322-error.webp 192w,\n/static/5e645adef4a855049d9e3b04a9646b9c/0ca9f/ts2322-error.webp 384w,\n/static/5e645adef4a855049d9e3b04a9646b9c/dc9b9/ts2322-error.webp 768w,\n/static/5e645adef4a855049d9e3b04a9646b9c/e2c2f/ts2322-error.webp 1152w,\n/static/5e645adef4a855049d9e3b04a9646b9c/d36b8/ts2322-error.webp 1192w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5e645adef4a855049d9e3b04a9646b9c/3b721/ts2322-error.png 192w,\n/static/5e645adef4a855049d9e3b04a9646b9c/66595/ts2322-error.png 384w,\n/static/5e645adef4a855049d9e3b04a9646b9c/fe486/ts2322-error.png 768w,\n/static/5e645adef4a855049d9e3b04a9646b9c/d2d74/ts2322-error.png 1152w,\n/static/5e645adef4a855049d9e3b04a9646b9c/bb7f4/ts2322-error.png 1192w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5e645adef4a855049d9e3b04a9646b9c/fe486/ts2322-error.png\"\n            alt=\"ts2322 error\"\n            title=\"ts2322 error\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그럼 onRowSelectionChange를 통해 인자로 받는건 뭘까?</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onRowSelectionChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>rowSelection<span class=\"token operator\">:</span> RowSelectionState<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rowSelection'</span><span class=\"token punctuation\">,</span> rowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">setRowSelection</span><span class=\"token punctuation\">(</span>rowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// rowSelection log</span>\n  <span class=\"token function\">rowSelection</span> <span class=\"token punctuation\">(</span>old<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> _opts$selectChildren<span class=\"token punctuation\">;</span>\n      value <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> value <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span> <span class=\"token operator\">?</span> value <span class=\"token operator\">:</span> <span class=\"token operator\">!</span>isSelected<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span><span class=\"token function\">getCanSelect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> isSelected <span class=\"token operator\">===</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> old<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<p>rowSelection에 관한 어떤 로그가 찍히는데 아직은 이게 무엇을 의미하는지 잘 모르겠다. 😭</p>\n<br/>\n<p><a href=\"https://tanstack.com/table/v8/docs/api/features/row-selection#onrowselectionchange\" target=\"_blank\" rel=\"nofollow\">onRowSelectionChange</a>에 관해 공식문서에선 다음과 같이 설명되어있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">onRowSelectionChange<span class=\"token operator\">?</span><span class=\"token operator\">:</span> OnChangeFn<span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span>\n\n<span class=\"token comment\">// If provided, this function will be called with an updaterFn when state.rowSelection changes.</span>\n<span class=\"token comment\">// 이 함수가 제공되면 state.rowSelection이 변경될 때 updaterFn과 함께 호출됩니다.</span>\n\n<span class=\"token comment\">// This overrides the default internal state management, so you will need to persist the state change either fully or partially outside of the table.</span>\n<span class=\"token comment\">// 이 함수는 기본 내부 상태 관리를 재정의하므로 테이블 외부에서 상태 변경을 완전히 또는 부분적으로 유지해야 합니다.</span></code></pre></div>\n<p>현재 이해하기론, onChangeFn이라는 함수가 존재하고, 이를 통해 Tanstack table 내부에서 상태를 업데이트한 뒤, 외부에서 주입받는 setState(=setRowSelection)도 업데이트 시키는 것 같다.<br>\n그럼 내부코드에서 onChangeFn부터 찾아보면 될 것 같았다.</p>\n<br/>\n<hr>\n<h3 id=\"usereacttable\" style=\"position:relative;\"><a href=\"#usereacttable\" aria-label=\"usereacttable permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useReactTable</h3>\n<blockquote>\n<p>사전에 내가 이해하고 있는 부분은,<br>\nTanstack-table은 여러 라이브러리를 지원하는데(react, vue, angular, svelte 등등) core를 주입하는 방식으로 이를 가능하게 한다는 점이다.</p>\n<p>예를들어 core를 구현해놓은 상태에서, 이를 react에 주입하는 것이다.<br>\n그럼 React에서 사용할 수 있는 react-table이 된다.</p>\n</blockquote>\n<br/>\n<p>가장 먼저, Tanstack-table의 useReactTable이 어떻게 만들어지는지부터 살펴봤다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// https://github.com/TanStack/table/blob/6b4d616dd7c8917616eb4fecaf09dda7030fd115/packages/react-table/src/index.tsx#L57C1-L94C2</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">useReactTable</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TData <span class=\"token keyword\">extends</span> RowData<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  options<span class=\"token operator\">:</span> TableOptions<span class=\"token operator\">&lt;</span>TData<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Compose in the generic options to the user options</span>\n  <span class=\"token keyword\">const</span> resolvedOptions<span class=\"token operator\">:</span> TableOptionsResolved<span class=\"token operator\">&lt;</span>TData<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Dummy state</span>\n    <span class=\"token function-variable function\">onStateChange</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// noop</span>\n    renderFallbackValue<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>options<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token comment\">// Create a new table and store it in state</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>tableRef<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    current<span class=\"token operator\">:</span> <span class=\"token generic-function\"><span class=\"token function\">createTable</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TData<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>resolvedOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// By default, manage table state here using the table's initial state</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">,</span> setState<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> tableRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>initialState<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// Compose the default state above with any user state. This will allow the user</span>\n  <span class=\"token comment\">// to only control a subset of the state if desired.</span>\n  tableRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">setOptions</span><span class=\"token punctuation\">(</span>prev <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token operator\">...</span>prev<span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>options<span class=\"token punctuation\">,</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">...</span>options<span class=\"token punctuation\">.</span>state<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// Similarly, we'll maintain both our internal state and any user-provided</span>\n    <span class=\"token comment\">// state.</span>\n    <span class=\"token function-variable function\">onStateChange</span><span class=\"token operator\">:</span> updater <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setState</span><span class=\"token punctuation\">(</span>updater<span class=\"token punctuation\">)</span>\n      options<span class=\"token punctuation\">.</span>onStateChange<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span>updater<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> tableRef<span class=\"token punctuation\">.</span>current\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위에서 언급했듯이 table-core를 만들어서 useReactTable에 주입하는 과정이다.<br>\n그래서 폴더구조도 이게 끝이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">react-table/\n├── src/\n│   └── index.tsx // here 🙋‍♂️!!!\n├── tests/\n├── package.json\n├── rollup.config.mjs\n├── tsconfig.json\n└── vitest.config.ts</code></pre></div>\n<br/>\n<p>소스코드를 확인해보면, 총 2개의 useState가 보인다.\n하나는 <code class=\"language-text\">tableRef</code>, 다른 하나는 <code class=\"language-text\">state</code>이다.</p>\n<p>tableRef는 상태명 그대로, table의 인스턴스를 관리하는 것이다.<br>\n이 부분이 table-core를 통해 만들어진 core가 react로 주입되는 부분으로 보인다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 여기에 onChange와 state를 저장해주면 된다.</span>\n    onRowSelectionChange<span class=\"token operator\">:</span> setRowSelection<span class=\"token punctuation\">,</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      rowSelection<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>다른 하나는 state인데, tanstack-table의 초기값을 지정하고 싶으면, useReactTable 내 <a href=\"https://tanstack.com/table/latest/docs/api/core/table#initialstate\" target=\"_blank\" rel=\"nofollow\">initialState</a>를 등록할 수 있다. 즉 <strong>초기값의 지정</strong>과, <strong>table 인스턴스 내부에서 관리하는 state</strong>로 보인다.</p>\n<p>그리고, options.state도 보이는데, 이게 rowSelection과 같은 외부에서 주입받은 state를 관리하는 것으로 보인다.<br>\nonStateChange를 살펴보면, updater를 인자로 받아서, setState, options.onStateChange?.(updater)로 넘겨주는데, 각각 <strong>table 내부에서 관리하는 state</strong>와 <strong>사용자에 의해 주입된 외부 state</strong>이다.</p>\n<p>table 인스턴스의 state 덕분에 <code class=\"language-text\">table.getState().rowSelection</code>을 확인하면 state를 확인할 수 있었던 것이다.<br>\ncc. <a href=\"https://tanstack.com/table/v8/docs/guide/row-selection#access-row-selection-state\" target=\"_blank\" rel=\"nofollow\">Access Row Selection State</a></p>\n<br/>\n<hr>\n<h3 id=\"table-core\" style=\"position:relative;\"><a href=\"#table-core\" aria-label=\"table core permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>table-core</h3>\n<p>나는 계속 rowSelection의 업데이트를 위해 onRowSelectionChange를 살펴보는 중이다.<br>\n눈에 띄는게, createTable함수이다. 이는 table-core에 정의되어있다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">table-core/\n├── src/\n│   ├── core/\n│   │   ├── cell.ts\n│   │   ├── column.ts\n│   │   ├── headers.ts\n│   │   ├── row.ts\n│   │   └── table.ts // here 🙋‍♂️!!!\n│   ├── features/ ...\n│   ├── utils/ ...\n├── tests/ ...\n├── package.json\n├── rollup.config.mjs\n├── tsconfig.json\n└── vitest.config.ts</code></pre></div>\n<p>core의 table을 살펴보면, createTable을 만날 수 있다.<br>\n소스코드를 내리다가, builtInFeatures 변수가 보인다.<br>\n그리고 그 내부에 RowSelection 기능이 추가되어있는 것을 확인했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// https://github.com/TanStack/table/blob/6b4d616dd7c8917616eb4fecaf09dda7030fd115/packages/table-core/src/core/table.ts#L41C1-L57C11</span>\n<span class=\"token keyword\">const</span> builtInFeatures <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  Headers<span class=\"token punctuation\">,</span>\n  ColumnVisibility<span class=\"token punctuation\">,</span>\n  ColumnOrdering<span class=\"token punctuation\">,</span>\n  ColumnPinning<span class=\"token punctuation\">,</span>\n  ColumnFaceting<span class=\"token punctuation\">,</span>\n  ColumnFiltering<span class=\"token punctuation\">,</span>\n  GlobalFaceting<span class=\"token punctuation\">,</span> <span class=\"token comment\">//depends on ColumnFaceting</span>\n  GlobalFiltering<span class=\"token punctuation\">,</span> <span class=\"token comment\">//depends on ColumnFiltering</span>\n  RowSorting<span class=\"token punctuation\">,</span>\n  ColumnGrouping<span class=\"token punctuation\">,</span> <span class=\"token comment\">//depends on RowSorting</span>\n  RowExpanding<span class=\"token punctuation\">,</span>\n  RowPagination<span class=\"token punctuation\">,</span>\n  RowPinning<span class=\"token punctuation\">,</span>\n  RowSelection<span class=\"token punctuation\">,</span> <span class=\"token comment\">// here 🙋‍♂️!!!</span>\n  ColumnSizing<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span></code></pre></div>\n<p>나의 목표는 onRowSelectionChange가 인자로 받는 onChnageFn이 궁금하기 때문에, 이 부분부터 살펴봤다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// https://github.com/TanStack/table/blob/6b4d616dd7c8917616eb4fecaf09dda7030fd115/packages/table-core/src/features/RowSelection.ts#L199-L219</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> RowSelection<span class=\"token operator\">:</span> TableFeature <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  getInitialState<span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>state<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> RowSelectionTableState <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      rowSelection<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n\n  getDefaultOptions<span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TData</span></span> <span class=\"token attr-name\">extends</span> <span class=\"token attr-name\">RowData</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">(\n    table: Table&lt;TData>\n  ): RowSelectionOptions&lt;TData> => </span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// makeStateUpdater는 여기 링크를 참고하면 된다.</span>\n      <span class=\"token comment\">// https://github.com/TanStack/table/blob/6b4d616dd7c8917616eb4fecaf09dda7030fd115/packages/table-core/src/utils.ts#L91C1-L103C2</span>\n      onRowSelectionChange<span class=\"token operator\">:</span> <span class=\"token function\">makeStateUpdater</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rowSelection'</span><span class=\"token punctuation\">,</span> table<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      enableRowSelection<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      enableMultiRowSelection<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      enableSubRowSelection<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// enableGroupingRowSelection: false,</span>\n      <span class=\"token comment\">// isAdditiveSelectEvent: (e: unknown) => !!e.metaKey,</span>\n      <span class=\"token comment\">// isInclusiveSelectEvent: (e: unknown) => !!e.shiftKey,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token plain-text\">,\n\n  createTable: </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TData</span></span> <span class=\"token attr-name\">extends</span> <span class=\"token attr-name\">RowData</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">(table: Table&lt;TData>): void => </span><span class=\"token punctuation\">{</span>\n    table<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setRowSelection</span> <span class=\"token operator\">=</span> updater <span class=\"token operator\">=></span>\n      table<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>onRowSelectionChange<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span>updater<span class=\"token punctuation\">)</span>\n    table<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">resetRowSelection</span> <span class=\"token operator\">=</span> defaultState <span class=\"token operator\">=></span>\n      table<span class=\"token punctuation\">.</span><span class=\"token function\">setRowSelection</span><span class=\"token punctuation\">(</span>\n        defaultState <span class=\"token operator\">?</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">:</span> table<span class=\"token punctuation\">.</span>initialState<span class=\"token punctuation\">.</span>rowSelection <span class=\"token operator\">??</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span><span class=\"token plain-text\">\n\n  //...\n}</span></code></pre></div>\n<p><code class=\"language-text\">onRowSelectionChange</code>함수가 사용된 3개의 메서드만 추려봤다.<br>\n(<code class=\"language-text\">getInitialState</code>, <code class=\"language-text\">getDefaultOptions</code>, <code class=\"language-text\">createTable</code>)</p>\n<p>먼저 getDefaultOptions가 보이는데, onRowSelectionChange에 <code class=\"language-text\">makeStateUpdater</code>가 보인다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// https://github.com/TanStack/table/blob/6b4d616dd7c8917616eb4fecaf09dda7030fd115/packages/table-core/src/utils.ts#L81C1-L85C2</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">functionalUpdate</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>updater<span class=\"token operator\">:</span> Updater<span class=\"token operator\">&lt;</span><span class=\"token constant\">T</span><span class=\"token operator\">></span><span class=\"token punctuation\">,</span> input<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token constant\">T</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">typeof</span> updater <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span>\n    <span class=\"token operator\">?</span> <span class=\"token punctuation\">(</span>updater <span class=\"token keyword\">as</span> <span class=\"token punctuation\">(</span>input<span class=\"token operator\">:</span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token constant\">T</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">:</span> updater<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// https://github.com/TanStack/table/blob/6b4d616dd7c8917616eb4fecaf09dda7030fd115/packages/table-core/src/utils.ts#L91C1-L103C2</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">makeStateUpdater</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token constant\">K</span> <span class=\"token keyword\">extends</span> <span class=\"token keyword\">keyof</span> TableState<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  key<span class=\"token operator\">:</span> <span class=\"token constant\">K</span><span class=\"token punctuation\">,</span>\n  instance<span class=\"token operator\">:</span> <span class=\"token builtin\">unknown</span>\n<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>updater<span class=\"token operator\">:</span> Updater<span class=\"token operator\">&lt;</span>TableState<span class=\"token punctuation\">[</span><span class=\"token constant\">K</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">(</span>instance <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">setState</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TTableState</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">(old: TTableState) => </span><span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>old<span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token function\">functionalUpdate</span><span class=\"token punctuation\">(</span>updater<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>old <span class=\"token keyword\">as</span> <span class=\"token builtin\">any</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token plain-text\">);\n  };\n}</span></code></pre></div>\n<p>처음엔 이 부분이 내가 위에서 접한 useReactTable의 onRowSelectionChange라고 생각했다.<br>\n하지만, 위에서 확인했던, log를 대조해보니, 확실히 다르다는 것을 알 수 있었다..</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">  <span class=\"token comment\">// 다시 확인</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onRowSelectionChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>rowSelection<span class=\"token operator\">:</span> RowSelectionState<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'rowSelection'</span><span class=\"token punctuation\">,</span> rowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// log!!!</span>\n    <span class=\"token function\">setRowSelection</span><span class=\"token punctuation\">(</span>rowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// rowSelection</span>\n  <span class=\"token function\">rowSelection</span> <span class=\"token punctuation\">(</span>old<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> _opts$selectChildren<span class=\"token punctuation\">;</span>\n      value <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> value <span class=\"token operator\">!==</span> <span class=\"token string\">\"undefined\"</span> <span class=\"token operator\">?</span> value <span class=\"token operator\">:</span> <span class=\"token operator\">!</span>isSelected<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span><span class=\"token function\">getCanSelect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> isSelected <span class=\"token operator\">===</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> old<span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span></code></pre></div>\n<br/>\n<hr>\n<p>로그에 찍힌 부분을 다시 찾아봤다.<br>\n아래에 조금 내리니, 브라우저 로그에서 확인했던 코드와 유사한 코드를 발견했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// https://github.com/TanStack/table/blob/6b4d616dd7c8917616eb4fecaf09dda7030fd115/packages/table-core/src/features/RowSelection.ts#L473</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> RowSelection<span class=\"token operator\">:</span> TableFeature <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  createRow<span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TData</span></span> <span class=\"token attr-name\">extends</span> <span class=\"token attr-name\">RowData</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">(\n    row: Row&lt;TData>,\n    table: Table&lt;TData>\n  ): void => </span><span class=\"token punctuation\">{</span>\n    row<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">toggleSelected</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">,</span> opts<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> isSelected <span class=\"token operator\">=</span> row<span class=\"token punctuation\">.</span><span class=\"token function\">getIsSelected</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n      table<span class=\"token punctuation\">.</span><span class=\"token function\">setRowSelection</span><span class=\"token punctuation\">(</span>old <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        value <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> value <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span> <span class=\"token operator\">?</span> value <span class=\"token operator\">:</span> <span class=\"token operator\">!</span>isSelected\n\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span><span class=\"token function\">getCanSelect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> isSelected <span class=\"token operator\">===</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">return</span> old\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">const</span> selectedRowIds <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>old <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">mutateRowIsSelected</span><span class=\"token punctuation\">(</span>\n          selectedRowIds<span class=\"token punctuation\">,</span>\n          row<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n          value<span class=\"token punctuation\">,</span>\n          opts<span class=\"token operator\">?.</span>selectChildren <span class=\"token operator\">??</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n          table\n        <span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">return</span> selectedRowIds\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token plain-text\">,\n}</span></code></pre></div>\n<p>createRow 메서드 중, <code class=\"language-text\">old => {}</code>부분이 위에서 log로 확인했던 인자값과 유사해보인다.<br>\n즉, <strong>onChangeFn은 table의 setRowSelection이었던 것</strong>이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// https://github.com/TanStack/table/blob/6b4d616dd7c8917616eb4fecaf09dda7030fd115/packages/table-core/src/features/RowSelection.ts#L547</span>\n<span class=\"token keyword\">const</span> mutateRowIsSelected <span class=\"token operator\">=</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TData</span></span> <span class=\"token attr-name\">extends</span> <span class=\"token attr-name\">RowData</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">(\n    selectedRowIds: Record&lt;string, boolean>,\n    id: string,\n    value: boolean,\n    includeChildren: boolean,\n    table: Table&lt;TData>\n  ) => </span><span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> row <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span><span class=\"token function\">getRow</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">//...</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>row<span class=\"token punctuation\">.</span><span class=\"token function\">getCanMultiSelect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>selectedRowIds<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">forEach</span><span class=\"token punctuation\">(</span>key <span class=\"token operator\">=></span> <span class=\"token keyword\">delete</span> selectedRowIds<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span><span class=\"token function\">getCanSelect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        selectedRowIds<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">delete</span> selectedRowIds<span class=\"token punctuation\">[</span>id<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<p>먼저 row가 몇 번째 행인지 id로 찾는다. (사용자가 체크박스 체크했을 때 id로 행을 찾는다.)</p>\n<p>value는 boolean타입인데, rowSelection id에 해당하는 체크상태인 것 같다.<br>\nvalue가 존재하는 상태에서 각 분기별로, multiSelect가 가능한지, select가능한지, 만약 value가 없다면 제거하는 것이다.<br>\n(실제 rowSelection에는 선택된 체크박스 ID만 담긴다.)</p>\n<br/>\n<p>그리고 한 가지 특이점이라면, mutateRowIsSelected는 반환값이 없다는 점이다.\n그 이유는 참조값으로 전달된 객체를 직접 변경하기 때문이다. mutateRowIsSelected 함수가 호출될 때, <code class=\"language-text\">const selectedRowIds = {...old}</code>로 얕은 복사가 이뤄지며,\n이로 인해 selectedRowIds는 새로운 객체지만 그 내부 구조는 여전히 참조로 연결되어있다.</p>\n<p>mutateRowIsSelected는 이 selectedRowIds 객체를 직접 변경하여, 함수 외부에서도 동일한 객체의 변경이 반영되도록 한다.\n결과적으로, mutateRowIsSelected가 selectedRowIds를 변경하면, 이 변경된 상태가 table.setRowSelection 함수에서 반환되어 최종적으로 새로운 상태가 반영된다.<br>\n이렇게 복사된 후 직접 변경된 객체가 반환됨으로써 테이블의 선택상태가 업데이트 되는 것이다.</p>\n<br/>\n<hr>\n<h3 id=\"tablesetrowselection\" style=\"position:relative;\"><a href=\"#tablesetrowselection\" aria-label=\"tablesetrowselection permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>table.setRowSelection</h3>\n<p>궁금증은 해결되었다. onRowSelectionChange는 table의 setRowSelection이었다.<br>\n그럼, table의 setRowSelection은 어디서 만들어질까?</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token generic-function\"><span class=\"token function\">createTable</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TData <span class=\"token keyword\">extends</span> RowData<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span>\n  options<span class=\"token operator\">:</span> TableOptionsResolved<span class=\"token operator\">&lt;</span>TData<span class=\"token operator\">></span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> Table<span class=\"token operator\">&lt;</span>TData<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//...</span>\n\n  <span class=\"token comment\">// builtInFeatures에 RowSelection이 포함되어있다.</span>\n  <span class=\"token keyword\">const</span> _features <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>builtInFeatures<span class=\"token punctuation\">,</span> <span class=\"token operator\">...</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">.</span>_features <span class=\"token operator\">??</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">let</span> table <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> _features <span class=\"token punctuation\">}</span> <span class=\"token keyword\">as</span> <span class=\"token builtin\">unknown</span> <span class=\"token keyword\">as</span> Table<span class=\"token operator\">&lt;</span>TData<span class=\"token operator\">></span>\n\n  <span class=\"token comment\">//...</span>\n\n  Object<span class=\"token punctuation\">.</span><span class=\"token function\">assign</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">,</span> coreInstance<span class=\"token punctuation\">)</span>\n\n  <span class=\"token comment\">// for문을 돌면서, 해당하는 builtInFeatures에 포함된 인스턴스 중 createTable이 있다면 이를 호출하여 테이블 인스턴스에 포함한다.</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> index <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> index <span class=\"token operator\">&lt;</span> table<span class=\"token punctuation\">.</span>_features<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">;</span> index<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> feature <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span>_features<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span>\n    feature<span class=\"token operator\">?.</span>createTable<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span>table<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> table\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>creatTable을 다시 살펴보면, 함수가 끝나는 마지막쯤 for문이 보인다.<br>\ntable._features에 RowSelection도 포함되어있는데, for문을 돌면서, 해당 feature를 꺼내오고, createTable 메서드를 실행시킨다.<br>\n이때 RowSelection의 createTable도 존재한다면, 실행될 것이다.</p>\n<p>확인해보니, RowSelection도 createTable이 존재하며 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// https://github.com/TanStack/table/blob/6b4d616dd7c8917616eb4fecaf09dda7030fd115/packages/table-core/src/features/RowSelection.ts#L221</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> RowSelection<span class=\"token operator\">:</span> TableFeature <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//...</span>\n  createTable<span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TData</span></span> <span class=\"token attr-name\">extends</span> <span class=\"token attr-name\">RowData</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">(table: Table&lt;TData>): void => </span><span class=\"token punctuation\">{</span>\n    table<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setRowSelection</span> <span class=\"token operator\">=</span> updater <span class=\"token operator\">=></span>\n      table<span class=\"token punctuation\">.</span>options<span class=\"token punctuation\">.</span>onRowSelectionChange<span class=\"token operator\">?.</span><span class=\"token punctuation\">(</span>updater<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token plain-text\">,\n}</span></code></pre></div>\n<p>위 코드에서, createTable이 생성되면서 table의 setRowselection이 정의되어 있는 것을 볼 수 있다.<br>\ncreateTable의 매개변수인 updater는 위에서 확인했던 콜백함수와 동일할 것으로 생각된다. <code class=\"language-text\">old => {}</code></p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">  <span class=\"token comment\">// 위에서 언급했던 이 부분, old => {}가 위 setRowSelection의 인자로 들어간다.</span>\n  table<span class=\"token punctuation\">.</span><span class=\"token function\">setRowSelection</span><span class=\"token punctuation\">(</span>old <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    value <span class=\"token operator\">=</span> <span class=\"token keyword\">typeof</span> value <span class=\"token operator\">!==</span> <span class=\"token string\">'undefined'</span> <span class=\"token operator\">?</span> value <span class=\"token operator\">:</span> <span class=\"token operator\">!</span>isSelected\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">.</span><span class=\"token function\">getCanSelect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> isSelected <span class=\"token operator\">===</span> value<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> old\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">const</span> selectedRowIds <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span>old <span class=\"token punctuation\">}</span>\n\n    <span class=\"token function\">mutateRowIsSelected</span><span class=\"token punctuation\">(</span>\n      selectedRowIds<span class=\"token punctuation\">,</span>\n      row<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">,</span>\n      value<span class=\"token punctuation\">,</span>\n      opts<span class=\"token operator\">?.</span>selectChildren <span class=\"token operator\">??</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      table\n    <span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">return</span> selectedRowIds\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<br/>\n<h3 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h3>\n<p>정리해보면 다음과 같다.</p>\n<ul>\n<li>\n<p>Tanstack-table의 onRowSelectionChange는 결국 table이 생성될 때 만들어진, setRowSelection이었다.<br>\n그리고 이는 tanstack-table core에 정의된 createTable의 호출에 의해 만들어 진 것이다.</p>\n</li>\n<li>\n<p>생성된 table 인스턴스는 useReactTable의 tableRef를 통해 주입된다.</p>\n</li>\n</ul>\n<p>정리해보니 많지 않은 내용인데, 내부코드를 모르는 상태에서 하나씩 살펴보다보니 오래 걸린 것 같다.</p>\n<p>정리하다가, 너무 길어지는 것 같아서, 조금 맥을 끊고 싶기도 했다.<br>\n사실 한 가지 남은 의문이 더 있다.</p>\n<p><strong>createRow는 어디서 실행되는가</strong>인데, 어디서 실행되었기 때문에 row.toggleSelected이 생성되었을 것이다.<br>\n그리고 이를 통해 사용자가 체크박스를 체크 or 해지 할 수 있으며, row.toggleSelected이 호출되는 것이다.</p>\n<p>이후엔 오늘 살펴본 내용과 같다.<br>\n(setRowSelection을 통해 state가 업데이트되고, table내부 state, rowSelection이 업데이트 됨.)</p>\n<p>한 가지 알게 된 내용은, createTable이 실행될 땐 createRow가 생성되지 않았다.<br>\n이 부분은 다음 글에서 찾아봐야할 것 같다.</p>","tableOfContents":"<ul>\n<li><a href=\"#usereacttable\">useReactTable</a></li>\n<li><a href=\"#table-core\">table-core</a></li>\n<li><a href=\"#tablesetrowselection\">table.setRowSelection</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n</ul>","frontmatter":{"title":"Tanstack-table의 onRowSelectionChange 내부 살펴보기","summary":"onRowSelectionChange 메서드를 살펴보자","date":"2024.11.09.","categories":["개발"]}}}]}},"pageContext":{"slug":"/blog/2024/11/9/tanstack-table-row-selection/"}},"staticQueryHashes":["1629908903"]}