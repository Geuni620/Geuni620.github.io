{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2024/5/24/query-function-context/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6abe0c0fa9485c76957e8f87026b01de/a4772/img.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.29166666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRr4AAABXRUJQVlA4ILIAAADQBACdASoUAAsAPtFUo0uoJKMhsAgBABoJbACdMoMYA0fBq3Np4FxnFAllP4QQAAD+rSUZ38eCPNrU85hzXuG+NH+6Yf/WhP4XxRNVVJe0BWP6KFCvkJ0RQJTuiNhnv4RNn3hECMP5rfdxEN7jRjshcJGByOXb+0Kj6FZ6kvP2EZtsV8OBAloZmL2GMTVVv25xPRtVfh2AgtuevD7WXgLSISRC4MJyWmaahWy07Wc+RgAA'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/6abe0c0fa9485c76957e8f87026b01de/a59e9/img.webp 192w,\n/static/6abe0c0fa9485c76957e8f87026b01de/0ca9f/img.webp 384w,\n/static/6abe0c0fa9485c76957e8f87026b01de/dc9b9/img.webp 768w,\n/static/6abe0c0fa9485c76957e8f87026b01de/e2c2f/img.webp 1152w,\n/static/6abe0c0fa9485c76957e8f87026b01de/f3efb/img.webp 1536w,\n/static/6abe0c0fa9485c76957e8f87026b01de/a4772/img.webp 1792w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/6abe0c0fa9485c76957e8f87026b01de/a59e9/img.webp 192w,\n/static/6abe0c0fa9485c76957e8f87026b01de/0ca9f/img.webp 384w,\n/static/6abe0c0fa9485c76957e8f87026b01de/dc9b9/img.webp 768w,\n/static/6abe0c0fa9485c76957e8f87026b01de/e2c2f/img.webp 1152w,\n/static/6abe0c0fa9485c76957e8f87026b01de/f3efb/img.webp 1536w,\n/static/6abe0c0fa9485c76957e8f87026b01de/a4772/img.webp 1792w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/6abe0c0fa9485c76957e8f87026b01de/dc9b9/img.webp\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>오랜만에 <a href=\"https://tkdodo.eu/blog/leveraging-the-query-function-context\" target=\"_blank\" rel=\"nofollow\">Tkdodo</a>의 글을 봤다.<br>\n‘이 글을 읽고, 비슷한 글을 썼던 것 같은데..’ 기억이나 찾아본 결과,<br>\n<a href=\"https://geuni620.github.io/blog/2023/5/15/%5BTanstack-query%5D%20QueryFunctionContext/\" target=\"_blank\" rel=\"nofollow\">이전에 작성한 글</a>을 발견했다.<br>\n도통 무슨말인지 이해가 안갔다.<br>\n(그래서 다시 적는다; 😭)</p>\n<br/>\n<h3 id=\"queryfunctioncontext를-적용하게-된-계기\" style=\"position:relative;\"><a href=\"#queryfunctioncontext%EB%A5%BC-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B2%8C-%EB%90%9C-%EA%B3%84%EA%B8%B0\" aria-label=\"queryfunctioncontext를 적용하게 된 계기 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>QueryFunctionContext를 적용하게 된 계기</h3>\n<p>어떨 때 사용하는걸까?<br>\n간단한 예시를 만들어봤다.<br>\n대시보드가 있다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/135932234b8c966d726614d8e26cef16/98e2c/dashboard.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 107.29166666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAACB0lEQVQ4y21U7Y6kIBCc93+9yyW32Wzu72V3FBREAZu6FIgzgibEj04X1VUljxgjQojYd0FKKd93eS3WJAHiHMRMEGvKWix2NSBOOj+zFrzHI8SIGHcsbkXcd/AicF1u3eC9R+L3m7Vs4fWegAcZkOWoNLbNd4DL4l7fJV1qSQTzbLDHPaOJSAHkGgaFbds6QDYYayGpASNAStB6AqfkJZIOwFgA3bp2gNM0YxxVbvQ+XOpybEhmqQJSPwKycBbfAK1dMihr8WDS1vdD+wtDNthl6cZybsW6rt33k6Ex2dQrYAj4+Rkyk5aBnua8EU4nr6DjqLNxBVBKbAhKjZTW3cjG2LwRWXK0FpQM2f9iGEtsOLK7Ga1qyFjdmWKo4bspNTZTNiR1I7OBmzHcLfuagivDQ8PnMGYD+pEs1pt8nhoqfdbPYHNkpXQer2N4aHjHrta72NB2NhGwbaCDbKLbrYYVsItN/pdHlUfu/pTZ5FoNdrr5NTtATw2fI+yRp1bDrC2PsJuRlZ5OImcOuTNHYhbbrDHUteHOGB4cNLUbOefQrcdBiy6HpdYEWwTGmGLK9fgKxclUciithkrn04hZrEzqoaqNxXZoyPcHi0TOgncaIYeW7l7qbHYL4udvbF8f8F8fCH8/sf35hcd7s9ycJunUroya2fE5eMTnN0SPEK0QxgH++x/+A2wEcmndBwsqAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/135932234b8c966d726614d8e26cef16/a59e9/dashboard.webp 192w,\n/static/135932234b8c966d726614d8e26cef16/0ca9f/dashboard.webp 384w,\n/static/135932234b8c966d726614d8e26cef16/dc9b9/dashboard.webp 768w,\n/static/135932234b8c966d726614d8e26cef16/e2c2f/dashboard.webp 1152w,\n/static/135932234b8c966d726614d8e26cef16/f3efb/dashboard.webp 1536w,\n/static/135932234b8c966d726614d8e26cef16/548e7/dashboard.webp 2400w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/135932234b8c966d726614d8e26cef16/3b721/dashboard.png 192w,\n/static/135932234b8c966d726614d8e26cef16/66595/dashboard.png 384w,\n/static/135932234b8c966d726614d8e26cef16/fe486/dashboard.png 768w,\n/static/135932234b8c966d726614d8e26cef16/d2d74/dashboard.png 1152w,\n/static/135932234b8c966d726614d8e26cef16/e8464/dashboard.png 1536w,\n/static/135932234b8c966d726614d8e26cef16/98e2c/dashboard.png 2400w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/135932234b8c966d726614d8e26cef16/fe486/dashboard.png\"\n            alt=\"dashboard\"\n            title=\"dashboard\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>빨간박스 부분을 주목해보자.<br>\n사용자의 이벤트에 의해 state를 변경할 때마다,<br>\nsupabase의 params로 적용해서 Task 데이터를 가져올 것이다.<br>\nCustom hooks으로 만들어보면 대략 이런 구조를 갖추게 될 것 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// useTaskGetQuery.ts</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">FetchProps</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  page<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  size<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  search<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 총 몇개씩 가져올 것인지 → size</span>\n<span class=\"token keyword\">const</span> fetchTask <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  page<span class=\"token punctuation\">,</span>\n  size<span class=\"token punctuation\">,</span>\n  search<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> FetchProps<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>TaskResponse<span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> start <span class=\"token operator\">=</span> page <span class=\"token operator\">*</span> size<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> end <span class=\"token operator\">=</span> start <span class=\"token operator\">+</span> size <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">let</span> query <span class=\"token operator\">=</span> supabase\n    <span class=\"token punctuation\">.</span><span class=\"token function\">from</span><span class=\"token punctuation\">(</span><span class=\"token constant\">TASK</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">select</span><span class=\"token punctuation\">(</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n      count<span class=\"token operator\">:</span> <span class=\"token string\">'exact'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">order</span><span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> ascending<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">.</span><span class=\"token function\">range</span><span class=\"token punctuation\">(</span>start<span class=\"token punctuation\">,</span> end<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>search<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    query <span class=\"token operator\">=</span> query<span class=\"token punctuation\">.</span><span class=\"token function\">textSearch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'task'</span><span class=\"token punctuation\">,</span> search<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> count<span class=\"token punctuation\">,</span> error <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> query<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useTaskGetQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">TASK</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">queryFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetchTask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>여기서 아래 부분을 주목해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useTaskGetQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">TASK</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">,</span>\n    <span class=\"token function-variable function\">queryFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">fetchTask</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>지금은 queryKey에 <code class=\"language-text\">page</code>, <code class=\"language-text\">size</code>, <code class=\"language-text\">search</code>를 잘 반영했지만,<br>\n만약 queryKey에 포함시키지 않고, fetchTask의 인자값으로만 넘겼다고 가정해보자.<br>\n그럼, 위 스크린샷의 빨간박스를 변경해도, <strong>해당 데이터를 새롭게 불러오지 못할 것이다.</strong></p>\n<p>실제로 <a href=\"https://geuni620.github.io/blog/2024/4/7/use-query-post/\" target=\"_blank\" rel=\"nofollow\">이전 글</a>을 작성할 당시, <a href=\"https://github.com/Geuni620/use-query-post-method/blob/e8048156cd2b91f91a430fa55243512dc02401f5/hook/useTableDataGetQuery.ts#L31-L36\" target=\"_blank\" rel=\"nofollow\">사용한 예시코드</a>를 살펴보면, custom hooks으로 받아온 <code class=\"language-text\">searchCondition</code>을 queryFn과 queryKey에 모두 적용한 것을 확인할 수 있다.</p>\n<p>하지만, 처음에는 완전히 놓쳤었다. 😭<br>\n<strong>queryKey에 <code class=\"language-text\">searchCondition</code>을 추가하지 않았던 것이다.</strong><br>\n고맙게도, <a href=\"https://tanstack.com/query/latest/docs/eslint/eslint-plugin-query\" target=\"_blank\" rel=\"nofollow\">ESLint Plugin Query</a>가 에러를 알려줬기 때문에 추가할 수 있었다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/687ee/eslint-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACAklEQVQ4y5WT7VLbMBBF8yhtCYTE35ZjfUu2k0BIgLa/+v5Pcjq2C6VMYeDH2SvtjK92V/JCxBt0PKD8gHA9ifRcFC3LQrIsJZeV5KpWkz6t32Ox0j3F7oS5PaNuTmRhjxjiRN1FNtJ+yOjZcL11NP0Zc/yJuvlO5o80cYeIkY2yb354WY0quXxteF0bZH+i3Z8p/YF16xlzy6KdW6/kX8qXY5Cz6avqF9dCo/sj27inDHsysyNRkUQF8tZRNGZma0m1IxmrFvrtCsfT1HCiu3+g7Do2MlD6jjJ0pKOJ0KSNIWvMZJYow1X9juEYMuOprCc3kdx21LFD9DtS5T/f8hhyt0eYgaSNXDeeVAYy05FK//lLGUOie6pwZCN7MufIjCYd0Ya1tCwr9c97fPfZjPOo5ECzddSmp3QHcntHqvrny0m2hpUwH3zY4wz1MLWs4oHC9Kzbsd04/TUTzWio/8xLzvoGi1VjyfyOpu+pux2r1vGlbPk6IWcqNfHtifrF+kVuOVZYCsUpdDzuB25DoDMWXW9RVYOum1mrWf8iXu3nXFFtWfSiQfkObTxaObzvsDZgjZ8w2uOmfZjU2YiSFqUd0vhnhLLcFTmLUArK2x/ox1+I4wPl4cza7biS4cOsZOBCRu7rikWoa7qmJdQjAltWqDRH5wU6+w9v5FVWMGQpvwG5EgJx0nPn0QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/a59e9/eslint-error.webp 192w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/0ca9f/eslint-error.webp 384w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/dc9b9/eslint-error.webp 768w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/e2c2f/eslint-error.webp 1152w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/f3efb/eslint-error.webp 1536w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/c6318/eslint-error.webp 1838w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/3b721/eslint-error.png 192w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/66595/eslint-error.png 384w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/fe486/eslint-error.png 768w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/d2d74/eslint-error.png 1152w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/e8464/eslint-error.png 1536w,\n/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/687ee/eslint-error.png 1838w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cc8e083d7e6b9b0d8d5815c953d1f6a9/fe486/eslint-error.png\"\n            alt=\"만약 queryKey를 적절히 반영하지 않는다면, eslint는 내게 빨간불을 켤 것이다.\"\n            title=\"만약 queryKey를 적절히 반영하지 않는다면, eslint는 내게 빨간불을 켤 것이다.\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">만약 queryKey를 적절히 반영하지 않는다면, eslint는 내게 빨간불을 켤 것이다.</figcaption>\n  </figure></p>\n<br/>\n<p>eslint가 적절히 알려주긴 하지만,<br>\n적어도 useQuery내에서, 한번만 params를 넘겨주면 더 편하지 않을까?<br>\n결론적으로 이렇게 말이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useTaskGetQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">TASK</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 여기에 한번만 추가</span>\n    queryFn<span class=\"token operator\">:</span> fetchTask<span class=\"token punctuation\">,</span> <span class=\"token comment\">// api만 호출</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이때 <strong>QueryFunctionContext</strong>가 유용할 것이다.</p>\n<h3 id=\"queryfunctioncontext-적용하기\" style=\"position:relative;\"><a href=\"#queryfunctioncontext-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"queryfunctioncontext 적용하기 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>QueryFunctionContext 적용하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useTaskGetQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//... 위와 동일함</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> fetchTask <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  queryKey<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>TaskResponse<span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token builtin\">console</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"queryKeys\"</span><span class=\"token punctuation\">,</span> querykey<span class=\"token punctuation\">)</span> <span class=\"token comment\">// log를 찍어보자.</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> queryKey<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ..</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 520px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e73a0d18af0c048ffc73e699e02013b9/407f2/console-log-querykey.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.895833333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABvElEQVQoz42TSW/bMBCF9f9/VC4FevDFaQ8GGttxbFELJZmLFkvU9hWUYyBOnKIDPAwwGx5nHoOu60jTlDzPCcMQay0+ZoyhUGfarqM3hvFcMCrF1DRX33V0zqG1pq5rctszjDNB0zTs9/tl6OFwIMsy6qrCWEN0OFHaEpdJ3O4Fd3xbhvUipLOWqmlIkwRblmTG0Q8TAf8w9SKwuWY6F3T7HS48MRpNn8TMbfuwJ5jnmWmauHmPZZjRJNsj6qzuO97z3nzPZ3xh6IPXvolxGCn+hJyeninjjEi3tG66q7v5O4aPwHuh3sccn56Rv3bkIme61IxV9f8MPzMtTxnxzw1mK4gOElO2ME/f7j0Yx5Hv0I8D+iQ5/vhNcRAI1fAaGb8QXN8zDMMiMefcAr+mwGvoEbychBBkqiAuJImUxCIkEqdFZj7npbZarViv12w2m2V4cLvsR3h23rqyQe0EahtSpjlSX+icz81fjnFb04MdXgutNdRlhRQxuUhQRcFZaZRSVFVFe7mQpgmZlESR4Hh8uz55mufly3zEOEHVtNRNu/jq0mLLGm1KCqWxVbPEi7NGZgUiSkhlvvyUvwwzn4zm+nX0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/e73a0d18af0c048ffc73e699e02013b9/a59e9/console-log-querykey.webp 192w,\n/static/e73a0d18af0c048ffc73e699e02013b9/0ca9f/console-log-querykey.webp 384w,\n/static/e73a0d18af0c048ffc73e699e02013b9/29f9e/console-log-querykey.webp 520w\"\n              sizes=\"(max-width: 520px) 100vw, 520px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/e73a0d18af0c048ffc73e699e02013b9/3b721/console-log-querykey.png 192w,\n/static/e73a0d18af0c048ffc73e699e02013b9/66595/console-log-querykey.png 384w,\n/static/e73a0d18af0c048ffc73e699e02013b9/407f2/console-log-querykey.png 520w\"\n            sizes=\"(max-width: 520px) 100vw, 520px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/e73a0d18af0c048ffc73e699e02013b9/407f2/console-log-querykey.png\"\n            alt=\"console log querykey\"\n            title=\"console log querykey\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>아주 간단하게 다음과 같이 구성하면 된다.<br>\n이로써, 단지 useQuery의 queryKey에만 집중하면 된다.<br>\napi params는 api 호출 함수내에서 신경써주면 되는 것이다.<br>\n(useTaskGetQuery에서 신경써야하는 부분이 2개에서 1개로 줄었다.)</p>\n<br/>\n<h3 id=\"타입-적용하기\" style=\"position:relative;\"><a href=\"#%ED%83%80%EC%9E%85-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-label=\"타입 적용하기 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>타입 적용하기</h3>\n<p>안전하게 사용하기 위해 타입도 적절히 추가해보자.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 타입을 생성</span>\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">QueryKeyFactory</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> size<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span> search<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 반영</span>\n<span class=\"token keyword\">const</span> fetchTask <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  queryKey<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> QueryKeyFactory<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>TaskResponse<span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> queryKey<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">type</span> <span class=\"token class-name\">props</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  page<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  size<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  search<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useTaskGetQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token constant\">TASK</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">,</span>\n    queryFn<span class=\"token operator\">:</span> fetchTask<span class=\"token punctuation\">,</span> <span class=\"token comment\">// Error ❌</span>\n    placeholderData<span class=\"token operator\">:</span> keepPreviousData<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>처음엔 다음과 같이 타입을 추가했었다.<br>\n하지만, queryFn에서 다음과 같은 에러를 뱉었다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e5a3f6e40425d8251e398ea0bb5782d/954d4/type-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 48.4375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABlklEQVQoz31S2VIjMRDzxwQSdjckQ+b03GPPfYVAwf9/iSh1gAKq2AeV20erpW4r14yI6zN8MyPpFpTzBfu4xK0TYHuKcPsQfgPPdq7+thJ3nsbfIIUKqxZmOiPrZhTDirybUY4rdD2gHK/ndnmS2Csa+GWDyPaITI+w6hBUreA+yvEvzKAie01kkp0vstbLE5J2kgK8475ZnyVRSMpWSElAIiELUmycAOoYV/CKGmk3I65HRKa7Ku0XUfkRU6mb1/KWKgkqZoFTZhGaDn/8BMovWrm81zmctMIpM5L0kBq4uRU4SYVDXOAYl4KDLuQ9wZggB1UqJzXYR5lYoEptB6TtJIqSZvxUx2K0SjUsyEJUJfu8loFtjj5UYHpJiJtR+qVtj2p6vJL2i8TSx/VZeskWmPmC7vFFwJj5dMZpq9AMyPsVSTMJyUd/OEX2lI95Tsv7MBM3HAKtc6VdJyllQJuDB2XWV+TjBdlwRtSMcIsaTmY//+DOjbB9t/NfOAFuOOWtfM7wPVnjzoux87RcfsXPD/4b3gC9N1Xny3o+jQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1e5a3f6e40425d8251e398ea0bb5782d/a59e9/type-error.webp 192w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/0ca9f/type-error.webp 384w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/dc9b9/type-error.webp 768w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/e2c2f/type-error.webp 1152w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/f3efb/type-error.webp 1536w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/837a1/type-error.webp 1718w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1e5a3f6e40425d8251e398ea0bb5782d/3b721/type-error.png 192w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/66595/type-error.png 384w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/fe486/type-error.png 768w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/d2d74/type-error.png 1152w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/e8464/type-error.png 1536w,\n/static/1e5a3f6e40425d8251e398ea0bb5782d/954d4/type-error.png 1718w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1e5a3f6e40425d8251e398ea0bb5782d/fe486/type-error.png\"\n            alt=\"type error\"\n            title=\"type error\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>뭔가 복잡하게 적혀있지만, queryKey의 타입이 잘못된 것 같다는 생각을 했다.<br>\n검색해본 결과, <a href=\"https://stackoverflow.com/questions/73343133/what-is-the-react-query-querykey-typescript-type\" target=\"_blank\" rel=\"nofollow\">stackoverflow에서 이 글을 발견했다.</a></p>\n<p>주목해야할 점은 query내에서 <code class=\"language-text\">QueryFunctionContext</code>타입을 제공해준다는 사실이다.<br>\n<a href=\"https://tkdodo.eu/blog/leveraging-the-query-function-context#how-to-type-the-queryfunctioncontext\" target=\"_blank\" rel=\"nofollow\">Tkdodo 블로그</a>에도 이 타입을 사용했다.</p>\n<p>나는 다음과 같이 반영했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> QueryFunctionContext <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> fetchTask <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  queryKey<span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// QueryFunctionContext 타입</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> QueryFunctionContext<span class=\"token operator\">&lt;</span>QueryKeyFactory<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>TaskResponse<span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> queryKey<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// 추가로 useQuery로 명확히 타입을 지정해주는 게 좋을 것 같다.</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useTaskGetQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token generic-function\"><span class=\"token function\">useQuery</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TaskResponse<span class=\"token punctuation\">,</span> Error<span class=\"token punctuation\">,</span> TaskResponse<span class=\"token punctuation\">,</span> QueryKeyFactory<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n   <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"결론--queryfactory\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0--queryfactory\" aria-label=\"결론  queryfactory permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론 (+ queryFactory)</h3>\n<p>앞으로 params를 추가해줘야할 일이 있다면, <code class=\"language-text\">QueryFunctionContext</code>를 적극 사용할 것이다.<br>\n추가로, 처음 queryKey를 배열기준으로 사용해서, 다음과 같이 적용했었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> fetchTask <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  queryKey<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> QueryFunctionContext<span class=\"token operator\">&lt;</span>QueryKeyFactory<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>TaskResponse<span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 사용되지 않는 맨 처음 인덱스를 비워야했다.</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> queryKey<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>하지만, Tkdodo의 블로그 내용을 참고해보면, 아래와 같이 수정할 수도 있다.<br>\n<a href=\"https://tkdodo.eu/blog/leveraging-the-query-function-context#query-key-factories\" target=\"_blank\" rel=\"nofollow\">query key factory</a>를 사용하는 것이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// queryKeyFactory</span>\n<span class=\"token keyword\">const</span> taskKeys <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  all<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> task<span class=\"token operator\">:</span> <span class=\"token constant\">TASK</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">task</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n    <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>taskKeys<span class=\"token punctuation\">.</span>all<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        page<span class=\"token punctuation\">,</span>\n        size<span class=\"token punctuation\">,</span>\n        search<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> <span class=\"token keyword\">const</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> fetchTask <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ✅ 구조분해할당으로 필요한 params만 가져온다.</span>\n  queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> QueryFunctionContext<span class=\"token operator\">&lt;</span>\n  ReturnType<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> taskKeys<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'task'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span>\n<span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>TaskResponse<span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useTaskGetQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> search <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> props<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token generic-function\"><span class=\"token function\">useQuery</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>\n    TaskResponse<span class=\"token punctuation\">,</span>\n    Error<span class=\"token punctuation\">,</span>\n    TaskResponse<span class=\"token punctuation\">,</span>\n    ReturnType<span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">typeof</span> taskKeys<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token string\">'task'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token comment\">// return type</span>\n  <span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    queryKey<span class=\"token operator\">:</span> taskKeys<span class=\"token punctuation\">.</span><span class=\"token function\">task</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      page<span class=\"token punctuation\">,</span>\n      search<span class=\"token punctuation\">,</span>\n      size<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    queryFn<span class=\"token operator\">:</span> fetchTask<span class=\"token punctuation\">,</span>\n    placeholderData<span class=\"token operator\">:</span> keepPreviousData<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위와 같이 사용하면, 구조분해할당으로 편하게 params를 가져올 수 있다!</p>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<p><a href=\"https://tanstack.com/query/latest/docs/framework/react/guides/query-functions\" target=\"_blank\" rel=\"nofollow\">Query Functions</a><br>\n<a href=\"https://tkdodo.eu/blog/leveraging-the-query-function-context\" target=\"_blank\" rel=\"nofollow\">Leveraging the Query Function Context</a><br>\n<a href=\"https://stackoverflow.com/questions/73343133/what-is-the-react-query-querykey-typescript-type\" target=\"_blank\" rel=\"nofollow\">What is the react query “queryKey” typescript type</a></p>","tableOfContents":"<ul>\n<li><a href=\"#queryfunctioncontext%EB%A5%BC-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B2%8C-%EB%90%9C-%EA%B3%84%EA%B8%B0\">QueryFunctionContext를 적용하게 된 계기</a></li>\n<li><a href=\"#queryfunctioncontext-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\">QueryFunctionContext 적용하기</a></li>\n<li><a href=\"#%ED%83%80%EC%9E%85-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\">타입 적용하기</a></li>\n<li><a href=\"#%EA%B2%B0%EB%A1%A0--queryfactory\">결론 (+ queryFactory)</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></li>\n</ul>","frontmatter":{"title":"QueryFunctionContext 사용하기","summary":"queryKey를 params에 태우자","date":"2024.05.24.","categories":["개발"]}}}]}},"pageContext":{"slug":"/blog/2024/5/24/query-function-context/"}},"staticQueryHashes":["1629908903"]}