{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2024/6/7/tanstack-table-server-side/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc2473bb2797b1ae4f9c63fa2329b62d/d71bc/img.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRsgAAABXRUJQVlA4ILwAAAAwBQCdASoUABQAPtFgqU+oJaOiKAgBABoJaAAFEB7exm0znQNSoRJkbwpv77vg3WHsAAD+79dHuyPjHbx/kI/UzpuswBEm4Qt69sCmyxDyfmwFEk3ZqH6QU0HXL7m6mlXq8hmvk9v0kNdrFaxj78rYnIgTCIEPhkDkmLzYX5KD7Pq7gMgr1NVoa1ME9ClFysEYM7a6A/IpjySoqhv1Vgfrwo72ql07WtjqKQtjOsMLtiBW8WToRbkyTdiAAA=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cc2473bb2797b1ae4f9c63fa2329b62d/a59e9/img.webp 192w,\n/static/cc2473bb2797b1ae4f9c63fa2329b62d/0ca9f/img.webp 384w,\n/static/cc2473bb2797b1ae4f9c63fa2329b62d/dc9b9/img.webp 768w,\n/static/cc2473bb2797b1ae4f9c63fa2329b62d/d71bc/img.webp 1024w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cc2473bb2797b1ae4f9c63fa2329b62d/a59e9/img.webp 192w,\n/static/cc2473bb2797b1ae4f9c63fa2329b62d/0ca9f/img.webp 384w,\n/static/cc2473bb2797b1ae4f9c63fa2329b62d/dc9b9/img.webp 768w,\n/static/cc2473bb2797b1ae4f9c63fa2329b62d/d71bc/img.webp 1024w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cc2473bb2797b1ae4f9c63fa2329b62d/dc9b9/img.webp\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><a href=\"https://github.com/Geuni620/tanstack-table-pagination-server-side\" target=\"_blank\" rel=\"nofollow\">예시 소스코드</a></p>\n<h2 id=\"server-side-pagination\" style=\"position:relative;\"><a href=\"#server-side-pagination\" aria-label=\"server side pagination permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Server side pagination</h2>\n<p>Tanstack-table의 공식문서를 살펴보면, <a href=\"https://tanstack.com/table/latest/docs/guide/pagination\" target=\"_blank\" rel=\"nofollow\">해당 내용에 관한 글</a>이 존재한다.<br>\n현재 회사 프로젝트에선, client side로 개발되어있지만, 추후엔 server side로 변경할 가능성이 높다.<br>\n물론 문서를 확인해보면, <a href=\"https://tanstack.com/table/latest/docs/guide/pagination#client-side-pagination\" target=\"_blank\" rel=\"nofollow\">client side에서도 충분히 높은 성능</a>을 보여줄 수 있다고 한다.</p>\n<p>현 글에선 supabase의 RLS를 적극적으로 사용해보고 싶어서, React로만 구현하려고 한다.<br>\n그리고 Tanstack-table과 Tanstack-query를 사용할 것이다.</p>\n<br/>\n<h3 id=\"client-side-pagination\" style=\"position:relative;\"><a href=\"#client-side-pagination\" aria-label=\"client side pagination permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>client side pagination</h3>\n<p>먼저, tanstack-table을 이용해서, client-side로 pagination은 어떻게 구현할 수 있을까?<br>\n<a href=\"https://geuni620.github.io/blog/2023/12/2/tanstack-table/#3-pagination-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0\" target=\"_blank\" rel=\"nofollow\">이전 글에서 pagination 구현 소스코드</a>를 살펴보면 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useReactTable<span class=\"token punctuation\">,</span> getCoreRowModel<span class=\"token punctuation\">,</span> getPaginationRowModel <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-table'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    onRowSelectionChange<span class=\"token operator\">:</span> setRowSelection<span class=\"token punctuation\">,</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      rowSelection<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// Pagination</span>\n    getPaginationRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getPaginationRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">getPaginationRowModel</code>에 import 시킨 <code class=\"language-text\">getPaginationRowModal()</code>을 실행시키면, 끝이다.<br>\n이후 페이지네이션을 사용해야할 땐, <a href=\"https://tanstack.com/table/latest/docs/guide/tables\" target=\"_blank\" rel=\"nofollow\">Table Instance(이하 Table 인스턴스)</a>만으로 pagiantion 구현이 가능하다.</p>\n<p>사용은 다음과 같이 하면된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  </span><span class=\"token punctuation\">{</span>table<span class=\"token punctuation\">.</span><span class=\"token function\">getState</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>pagination<span class=\"token punctuation\">.</span>pageIndex <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\"> // 현재 페이지\n  </span><span class=\"token punctuation\">{</span>table<span class=\"token punctuation\">.</span><span class=\"token function\">getPageCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token plain-text\"> // 총 페이지 수\n</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<br/>\n<h2 id=\"server-side-pagination-1\" style=\"position:relative;\"><a href=\"#server-side-pagination-1\" aria-label=\"server side pagination 1 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>server side pagination</h2>\n<h3 id=\"1-getpaginationrowmodel-제거--manualpagiantion-추가\" style=\"position:relative;\"><a href=\"#1-getpaginationrowmodel-%EC%A0%9C%EA%B1%B0--manualpagiantion-%EC%B6%94%EA%B0%80\" aria-label=\"1 getpaginationrowmodel 제거  manualpagiantion 추가 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. getPaginationRowModel 제거 → manualPagiantion 추가</h3>\n<p>그럼 이제 본격적으로 server side pagination을 살펴보자.<br>\n<a href=\"https://tanstack.com/table/latest/docs/guide/pagination#manual-server-side-pagination\" target=\"_blank\" rel=\"nofollow\">공식문서의 내용</a>을 그대로 따라가면서 작성했다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useReactTable<span class=\"token punctuation\">,</span> getCoreRowModel<span class=\"token punctuation\">,</span> getPaginationRowModel <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-table'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    onRowSelectionChange<span class=\"token operator\">:</span> setRowSelection<span class=\"token punctuation\">,</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      rowSelection<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// Pagination</span>\n<span class=\"token operator\">-</span>   <span class=\"token comment\">// getPaginationRowModel: getPaginationRowModel(), remove!</span>\n<span class=\"token operator\">+</span>   manualPagination<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">manualPagination</code>을 true로 설정함으로써,<br>\ntable 인스턴스에게 더 이상 client-side로 페이지네이션을 사용하지 않겠다고 알려주는 것이다.</p>\n<p>이후, table 인스턴스는 내부적으로, <code class=\"language-text\">getPrePaginationRowModel</code>을 활성화시키며,<br>\ntable 인스턴스는 사용자가 전달한 데이터가 이미 페이지네이션 된 것으로 간주한다.</p>\n<p>실제로, client-side 되어있는 상태에서,<br>\n<code class=\"language-text\">getPaginationRowModel</code>을 제거하면, 더 이상 페이지네이션이 동작하지 않는다.<br>\n그리고 <code class=\"language-text\">manualPagination</code>을 true로 설정했을 때, 큰 변화가 보이지 않는다. 하지만 꼭 설정해줘야한다.</p>\n<br/>\n<h3 id=\"2-page-count페이지-수와-row-count행의-수-추가하기\" style=\"position:relative;\"><a href=\"#2-page-count%ED%8E%98%EC%9D%B4%EC%A7%80-%EC%88%98%EC%99%80-row-count%ED%96%89%EC%9D%98-%EC%88%98-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\" aria-label=\"2 page count페이지 수와 row count행의 수 추가하기 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. Page Count(페이지 수)와 Row Count(행의 수) 추가하기</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    manualPagination<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    rowCount<span class=\"token operator\">:</span> total<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 서버로 부터 받아온 row의 총 개수</span>\n    <span class=\"token comment\">// pageCount: total / pageSize // 서버로 부터 받아온 페이지 수가 있다면 이를 추가할 수도 있음</span>\n    onPaginationChange<span class=\"token punctuation\">,</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pagination <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이제 table 인스턴스에게 페이지 수가 몇인지, 행의 수는 몇 개씩 보여줄 것인지 알려주지 않으면,<br>\ntable 인스턴스는 이를 알 수 있는 방법이 없다.<br>\n그래서 <strong>rowCount 또는 pageCount와 같이 table 인스턴스에게 이를 알려주어야한다.</strong></p>\n<p><strong>rowCount는 서버로 부터 받아온 row의 총 개수이다.</strong> 예시에선 이를 사용했다.<br>\n<strong>pageCount는 서버로 부터 받아온 pagination 수를 바로 지정해주는 것이다.</strong></p>\n<p>예를 들어, 서버로부터 받아온 row의 총 개수가 200개이고,<br>\npageSize를 20으로 지정해 총 행을 20개씩 보여준다고 가정했을 때,<br>\npageCount는 10이 될 것이고, pagination은 1부터 10까지 노출될 것이다.</p>\n<br/>\n<h3 id=\"3-pagination-state\" style=\"position:relative;\"><a href=\"#3-pagination-state\" aria-label=\"3 pagination state permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Pagination State</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// usePagination.ts</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Pagination</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  pageIndex<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n  pageSize<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">usePagination</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>pagination<span class=\"token punctuation\">,</span> setPagination<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Pagination<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    pageIndex<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n    pageSize<span class=\"token operator\">:</span> <span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onPageSizeChange</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>pageSize<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">setPagination</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>prev<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>prev<span class=\"token punctuation\">,</span>\n        pageSize<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    pagination<span class=\"token punctuation\">,</span>\n    onPaginationChange<span class=\"token operator\">:</span> setPagination<span class=\"token punctuation\">,</span>\n    onPageSizeChange<span class=\"token operator\">:</span> onPageSizeChange<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>위와 같이 state를 관리하려고 한다.<br>\n<code class=\"language-text\">pageIndex</code>는 현재 페이지 번호이고,<br>\n<code class=\"language-text\">pageSize</code>는 총 데이터 중, 한 페이지에 몇 개씩 보여줄지를 결정하는 수이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// dashboard.tsx</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Dashboard</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> pagination<span class=\"token punctuation\">,</span> onPaginationChange<span class=\"token punctuation\">,</span> onPageSizeChange <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">usePagination</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> tasks <span class=\"token operator\">=</span> <span class=\"token function\">useTaskGetQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    page<span class=\"token operator\">:</span> pagination<span class=\"token punctuation\">.</span>pageIndex<span class=\"token punctuation\">,</span> <span class=\"token comment\">// here! 🙋‍♂️</span>\n    size<span class=\"token operator\">:</span> pagination<span class=\"token punctuation\">.</span>pageSize<span class=\"token punctuation\">,</span> <span class=\"token comment\">// here! 🙋‍♂️</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>tasks<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">DataTable</span></span>\n        <span class=\"token attr-name\">data</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>tasks<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>result<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">total</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>tasks<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span>count <span class=\"token operator\">??</span> <span class=\"token number\">0</span><span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">columns</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>columns<span class=\"token punctuation\">}</span></span>\n        <span class=\"token attr-name\">pagination</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>pagination<span class=\"token punctuation\">}</span></span> <span class=\"token comment\">// here! 🙋‍♂️</span>\n        <span class=\"token attr-name\">onPaginationChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onPaginationChange<span class=\"token punctuation\">}</span></span> <span class=\"token comment\">// here! 🙋‍♂️</span>\n      <span class=\"token punctuation\">/></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">...Loading</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>pagination state를 DataTable 컴포넌트의 props로,<br>\nuseTaskGetQuery의 매개변수로 각각 추가해준다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// data-table.tsx</span>\n  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    manualPagination<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    rowCount<span class=\"token operator\">:</span> total<span class=\"token punctuation\">,</span>\n    onPaginationChange<span class=\"token punctuation\">,</span> <span class=\"token comment\">// here! 🙋‍♂️</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pagination <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// here! 🙋‍♂️</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>이제 table 인스턴스에 이를 주입시켜주면, table 인스턴스가 알아서 Pagiantion을 잘 적용해줄 것이다.</p>\n<blockquote>\n<p>✅ 참고로, <a href=\"https://github.com/TanStack/table/discussions/2029#discussioncomment-4860455\" target=\"_blank\" rel=\"nofollow\">initialState</a>도 존재하는데, 제일 처음 렌더링 될 때 초기값을 지정해줄 수 있다.<br>\n하지만, state와 initialState를 함께쓰면, state가 initialState를 overwrite해버린다.<br>\n즉, state 기준으로 적용되는 것이다.</p>\n</blockquote>\n<br/>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<p>확실히 편한 건, client-side이다.<br>\ntable 인스턴스만 생성하면, 이후엔 tanstack-table이 알아서 반영해주기 때문이다.</p>\n<p>하지만, 엄청 큰 대량의 데이터를 테이블에 주입시켜야한다면,<br>\n한 번에 20만개의 데이터를 가져오는건 네트워크도, 테이블 내 성능도 좋지 못하다.</p>\n<p>실제로 어떠한 메모이제이션도 적용하지 않은 채, Tanstack-table을 사용해서 pageSize를 200개로 지정해 렌더링 해봤다.<br>\n검색기능으로 테이블 내 데이터를 조회하려고 할 때, 버벅임이 발생했다.</p>\n<p>input의 value를 입력할 때마다, table이 계속 리렌더링 되었던 것이다.<br>\n이때, 총 받아온 데이터가 1000개라면, 1000개가 주입된 테이블 인스턴스가<br>\n매 리렌더링 될 때마다 useReactTable hooks이 실행됐을 것이다.</p>\n<br/>\n<p>이번 글을 작성하면서, 나는 최대한 client-side가 아닌 server-side로 적용할 것 같다.<br>\n기회가 된다면 회사에 구현되어있는 것도 변경할 예정이다.<br>\n이유는 최대한 클라이언트를 가볍게 가져가고 싶다.</p>\n<br/>\n<h2 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h2>\n<p><a href=\"https://tanstack.com/table/latest/docs/guide/pagination\" target=\"_blank\" rel=\"nofollow\">Pagination Guide</a></p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#server-side-pagination\">Server side pagination</a></p>\n<ul>\n<li><a href=\"#client-side-pagination\">client side pagination</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#server-side-pagination-1\">server side pagination</a></p>\n<ul>\n<li><a href=\"#1-getpaginationrowmodel-%EC%A0%9C%EA%B1%B0--manualpagiantion-%EC%B6%94%EA%B0%80\">1. getPaginationRowModel 제거 → manualPagiantion 추가</a></li>\n<li><a href=\"#2-page-count%ED%8E%98%EC%9D%B4%EC%A7%80-%EC%88%98%EC%99%80-row-count%ED%96%89%EC%9D%98-%EC%88%98-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\">2. Page Count(페이지 수)와 Row Count(행의 수) 추가하기</a></li>\n<li><a href=\"#3-pagination-state\">3. Pagination State</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></p>\n</li>\n</ul>","frontmatter":{"title":"Tanstack-table pagination server-side로 구현하기","summary":"공식문서를 참고하며..","date":"2024.06.07.","categories":["개발"]}}}]}},"pageContext":{"slug":"/blog/2024/6/7/tanstack-table-server-side/"}},"staticQueryHashes":["1629908903"]}