{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2024/9/28/tanstack-table-row-selection/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f9a4ff756f32875d4c1ccfdb885883e2/d71bc/img.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRtwAAABXRUJQVlA4INAAAABwBQCdASoUABQAPtFgqE+oJSOiKAgBABoJZQC90d3Le3zAA8gXtICZ4v2EaEuAoZNxsR4AAP7qkNzjMxtfojW4kkicRgTMcVrU67kxVJKHHWoLwjD11LGrKjLAQ9MFXQQx1XMdoJYl3vQBzcJxwCLO7OpNlpb3jHjYrsX5vn1db20at0jBFKr8B3NW8DDGGjB20T0GmVCLRTxkbvBZOaT6VZgiKt3Zeb06KTCtCuxqWLCnmMPzF5IfOAeJXYrgTg+Hy3ojyh7aOdqgQxjwAAAA'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f9a4ff756f32875d4c1ccfdb885883e2/a59e9/img.webp 192w,\n/static/f9a4ff756f32875d4c1ccfdb885883e2/0ca9f/img.webp 384w,\n/static/f9a4ff756f32875d4c1ccfdb885883e2/dc9b9/img.webp 768w,\n/static/f9a4ff756f32875d4c1ccfdb885883e2/d71bc/img.webp 1024w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f9a4ff756f32875d4c1ccfdb885883e2/a59e9/img.webp 192w,\n/static/f9a4ff756f32875d4c1ccfdb885883e2/0ca9f/img.webp 384w,\n/static/f9a4ff756f32875d4c1ccfdb885883e2/dc9b9/img.webp 768w,\n/static/f9a4ff756f32875d4c1ccfdb885883e2/d71bc/img.webp 1024w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f9a4ff756f32875d4c1ccfdb885883e2/dc9b9/img.webp\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><a href=\"https://geuni620.github.io/blog/2024/6/7/tanstack-table-server-side/\" target=\"_blank\" rel=\"nofollow\">이전 글에서도 언급했지만</a>, Tanstack-table을 페이지네이션을 client-side와 server-side 모두 적용할 수 있다.<br>\nserver-side를 알게 된 이후, 최근까진 Tanstack-table을 사용해야할 경우 모두 server-side로 구현했다.</p>\n<p>일단, 서버에 의존적이라는게 나는 오히려 좋았다.<br>\n자주 요청을 보내더라도, 보여줘야할 양 만큼만 가져오는게 마음에 든다.<br>\n하지만 이번에 새롭게 배포한 기능에선 예상지 못한 이슈가 발생했는데, 다음과 같다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/678571376300adb74c86611086f18d0d/d76be/problem.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 22.395833333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAsklEQVQY033MPW/CMBSF4fz/f9ROqFM7MLBVKpVSEuI4CXYcAhh/3LdKYUIqR3p07l1OEVImn2fs+xq12XIsS5IIEYgC4YHwXBFSwjuLeX2hW71h1x9kOyCjIZoBcRam8c6C+59MI4WPkcuhx28/mXtNtAeys6TREMztXsbkmWXsdETqkoIlweO/v3DVjrmpOTcVohVx0Fw7RehaclP9te9aUtuQVU3oNRetbn+7J+1/+AUFLDL+9ocylwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/678571376300adb74c86611086f18d0d/a59e9/problem.webp 192w,\n/static/678571376300adb74c86611086f18d0d/0ca9f/problem.webp 384w,\n/static/678571376300adb74c86611086f18d0d/dc9b9/problem.webp 768w,\n/static/678571376300adb74c86611086f18d0d/e2c2f/problem.webp 1152w,\n/static/678571376300adb74c86611086f18d0d/f3efb/problem.webp 1536w,\n/static/678571376300adb74c86611086f18d0d/1edc1/problem.webp 2028w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/678571376300adb74c86611086f18d0d/3b721/problem.png 192w,\n/static/678571376300adb74c86611086f18d0d/66595/problem.png 384w,\n/static/678571376300adb74c86611086f18d0d/fe486/problem.png 768w,\n/static/678571376300adb74c86611086f18d0d/d2d74/problem.png 1152w,\n/static/678571376300adb74c86611086f18d0d/e8464/problem.png 1536w,\n/static/678571376300adb74c86611086f18d0d/d76be/problem.png 2028w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/678571376300adb74c86611086f18d0d/fe486/problem.png\"\n            alt=\"problem\"\n            title=\"problem\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ol>\n<li>1페이지에서 원하는 데이터를 체크박스에 체크했다.</li>\n<li>다른 페이지에서 데이터를 선택하기 위해, 페이지를 이동했다. 2페이지로 갔다고 가정해보자</li>\n<li>2페이지에서 원하는 데이터를 선택했다.</li>\n</ol>\n<p>그리고 확인을 누르면, 1페이지에서 선택한 데이터가 유지되지 않는 것이다.</p>\n<p>페이지네이션이 서버에 의존하고 있어서,<br>\n1페이지에서 2페이지로 넘어갔을 때, 2페이지에 해당 하는 양만큼 새롭게 데이터를 불러오고,<br>\n이때 1페이지에서 선택한 데이터는 날아가버린다.</p>\n<br/>\n<p><strong>어떻게하면 페이지네이션 변경에 따라 데이터를 유지시킬 수 있을까?</strong></p>\n<p>Tanstack-table을 사용했을 때, 크게 두 가지 방법이 있는 것 같다.<br>\n<strong>첫 번째는</strong>, useReactTable의 <code class=\"language-text\">onRowSelectionChange</code> 메서드에 custom한 함수를 등록하는 방법,<br>\n<strong>두 번째는</strong>, rowSelection에 따라 useEffect로 데이터를 동기화시키는 것이다.</p>\n<p>각각 살펴보자.</p>\n<br/>\n<h3 id=\"1-onrowselectionchange\" style=\"position:relative;\"><a href=\"#1-onrowselectionchange\" aria-label=\"1 onrowselectionchange permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. onRowSelectionChange</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> DataTable <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>TData<span class=\"token punctuation\">,</span> TValue<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  data<span class=\"token punctuation\">,</span>\n  columns<span class=\"token punctuation\">,</span>\n  total<span class=\"token punctuation\">,</span>\n  pagination<span class=\"token punctuation\">,</span>\n  onPaginationChange<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> DataTableProps<span class=\"token operator\">&lt;</span>TData<span class=\"token punctuation\">,</span> TValue<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>rowSelection<span class=\"token punctuation\">,</span> setRowSelection<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>selectedRowData<span class=\"token punctuation\">,</span> setSelectedRowData<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>TData<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> onRowSelectionChangeHandler<span class=\"token operator\">:</span> OnChangeFn<span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    updaterOrValue<span class=\"token operator\">:</span> Updater<span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> updateRowSelection <span class=\"token operator\">=</span>\n      <span class=\"token keyword\">typeof</span> updaterOrValue <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span>\n        <span class=\"token operator\">?</span> <span class=\"token function\">updaterOrValue</span><span class=\"token punctuation\">(</span>rowSelection<span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> updaterOrValue<span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">setRowSelection</span><span class=\"token punctuation\">(</span>updateRowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> selectedRows <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>updateRowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> isSelected<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isSelected<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> index <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          acc<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> acc<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> TData<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">setSelectedRowData</span><span class=\"token punctuation\">(</span>selectedRows<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    manualPagination<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    rowCount<span class=\"token operator\">:</span> total<span class=\"token punctuation\">,</span>\n    onPaginationChange<span class=\"token punctuation\">,</span>\n    onRowSelectionChange<span class=\"token operator\">:</span> onRowSelectionChangeHandler<span class=\"token punctuation\">,</span>  <span class=\"token comment\">// here 🙋‍♂️</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pagination<span class=\"token punctuation\">,</span> rowSelection <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><a href=\"https://tanstack.com/table/v8/docs/guide/row-selection#manage-row-selection-state\" target=\"_blank\" rel=\"nofollow\">Tanstack-table에서 체크박스를 관리할 수 있는 별도의 기능을 제공해주는데</a> rowSelection을 이용하는 것이다.</p>\n<p>rowSelection state를 생성하고 onRowSelectionChange메서드에 setRowSelection을 등록하면,<br>\n체크박스를 체크할 때마다 rowSelection 상태가 업데이트된다.</p>\n<p>이를 custom해서, onRowSelectionChangeHandler를 만들었다.<br>\nrowSelection도 업데이트하면서, 체크된 rowSelection에 해당하는 행 데이터도 selectedRowData에 담아준다.</p>\n<br/>\n<p><strong>만약 getRowId를 설정했다면 조금 변경이 필요하다.</strong><br>\n<a href=\"https://tanstack.com/table/latest/docs/api/core/table#getrowid\" target=\"_blank\" rel=\"nofollow\">어떠한 getRowId도 설정하지 않은 상태라면, Tanstack-table에선, rowId를 index값으로 사용한다.</a></p>\n<p>페이지 1에서 두 번째, 세 번째 체크박스를 체크하고, 2페이지로 이동했을 때, rowId가 설정되지 않았다면,<br>\n해당 2페이지에서도 두 번째, 세 번째 체크박스 데이터는 1페이지에서와 동일한 rowId를 가지게 된다.</p>\n<p><img src=\"/7278e71a26e9ac6837cfa89959b230ec/get-row-id.gif\" alt=\"페이지를 이동했는데, 기존 체크한 체크박스가 남아있다.\"></p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">  <span class=\"token keyword\">const</span> onRowSelectionChangeHandler<span class=\"token operator\">:</span> OnChangeFn<span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    updaterOrValue<span class=\"token operator\">:</span> Updater<span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> updateRowSelection <span class=\"token operator\">=</span>\n      <span class=\"token keyword\">typeof</span> updaterOrValue <span class=\"token operator\">===</span> <span class=\"token string\">'function'</span>\n        <span class=\"token operator\">?</span> <span class=\"token function\">updaterOrValue</span><span class=\"token punctuation\">(</span>rowSelection<span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> updaterOrValue<span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">setRowSelection</span><span class=\"token punctuation\">(</span>updateRowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">const</span> selectedRows <span class=\"token operator\">=</span> Object<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span>updateRowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span>acc<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">,</span> isSelected<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>isSelected<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">const</span> rowIndex <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">findIndex</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> row<span class=\"token punctuation\">.</span>inspectionCode <span class=\"token operator\">===</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// rowIndex를 찾아서 넣어줌</span>\n          <span class=\"token keyword\">const</span> index <span class=\"token operator\">=</span> <span class=\"token function\">Number</span><span class=\"token punctuation\">(</span>rowIndex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n          acc<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">return</span> acc<span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token keyword\">as</span> TData<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">setSelectedRowData</span><span class=\"token punctuation\">(</span>selectedRows<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    manualPagination<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    rowCount<span class=\"token operator\">:</span> total<span class=\"token punctuation\">,</span>\n    onPaginationChange<span class=\"token punctuation\">,</span>\n    onRowSelectionChange<span class=\"token operator\">:</span> onRowSelectionChangeHandler<span class=\"token punctuation\">,</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pagination<span class=\"token punctuation\">,</span> rowSelection <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    getRowId<span class=\"token punctuation\">,</span> <span class=\"token comment\">// props로 getRowId 추가</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>getRowId를 추가했다면, rowIndex를 찾아서, 그에 맞는 rowIndex를 넣어주면 된다.<br>\ngetRowId를 custom하게 만들지 않고, useReactTable에 주입하는 data의 key값과 동일하다면, filter를 써도 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> onRowSelectionChangeHandler<span class=\"token operator\">:</span> OnChangeFn<span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>\n    updaterOrValue<span class=\"token operator\">:</span> Updater<span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">//...</span>\n\n    <span class=\"token keyword\">const</span> selectedRows <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>\n      <span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> updateRowSelection<span class=\"token punctuation\">[</span>row<span class=\"token punctuation\">.</span>inspectionCode<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">setSelectedRowData</span><span class=\"token punctuation\">(</span>selectedRows<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br/>\n<h3 id=\"2-rowselection--useeffect\" style=\"position:relative;\"><a href=\"#2-rowselection--useeffect\" aria-label=\"2 rowselection  useeffect permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. rowSelection → useEffect</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> DataTable <span class=\"token operator\">=</span> <span class=\"token operator\">&lt;</span>TData<span class=\"token punctuation\">,</span> TValue<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  data<span class=\"token punctuation\">,</span>\n  columns<span class=\"token punctuation\">,</span>\n  total<span class=\"token punctuation\">,</span>\n  pagination<span class=\"token punctuation\">,</span>\n  onPaginationChange<span class=\"token punctuation\">,</span>\n  getRowId<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> DataTableProps<span class=\"token operator\">&lt;</span>TData<span class=\"token punctuation\">,</span> TValue<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>rowSelection<span class=\"token punctuation\">,</span> setRowSelection<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>RowSelectionState<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>selectedRowData<span class=\"token punctuation\">,</span> setSelectionRowData<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>InventoryInspectionResponse<span class=\"token punctuation\">[</span><span class=\"token string\">'data'</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> table <span class=\"token operator\">=</span> <span class=\"token function\">useReactTable</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    data<span class=\"token punctuation\">,</span>\n    columns<span class=\"token punctuation\">,</span>\n    getCoreRowModel<span class=\"token operator\">:</span> <span class=\"token function\">getCoreRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    manualPagination<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    rowCount<span class=\"token operator\">:</span> total<span class=\"token punctuation\">,</span>\n    onPaginationChange<span class=\"token punctuation\">,</span>\n    onRowSelectionChange<span class=\"token operator\">:</span> setRowSelection<span class=\"token punctuation\">,</span>\n    state<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> pagination<span class=\"token punctuation\">,</span> rowSelection <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    getRowId<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">handleSelectionState</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>selections<span class=\"token operator\">:</span> RowSelectionState<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token function\">setSelectionRowData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>prev<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        Object<span class=\"token punctuation\">.</span><span class=\"token function\">keys</span><span class=\"token punctuation\">(</span>selections<span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>\n            <span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n              table<span class=\"token punctuation\">.</span><span class=\"token function\">getSelectedRowModel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>rowsById<span class=\"token punctuation\">[</span>key<span class=\"token punctuation\">]</span><span class=\"token operator\">?.</span>original <span class=\"token operator\">||</span>\n              prev<span class=\"token punctuation\">.</span><span class=\"token function\">find</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> row<span class=\"token punctuation\">.</span>inspectionCode <span class=\"token operator\">===</span> key<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">handleSelectionState</span><span class=\"token punctuation\">(</span>rowSelection<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>rowSelection<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>useEffect는 rowSelection을 기반으로 selectedRowData를 동기화시켜주는 것이다.<br>\n간단하면서 쉬운 방법이라고 생각된다.</p>\n<br/>\n<h3 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h3>\n<p>두 가지 방법 중 어떠한 방법을 사용할 지는 아직 미정이다.<br>\n상황과 경우에 따라 다르겠지만, 나는 최대한 useEffect를 지양한다.</p>\n<p>그래서 첫 번째 방법을 고려해본 뒤, 복잡도가 너무 높아지고, 공통으로 작성된 Tanstack-table의 수정이 많아진다면,<br>\n두 번째 방법을 사용할 것 같다.</p>\n<br/>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<p><a href=\"https://github.com/TanStack/table/discussions/2155#discussioncomment-10056182\" target=\"_blank\" rel=\"nofollow\">get access to selected row data from outside table component #2155</a></p>","tableOfContents":"<ul>\n<li><a href=\"#1-onrowselectionchange\">1. onRowSelectionChange</a></li>\n<li><a href=\"#2-rowselection--useeffect\">2. rowSelection → useEffect</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></li>\n</ul>","frontmatter":{"title":"Tanstack-table 체크박스로 선택한 행 데이터 추출하기","summary":"server side pagination일 경우, pagination index 변경에 따라 선택한 체크박스의 행 데이터를 추출해보자.","date":"2024.09.28.","categories":["개발"]}}}]}},"pageContext":{"slug":"/blog/2024/9/28/tanstack-table-row-selection/"}},"staticQueryHashes":["1629908903"]}