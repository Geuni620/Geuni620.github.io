{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2024/4/7/use-query-post/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ec7c69f5a49722e0b11ab8a72bb30ade/d71bc/img.webp\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/webp;base64,UklGRu4AAABXRUJQVlA4IOIAAADwBQCdASoUABQAPtFgqU+oJSOiKAgBABoJZACdL9ZHJjwPdWN2UlzNrRfuO04VGxJ2vgzBnk46AAD+eSDdkAbOIAw2NqQlF9fntFGwNodEG1mxWDZ3j6QUNoZ37KCoYFMXl+7Nqr20r2e+EVNROxmZvcXzcdDqBLocVhRU+NJmIVVKRsZBzto32u2Wq+NnmaS+2egzxGHdxsMs8M04NiFLP22IUzkgweHVG8lgeMTkg4PQ74s0dup+rR/qKJM27vXVulfbIsUdojRSxz3Mw/J+4RQPQjCsrKNOiQPwJZFHAAAA'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ec7c69f5a49722e0b11ab8a72bb30ade/a59e9/img.webp 192w,\n/static/ec7c69f5a49722e0b11ab8a72bb30ade/0ca9f/img.webp 384w,\n/static/ec7c69f5a49722e0b11ab8a72bb30ade/dc9b9/img.webp 768w,\n/static/ec7c69f5a49722e0b11ab8a72bb30ade/d71bc/img.webp 1024w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ec7c69f5a49722e0b11ab8a72bb30ade/a59e9/img.webp 192w,\n/static/ec7c69f5a49722e0b11ab8a72bb30ade/0ca9f/img.webp 384w,\n/static/ec7c69f5a49722e0b11ab8a72bb30ade/dc9b9/img.webp 768w,\n/static/ec7c69f5a49722e0b11ab8a72bb30ade/d71bc/img.webp 1024w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/webp\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ec7c69f5a49722e0b11ab8a72bb30ade/dc9b9/img.webp\"\n            alt=\"img\"\n            title=\"img\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><a href=\"https://github.com/Geuni620/api-get-body\" target=\"_blank\" rel=\"nofollow\">예시 소스코드</a></p>\n<h3 id=\"배경\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%EA%B2%BD\" aria-label=\"배경 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배경</h3>\n<p>보통의 검색/조회를 할 땐, API Method로 GET을 사용한다.<br>\n하지만 이번엔 POST로 조회를 해야하는 경우가 생겼다.<br>\n검색조건으로 보내야하는 query의 길이가 길어서,<br>\n허용되는 최대 URL 길이를 넘어갈 것으로 예상되었기 때문이다.</p>\n<p><a href=\"https://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers\" target=\"_blank\" rel=\"nofollow\">참고</a><br>\n위 참고링크를 확인해보면, 대체로 2000자 이내를 권장하는 듯하다.</p>\n<br/>\n<h3 id=\"mutateasync\" style=\"position:relative;\"><a href=\"#mutateasync\" aria-label=\"mutateasync permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MutateAsync</h3>\n<p>처음 나의 생각은 다음과 같았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. 검색조건을 state에 담자\n2. 담아준 state를 POST로 보내자\n3. 반환받은 데이터를 MutateAsync로 처리하자.</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> inputRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> tableList <span class=\"token operator\">=</span> <span class=\"token function\">useTableDataGetMutation</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 초기 렌더링 시, 결과물을 불러오기 위함</span>\n    tableList<span class=\"token punctuation\">.</span><span class=\"token function\">mutateAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> searchCondition<span class=\"token operator\">:</span> <span class=\"token string\">''</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onSubmit</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> FormEvent<span class=\"token operator\">&lt;</span>HTMLFormElement<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>inputRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      tableList<span class=\"token punctuation\">.</span><span class=\"token function\">mutateAsync</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> searchCondition<span class=\"token operator\">:</span> inputRef<span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span>value <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>h-screen w-screen<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mx-auto w-[900px] pb-20 pt-10<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span>\n          <span class=\"token attr-name\">onSubmit</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onSubmit<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mb-2 flex items-center justify-between gap-2<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Input</span></span>\n            <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>inputRef<span class=\"token punctuation\">}</span></span> <span class=\"token comment\">// 1. 검색조건은 state에 담아주자</span>\n            <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>w-[20%]<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Task name<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TableComponents</span></span> <span class=\"token attr-name\">data</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>tableList<span class=\"token punctuation\">.</span>data<span class=\"token operator\">?.</span>list <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\"> // 3. 반환받은 데이터를 MutateAsync로 처리하자.\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>위와 같이 작성했을 때 검색 결과에 대한, 해당 테이블 데이터는 잘 출력된다.</li>\n<li>이때까진 큰 문제없다고 생각했다.</li>\n</ul>\n<br/>\n<h3 id=\"구독상태가-아니다\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%EB%8F%85%EC%83%81%ED%83%9C%EA%B0%80-%EC%95%84%EB%8B%88%EB%8B%A4\" aria-label=\"구독상태가 아니다 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구독상태가 아니다.</h3>\n<p>위 기능을 구현하고, 잘 된다고 안심하고 있었다.<br>\n하지만, 곧 문제가 발생했다.</p>\n<p>위 mutateAsync의 가장 큰 단점은 <strong>구독상태가 아니라는 점이다.</strong><br>\n보통 useQuery를 사용하면, queryKey를 기반으로 구독상태가 되어,<br>\nqueryKey가 변경될 때마다, 데이터를 다시 가져온다.<br>\n하지만 mutateAsync는 그렇지 않다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3873d63f58fb6bbd80d0748428ed913b/f8250/query-dev-tool.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.708333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABH0lEQVQoz4WRDW+EIAyG/f9/czt3eogi8lFQ3+XtjcUty46kaUvbp4V253mC5zhPiBQcx4F2GGvxq331f9917aLWHSFG1FqRRZByxr7vkFKQUkYp5YdPm7ltgAa/ACtijAzBGIu+v2tCSgn3YYSIqO/9hnF8KOglcAtBOzu3Ypqs2jEmzPOCnJ9TLouDmaw2ov9yQkII4xQsIMjOi9qEDOMDwzAq+M8J24cyGELEeRxa8PZ+Uzght/5DwSzg9IwzRrkuhafj30ipumEC6fOJk53187koa2fVzHGrx8NYbCFqfs6CUqoKF9ZNdsFoFhjr4EOC3+KzQalIUpClfNspF9XMcz7ArUH16jetN3ZBl6VqUUyikrKo/5/IV5OrtIafkFe/NC6ONYsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3873d63f58fb6bbd80d0748428ed913b/a59e9/query-dev-tool.webp 192w,\n/static/3873d63f58fb6bbd80d0748428ed913b/0ca9f/query-dev-tool.webp 384w,\n/static/3873d63f58fb6bbd80d0748428ed913b/dc9b9/query-dev-tool.webp 768w,\n/static/3873d63f58fb6bbd80d0748428ed913b/e2c2f/query-dev-tool.webp 1152w,\n/static/3873d63f58fb6bbd80d0748428ed913b/f3efb/query-dev-tool.webp 1536w,\n/static/3873d63f58fb6bbd80d0748428ed913b/c3387/query-dev-tool.webp 2872w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3873d63f58fb6bbd80d0748428ed913b/3b721/query-dev-tool.png 192w,\n/static/3873d63f58fb6bbd80d0748428ed913b/66595/query-dev-tool.png 384w,\n/static/3873d63f58fb6bbd80d0748428ed913b/fe486/query-dev-tool.png 768w,\n/static/3873d63f58fb6bbd80d0748428ed913b/d2d74/query-dev-tool.png 1152w,\n/static/3873d63f58fb6bbd80d0748428ed913b/e8464/query-dev-tool.png 1536w,\n/static/3873d63f58fb6bbd80d0748428ed913b/f8250/query-dev-tool.png 2872w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3873d63f58fb6bbd80d0748428ed913b/fe486/query-dev-tool.png\"\n            alt=\"mutateAsync로 요청시 dev tool에 아무것도 구독되지 않는다.\"\n            title=\"mutateAsync로 요청시 dev tool에 아무것도 구독되지 않는다.\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">mutateAsync로 요청시 dev tool에 아무것도 구독되지 않는다.</figcaption>\n  </figure></p>\n<br/>\n<p>여기서 만약 이런 요구사항이 있다고 가정해보자.</p>\n<blockquote>\n<p>Task가 완료되면, 체크박스를 클릭하여 완료처리를 하고, 체크된 Task의 날짜가 기록되어야한다.</p>\n</blockquote>\n<br/>\n<h3 id=\"날짜-데이터-추가하기\" style=\"position:relative;\"><a href=\"#%EB%82%A0%EC%A7%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\" aria-label=\"날짜 데이터 추가하기 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>날짜 데이터 추가하기</h3>\n<blockquote>\n<p>일이 커져버렸다.<br>\nJSON파일을 fs를 이용해 읽고 구현하려고 했는데, 욕심이 커져서 데이터를 저장할 공간이 필요해졌다.\n이전이라면 prisma를 사용했을 것이다.<br>\n하지만, 최근에 <a href=\"https://supabase.com/\" target=\"_blank\" rel=\"nofollow\">supabase</a>를 알고 난 뒤부턴 여기부터 뒤적거리곤 한다.</p>\n</blockquote>\n<br/>\n<p>잠깐의 셋업을 거친 뒤 다음과 같은 기능을 추가했다.</p>\n<ol>\n<li>페이지에 접속하면, mutateAsync에 의해, 전체 데이터를 가져옴</li>\n<li>검색조건을 입력하면 mutateAsync에 의해, 검색된 데이터를 가져옴</li>\n<li>체크박스를 클릭하고, Done Button을 클릭하면, task가 업데이트 되고, <strong>날짜도 업데이트 되어야함</strong></li>\n</ol>\n<p>하지만, 여기서 날짜 데이터는 업데이트 되지 않는다.<br>\n위에서 언급했듯이, <strong>mutateAsync는 구독상태가 아니기 때문에,</strong> queryKey가 업데이트 되어도 알 수 있는 방법이 없다.</p>\n<p><img src=\"/7fe73be01eb4e0e55f869dda2acc2b5e/no-change-date.gif\" alt=\"\"></p>\n<p>위 GIF를 보면, Done Button을 클릭했을 때, 날짜가 업데이트 되지 않는 것을 확인할 수 있다.<br>\n하지만 새로고침 이후엔 날짜가 업데이트 되었다.<br>\n<code class=\"language-text\">2024-04-07 09:22:37</code> → <code class=\"language-text\">2024-04-07 09:55:59</code></p>\n<br/>\n<h3 id=\"usequery는-get-method에만-사용해야할까\" style=\"position:relative;\"><a href=\"#usequery%EB%8A%94-get-method%EC%97%90%EB%A7%8C-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC%ED%95%A0%EA%B9%8C\" aria-label=\"usequery는 get method에만 사용해야할까 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useQuery는 GET Method에만 사용해야할까?</h3>\n<blockquote>\n<p>내가 직면한 문제를 해결하기 위해 POST Method에는 useQuery를 사용하면 안되는걸까?</p>\n</blockquote>\n<p>react-query를 처음 배울 때, useQuery는 대체로 GET Method에 사용하고,<br>\nuseMutation은 POST와 PATCH, PUB, DELETE 등에 사용한다고 배웠던 것 같다.</p>\n<p>react-query의 메인테이너인 <a href=\"https://github.com/tannerlinsley\" target=\"_blank\" rel=\"nofollow\">Tanner Linsley</a>는 다음과 같은 <a href=\"https://github.com/TanStack/query/discussions/801#discussioncomment-87385\" target=\"_blank\" rel=\"nofollow\">댓글</a>을 남겼다.</p>\n<blockquote>\n<p>useQuery for reading data<br>\n- 데이터를 읽기 위해선, useQuery를</p>\n<p>useMutation for creating, changing, or deleting data<br>\n- 데이터를 생성, 변경, 삭제하기 위해선, useMutation을</p>\n</blockquote>\n<p>하지만, 생각해보면, 그 누구도 useQuery는 <strong>GET Method에만 사용해야한다고 말하지 않았다.</strong></p>\n<p>즉, HTTP Method에 따라 useQuery와 useMutation을 나누는 것은 옳지 않다고 생각이 들었다.<br>\n참고로 <strong>POST 역시 데이터를 읽을 수 있다.</strong></p>\n<br/>\n<p>그럼 해보자, useQuery로 잘 돌아가는지 테스트해보자.</p>\n<br/>\n<h3 id=\"mutateasync--usequery로-변경\" style=\"position:relative;\"><a href=\"#mutateasync--usequery%EB%A1%9C-%EB%B3%80%EA%B2%BD\" aria-label=\"mutateasync  usequery로 변경 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>mutateAsync → useQuery로 변경</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> inputRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">/**\n * 변경!!\n  const tableList = useTableDataGetMutation();\n*/</span>\n\n<span class=\"token comment\">/**\n * 제거!!\n  useEffect(() => {\n    // 초기 렌더링 시, 결과물을 불러오기 위함\n    tableList.mutateAsync({ searchCondition: '' });\n  }, []);\n\n  const onSubmit = (event: FormEvent&lt;HTMLFormElement>) => {\n    event.preventDefault();\n\n    if (inputRef.current) {\n      tableList.mutateAsync({ searchCondition: inputRef.current.value });\n    }\n  };\n*/</span>\n\n  <span class=\"token keyword\">const</span> tableList <span class=\"token operator\">=</span> <span class=\"token function\">useTableDataGetQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    searchCondition<span class=\"token operator\">:</span> inputRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">?.</span>value <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onSubmit</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> FormEvent<span class=\"token operator\">&lt;</span>HTMLFormElement<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    tableList<span class=\"token punctuation\">.</span><span class=\"token function\">refetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token comment\">// ...</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>먼저 useTableDataMutation의 hooks 명칭을 변경했다.<br>\n( useTableDataGetMutation → useTableDataGetQuery )</p>\n<p>그리고 searchCondition을 useTableDataGetQuery의 인자로 넘겨주었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token comment\">/**\nexport const useTableDataGetMutation = () => {\n  const queryClient = useQueryClient();\n\n  const tableList = useMutation({\n    mutationFn: getTableDataViaPOST,\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: ['table'],\n      });\n    },\n  });\n\n  return tableList;\n};\n*/</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useTableDataGetQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> searchCondition <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> TableDataProps<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">queryFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getTableDataViaPOST</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> searchCondition <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'table'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// Error 발생</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>useTableDataGetQuery는 useMutation에서 useQuery로 변경하고,<br>\n넘겨받은 searchCondition을 queryFn에 넘겨주었다.</p>\n<p>하지만, 여기서 에러가 발생했다.<br>\n<small>업무를 진행하면서 발생하지 않았던 에러인데, 예시를 만들면서 발생했다.</small></p>\n<p>업무에선 react-query V3를 사용했고, 예시를 만드는 현재는 tanstack-query V5로 진행했다.<br>\n그리고, 현재는 tanstack-qeury에서 권장하는 <a href=\"https://tanstack.com/query/v4/docs/eslint/eslint-plugin-query\" target=\"_blank\" rel=\"nofollow\">eslint</a>를 설정했다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/07c06f24e784db7a851e75d77b6a441c/c54b3/query-eslint-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 10.9375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAYElEQVQI123FSw5EQBRAUdsRnRZKkRRVXrfnE2Jm/1u5goSJwcmJMhkw0lP8Riqdsf+RzHeYoPem7c+tDORBSZ2QBuXru0u4/jgh8stGfZhXCp1InBCXDbFtnt+UL2zNDkvoQuARZKsFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/07c06f24e784db7a851e75d77b6a441c/a59e9/query-eslint-error.webp 192w,\n/static/07c06f24e784db7a851e75d77b6a441c/0ca9f/query-eslint-error.webp 384w,\n/static/07c06f24e784db7a851e75d77b6a441c/dc9b9/query-eslint-error.webp 768w,\n/static/07c06f24e784db7a851e75d77b6a441c/e2c2f/query-eslint-error.webp 1152w,\n/static/07c06f24e784db7a851e75d77b6a441c/f3efb/query-eslint-error.webp 1536w,\n/static/07c06f24e784db7a851e75d77b6a441c/8a15b/query-eslint-error.webp 1678w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/07c06f24e784db7a851e75d77b6a441c/3b721/query-eslint-error.png 192w,\n/static/07c06f24e784db7a851e75d77b6a441c/66595/query-eslint-error.png 384w,\n/static/07c06f24e784db7a851e75d77b6a441c/fe486/query-eslint-error.png 768w,\n/static/07c06f24e784db7a851e75d77b6a441c/d2d74/query-eslint-error.png 1152w,\n/static/07c06f24e784db7a851e75d77b6a441c/e8464/query-eslint-error.png 1536w,\n/static/07c06f24e784db7a851e75d77b6a441c/c54b3/query-eslint-error.png 1678w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/07c06f24e784db7a851e75d77b6a441c/fe486/query-eslint-error.png\"\n            alt=\"query eslint error\"\n            title=\"query eslint error\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>위 이미지를 요약해보자면 다음과 같다.</p>\n<ul>\n<li>\n<p>queryFn에 사용되는 모든 변수는 쿼리 키에 추가되어야한다.</p>\n<ul>\n<li>이렇게 하면 쿼리가 독립적으로 캐시되고, 변수가 변경될 때 자동으로 다시 가져올 수 있다.</li>\n<li><a href=\"https://tanstack.com/query/latest/docs/eslint/exhaustive-deps\" target=\"_blank\" rel=\"nofollow\">Exhaustive dependencies for query keys</a></li>\n</ul>\n</li>\n</ul>\n<p>즉, queryKey에 searchCondition을 추가해야한다.</p>\n<br/>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useTableDataGetQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> searchCondition <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> TableDataProps<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    <span class=\"token function-variable function\">queryFn</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getTableDataViaPOST</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> searchCondition <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    queryKey<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'table'</span><span class=\"token punctuation\">,</span> searchCondition<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// searchCondition을 queryKey에 추가</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>하지만 queryKey에 searchCondition을 추가하면,<br>\nsearchCondition이 변경될 때마다, submit 동작없이 데이터가 바로 변경된다.</p>\n<p>만약 검색 조건이 여러 개라고 가정해보자. (select, checkbox 등등)<br>\nsearchCondition이 변경될 때마다 데이터를 가져오는 것은 비효율적이다.</p>\n<p>그래서 나는, onSubmit이 발생했을 때 데이터를 가져오길 바랐다.</p>\n<p>시나리오를 다음과 같이 세웠다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">1. useRef를 이용해서 input의 value 값을 가져온다.\n2. onSubmit이 발생했을 때, setState로 searchCondition을 변경한다.\n3. tableList.refetch()를 호출한다.</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> FormEvent<span class=\"token punctuation\">,</span> useRef<span class=\"token punctuation\">,</span> useState <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> TableComponents <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@/components/table'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Input <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@/components/ui/input'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useTableDataGetQuery <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@/hook/useTableDataGetQuery'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> inputRef <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useRef</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>HTMLInputElement<span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>searchCondition<span class=\"token punctuation\">,</span> setSearchCondition<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">useState</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span><span class=\"token builtin\">string</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> tableList <span class=\"token operator\">=</span> <span class=\"token function\">useTableDataGetQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    searchCondition<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onSubmit</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>event<span class=\"token operator\">:</span> FormEvent<span class=\"token operator\">&lt;</span>HTMLFormElement<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">setSearchCondition</span><span class=\"token punctuation\">(</span>inputRef<span class=\"token punctuation\">.</span>current<span class=\"token operator\">?.</span>value <span class=\"token operator\">||</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 2. onSubmit이 발생했을 때, setState로 searchCondition을 변경한다.</span>\n    tableList<span class=\"token punctuation\">.</span><span class=\"token function\">refetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 3. tableList.refetch()를 호출한다.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>h-screen w-screen<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mx-auto w-[900px] pb-20 pt-10<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>form</span>\n          <span class=\"token attr-name\">onSubmit</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onSubmit<span class=\"token punctuation\">}</span></span>\n          <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>mb-2 flex items-center justify-between gap-2<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Input</span></span>\n            <span class=\"token attr-name\">ref</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>inputRef<span class=\"token punctuation\">}</span></span> <span class=\"token comment\">// 1. useRef를 이용해서 input의 value 값을 가져온다.</span>\n            <span class=\"token attr-name\">className</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>w-[20%]<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>text<span class=\"token punctuation\">\"</span></span>\n            <span class=\"token attr-name\">placeholder</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>Task name<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>form</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">TableComponents</span></span> <span class=\"token attr-name\">data</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>tableList<span class=\"token punctuation\">.</span>data<span class=\"token operator\">?.</span>list <span class=\"token operator\">||</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 변경하면, onSubmit이 발생했을 때만, 데이터를 가져온다.<br>\n그럼 이제 가장 초반에 언급한 문제를 다시 살펴보자.</p>\n<blockquote>\n<p>Task가 완료되면, 체크박스를 클릭하여 완료처리를 하고, 체크된 Task의 날짜가 기록되어야한다.</p>\n</blockquote>\n<br/>\n<p>useQuery로 변경했을 땐, 구독상태가 된다. queryKey가 변경될 때마다, 데이터를 가져올 것이다.</p>\n<p><img src=\"/26f684483cdd9c757807e958f9b57de7/change-date.gif\" alt=\"\"></p>\n<p>예상한대로, Done Button을 클릭했을 때, 날짜가 업데이트 되었다.</p>\n<br/>\n<h3 id=\"정리\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EB%A6%AC\" aria-label=\"정리 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정리</h3>\n<p>useQuery는 GET Method에만 사용해야한다는 것은 <strong>사실 내 고정관념이었다.</strong><br>\nuseQuery는 데이터를 읽어오기 위한 것이고, useMutation은 데이터를 변경, 삭제, 수정하기 위한 것이다.<br>\n즉, useQuery의 queryFn의 반환이 Promise이면 사용할 수 있다.</p>\n<br/>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<p><a href=\"https://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers\" target=\"_blank\" rel=\"nofollow\">What is the maximum length of a URL in different browsers?</a><br>\n<a href=\"https://github.com/TanStack/query/discussions/801\" target=\"_blank\" rel=\"nofollow\">react-query with axios post #801</a><br>\n<a href=\"https://github.com/TanStack/query/discussions/2751\" target=\"_blank\" rel=\"nofollow\">React-Query on post methods #2751</a></p>","tableOfContents":"<ul>\n<li><a href=\"#%EB%B0%B0%EA%B2%BD\">배경</a></li>\n<li><a href=\"#mutateasync\">MutateAsync</a></li>\n<li><a href=\"#%EA%B5%AC%EB%8F%85%EC%83%81%ED%83%9C%EA%B0%80-%EC%95%84%EB%8B%88%EB%8B%A4\">구독상태가 아니다.</a></li>\n<li><a href=\"#%EB%82%A0%EC%A7%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%B6%94%EA%B0%80%ED%95%98%EA%B8%B0\">날짜 데이터 추가하기</a></li>\n<li><a href=\"#usequery%EB%8A%94-get-method%EC%97%90%EB%A7%8C-%EC%82%AC%EC%9A%A9%ED%95%B4%EC%95%BC%ED%95%A0%EA%B9%8C\">useQuery는 GET Method에만 사용해야할까?</a></li>\n<li><a href=\"#mutateasync--usequery%EB%A1%9C-%EB%B3%80%EA%B2%BD\">mutateAsync → useQuery로 변경</a></li>\n<li><a href=\"#%EC%A0%95%EB%A6%AC\">정리</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></li>\n</ul>","frontmatter":{"title":"useQuery는 POST Method에 사용하면 안되는걸까?","summary":"검색기능을 위해 POST Method를 사용했던 이유","date":"2024.04.07.","categories":["개발"]}}}]}},"pageContext":{"slug":"/blog/2024/4/7/use-query-post/"}},"staticQueryHashes":["1629908903"]}