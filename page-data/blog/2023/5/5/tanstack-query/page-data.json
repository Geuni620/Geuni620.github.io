{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2023/5/5/tanstack-query/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<br>\n<hr>\n<br>\n<blockquote>\n<p>공부하고 학습한 내용을 토대로 작성해보겠습니다.<br>\ntanstack-query를 작성하며 query라고 편히 부르겠습니다.</p>\n</blockquote>\n<blockquote>\n<p>그리고 useQuery는 get만 해당한다고 보시면 될 거 같아요. 나머진 모두 Mutate입니다.<br>\nuseQuery &#x26; useMutation</p>\n</blockquote>\n<br>\n<h2 id=\"query-dev-tools\" style=\"position:relative;\"><a href=\"#query-dev-tools\" aria-label=\"query dev tools permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>query Dev tools</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// _app.page.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ReactQueryDevtools <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query-devtools'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> AppProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Head</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span>\n          <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span>\n          <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1, maximum-scale=1<span class=\"token punctuation\">\"</span></span>\n        <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">Head</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">QueryClientProvider</span></span> <span class=\"token attr-name\">client</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ThemeProvider</span></span> <span class=\"token attr-name\">theme</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CurrentPageIdProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GlobalStyle</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StaticPageLayout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Componednt</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">StaticPageLayout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">CurrentPageIdProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ReactQueryDevtools</span></span> <span class=\"token attr-name\">initialIsOpen</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ThemeProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">QueryClientProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>왼쪽 아래에 보면 꽃 모양 누르면 껐다가 켤 수 있어요.(빨간박스)</p>\n<ul>\n<li>query에선 devtools를 사용할 수 있어요.\n<ul>\n<li>옵션은 다양하게 있는데 default로 작성해뒀어요.</li>\n</ul>\n</li>\n<li>dev tools는 <code class=\"language-text\">NODE_ENV</code>가 Production으로 설정되었을 때는 표시되지 않아요.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b147f4b64d0cdd91a94d8d13e6f57947/b7f71/tanstack-query_dev_tools.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35.9375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyUlEQVQoz2N4/ez5/zv37v+/e+/B/ztEYpDa2/fu/7966/b/6zfu/L9x89b/6zdv/3/x8tV/hlBL6/9SGtb/pTWJwzJaNv8lVC3+6zn6/E+paPgfn1rxPzEt739ofPb/yJSC/wwC6lr/eUSU/nMIKxCFOUG0kMJ/XjGV/9LK+v8llHT/Syjq/RdX0PnPJij3n4FLSOE/t6gSyZhLRBFsALug/H92EC0k/59HVOk/A7eYElkG4sIMIC/AbARhig0UU9D7DzOUGi4EAIZf54FU14xCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b147f4b64d0cdd91a94d8d13e6f57947/a59e9/tanstack-query_dev_tools.webp 192w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/0ca9f/tanstack-query_dev_tools.webp 384w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/dc9b9/tanstack-query_dev_tools.webp 768w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/e2c2f/tanstack-query_dev_tools.webp 1152w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/f3efb/tanstack-query_dev_tools.webp 1536w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/57531/tanstack-query_dev_tools.webp 3004w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b147f4b64d0cdd91a94d8d13e6f57947/3b721/tanstack-query_dev_tools.png 192w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/66595/tanstack-query_dev_tools.png 384w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/fe486/tanstack-query_dev_tools.png 768w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/d2d74/tanstack-query_dev_tools.png 1152w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/e8464/tanstack-query_dev_tools.png 1536w,\n/static/b147f4b64d0cdd91a94d8d13e6f57947/b7f71/tanstack-query_dev_tools.png 3004w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b147f4b64d0cdd91a94d8d13e6f57947/fe486/tanstack-query_dev_tools.png\"\n            alt=\"왼쪽 중간 조금 아래에 보면 꽃 모양 누르면 껐다가 켤 수 있어요.(빨간박스)\"\n            title=\"왼쪽 중간 조금 아래에 보면 꽃 모양 누르면 껐다가 켤 수 있어요.(빨간박스)\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">왼쪽 중간 조금 아래에 보면 꽃 모양 누르면 껐다가 켤 수 있어요.(빨간박스)</figcaption>\n  </figure></p>\n<br>\n<hr>\n<h2 id=\"folder\" style=\"position:relative;\"><a href=\"#folder\" aria-label=\"folder permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>folder</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">├── queries\n│   ├── constants<span class=\"token punctuation\">.</span>ts\n│   └── useGetPhotoListQuery<span class=\"token punctuation\">.</span>ts\n├── useAutoResizeTextarea<span class=\"token punctuation\">.</span>ts\n├── useCustomDropzone<span class=\"token punctuation\">.</span>ts\n└── useSideTabFixer<span class=\"token punctuation\">.</span>ts</code></pre></div>\n<ul>\n<li>\n<p>folder는 다양하게 사용할 수 있겠지만 components나 pages내에서 hook으로 차용하기보단\nhooks라는 폴더내 queries 폴더를 두고 여기서 분기시켜주는게 좋을 것 같아요.</p>\n</li>\n<li>\n<p>예를들어 다음과 같습니다.</p>\n<p><code class=\"language-text\">queries/login/useGetUserData.ts</code><br>\n<code class=\"language-text\">queries/modal/useGetPhotoList.ts</code></p>\n</li>\n<li>\n<p>그리고 아래서 또 설명드리겠지만, queries폴더 내 constanst는 queryKeys를 관리하기 위함이에요.<br>\n→ useQuery 또는 useMutation은 querykey를 매개변수로 받는데,<br>\n역할은 useEffect의 dependency array라고 생각하시면 될거 같아요.</p>\n</li>\n<li>\n<p>custom hooks를 사용하려고 해요.</p>\n<ul>\n<li>다수의 useQuery를 사용할 때 사용중인 queryKey의 종류가 헷갈렸어요.<br>\n→ 그래서 queryKeys를 상수로 지정해놓은거에요</li>\n<li>custom hooks를 사용하지 않고 useQuery로 사용한다면 상수로 지정해놓은 쿼리 키도 헷갈릴 거 같았어요.</li>\n</ul>\n</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// hooks/queries/useGetPhotoListQuery.ts</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useGetPhotoListQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>searchQuery<span class=\"token punctuation\">,</span> setSearchQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> fallback<span class=\"token operator\">:</span> Photo<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> photoList <span class=\"token operator\">=</span> fallback <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span>queryKeys<span class=\"token punctuation\">.</span>photoList<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getPhotoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> search<span class=\"token operator\">:</span> <span class=\"token function\">searchParams</span><span class=\"token punctuation\">(</span>searchQuery<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      select<span class=\"token operator\">:</span> searchQuery\n        <span class=\"token operator\">?</span> data <span class=\"token operator\">=></span>\n            data<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> Photo<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n              <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">.*</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>searchQuery<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'i'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">?.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> data <span class=\"token operator\">=></span> data<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">,</span>\n      suspense<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token operator\">...</span>commonOptions<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> photoList<span class=\"token punctuation\">,</span> searchQuery<span class=\"token punctuation\">,</span> setSearchQuery <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// AlbumModal.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> useGetPhotoListQuery <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'hooks/queries/useGetPhotoListQuery'</span>\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> photoList<span class=\"token punctuation\">,</span> searchQuery<span class=\"token punctuation\">,</span> setSearchQuery <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useGetPhotoListQuery</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// hooks를 사용하지 않을 시</span>\n<span class=\"token comment\">// AlbumModal.tsx 내에서 useQuery를 호출하여 사용하개 될 건데,</span>\n<span class=\"token comment\">// 다른 파일(CardListContainer.tsx)에서 photoList를 get해오려고 한다면 똑같은 코드를 복붙 해줘야해요.</span>\n<span class=\"token comment\">// 하지만 hooks를 사용하면 선언적으로 코딩할 수 있어요.</span></code></pre></div>\n<br>\n<hr>\n<h2 id=\"fetching-error-indicator-전역으로-관리\" style=\"position:relative;\"><a href=\"#fetching-error-indicator-%EC%A0%84%EC%97%AD%EC%9C%BC%EB%A1%9C-%EA%B4%80%EB%A6%AC\" aria-label=\"fetching error indicator 전역으로 관리 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fetching Error indicator 전역으로 관리</h2>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">├── queries\n│   ├── constants<span class=\"token punctuation\">.</span>ts\n│   ├── queryClient<span class=\"token punctuation\">.</span>ts\n│   └── useGetPhotoListQuery<span class=\"token punctuation\">.</span>ts\n├── useAutoResizeTextarea<span class=\"token punctuation\">.</span>ts\n├── useCustomDropzone<span class=\"token punctuation\">.</span>ts\n└── useSideTabFixer<span class=\"token punctuation\">.</span>ts</code></pre></div>\n<ul>\n<li>queryClient 파일 내부에서 QueryClient를 생성하고 관리하려고 해요.</li>\n<li>이렇게 했을 때 전역적으로 에러 핸들러를 관리할 수 있고, <code class=\"language-text\">isFetching</code>, <code class=\"language-text\">isLoading</code>의 indictor도 설정해줄 수 있어요.</li>\n<li>즉, 사용하게 될 app 파일을 오염시키지 않고 독자적으로 관리하고 싶어서 만들었습니다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">//queryClient.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> QueryClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">queryErrorHandler</span><span class=\"token punctuation\">(</span>error<span class=\"token operator\">:</span> <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> title <span class=\"token operator\">=</span>\n    error <span class=\"token keyword\">instanceof</span> <span class=\"token class-name\">Error</span> <span class=\"token operator\">?</span> error<span class=\"token punctuation\">.</span>message <span class=\"token operator\">:</span> <span class=\"token string\">'error connecting to server'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  defaultOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    queries<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      onError<span class=\"token operator\">:</span> queryErrorHandler<span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// refetching과 staleTime, cacheTime은 모두 길게 주고 false로 줬어요.</span>\n      <span class=\"token comment\">// default라서 길게 설정해두었어요. 실시간 업데이트가 필요한 경우라면 해당 hooks의 query에서 설정을 변경하면 되어요.</span>\n      staleTime<span class=\"token operator\">:</span> <span class=\"token number\">600000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 10 minutes</span>\n      cacheTime<span class=\"token operator\">:</span> <span class=\"token number\">900000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 15 minutes</span>\n\n      refetchOnMount<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// mount 시 query를 재호출 하지 않음.</span>\n      refetchOnWindowFocus<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// data가 stale 되더라도, query를 재호출 하지 않음.</span>\n      refetchOnReconnect<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// network가 끊겼다가 다시 연결되더라도 query를 재호출하지 않음.</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    mutations<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      onError<span class=\"token operator\">:</span> queryErrorHandler<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token operator\">--</span><span class=\"token operator\">-</span>\n\n<span class=\"token comment\">//_app.page.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> queryClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'hooks/queries/queryClient'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> Component<span class=\"token punctuation\">,</span> pageProps <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> AppProps<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">QueryClientProvider</span></span> <span class=\"token attr-name\">client</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ThemeProvider</span></span> <span class=\"token attr-name\">theme</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>theme<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CurrentPageIdProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">GlobalStyle</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">StaticPageLayout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n              </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Component</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>pageProps<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n            </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">StaticPageLayout</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">CurrentPageIdProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n          </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ReactQueryDevtools</span></span> <span class=\"token attr-name\">initialIsOpen</span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">ThemeProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">QueryClientProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/4ab23/tanstack-query_alert.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.541666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAwUlEQVQoz61QywrDMAzL/3/ezttx0HaUpknbvKMhg0sZu20GJZEtCztmek0YxxHHcSDnjJTSCfIQAuZ5xrIskmOE3GE969TlU0uYYRhEXGuV5msxxig55SFEABX3Z8Dt4VBLFEPVrusK01pD710MCXK99a2GpRSknNFbFuOrnnDOwXAC7z22bTtXZmHfdzHgV7DGm03Me7/JtNSzRmifYZMGGzjtN65baHxyTiqGnI67k/wDhqtYa8X0V4ghj3+YKd5vf2yXdK06+gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/a59e9/tanstack-query_alert.webp 192w,\n/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/0ca9f/tanstack-query_alert.webp 384w,\n/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/dc9b9/tanstack-query_alert.webp 768w,\n/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/e2c2f/tanstack-query_alert.webp 1152w,\n/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/13d4d/tanstack-query_alert.webp 1462w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/3b721/tanstack-query_alert.png 192w,\n/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/66595/tanstack-query_alert.png 384w,\n/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/fe486/tanstack-query_alert.png 768w,\n/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/d2d74/tanstack-query_alert.png 1152w,\n/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/4ab23/tanstack-query_alert.png 1462w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/f807bd3ea6bb1bfe5885d7e0fe65fdd3/fe486/tanstack-query_alert.png\"\n            alt=\"queryErrorHandler defaultOptions으로 걸어주면 Error가 떴을 때 alert 뜨도록 해놓았어요.\"\n            title=\"queryErrorHandler defaultOptions으로 걸어주면 Error가 떴을 때 alert 뜨도록 해놓았어요.\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">queryErrorHandler defaultOptions으로 걸어주면 Error가 떴을 때 alert 뜨도록 해놓았어요.</figcaption>\n  </figure></p>\n<ul>\n<li>참고로 retry의 default는 3번이에요. 즉, 3번 재요청하고 3번 사이에 success가 없을 시 Error 띄웁니다.</li>\n<li>이외에도 방법은 여러가지가 있는 거 같아요.<br>\n(<a href=\"https://reactjs.org/docs/error-boundaries.html\" target=\"_blank\" rel=\"nofollow\">React Error Boundary</a>, <a href=\"https://tanstack.com/query/latest/docs/react/reference/useQuery?from=reactQueryV3&#x26;original=https%3A%2F%2Ftanstack.com%2Fquery%2Fv3%2Fdocs%2Freference%2FuseQuery\" target=\"_blank\" rel=\"nofollow\">tanstack query hooks useErrorBoundary</a>)</li>\n</ul>\n<br>\n<hr>\n<h2 id=\"그-외-짧은-지식\" style=\"position:relative;\"><a href=\"#%EA%B7%B8-%EC%99%B8-%EC%A7%A7%EC%9D%80-%EC%A7%80%EC%8B%9D\" aria-label=\"그 외 짧은 지식 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>그 외 짧은 지식.</h2>\n<h3 id=\"isloading-isfetching\" style=\"position:relative;\"><a href=\"#isloading-isfetching\" aria-label=\"isloading isfetching permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>isLoading, isFetching</h3>\n<p><strong>isLoading</strong></p>\n<ul>\n<li>가져오는 상태에 있음을 의미, isFetching이 참이면서, 쿼리에 대해 캐시된 데이터가 없는 상태.</li>\n</ul>\n<p><strong>isFetching</strong></p>\n<ul>\n<li>cache의 여부에 상관없이 데이터를 가져온다면 항상 동작함.</li>\n</ul>\n<br>\n<hr>\n<h3 id=\"why-dont-refresh\" style=\"position:relative;\"><a href=\"#why-dont-refresh\" aria-label=\"why dont refresh permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why don’t refresh?</h3>\n<p>쿼리 키가 있을 때는 어떠한 트리거가 있어야만 데이터를 다시 가져옵니다.</p>\n<ul>\n<li>\n<p>컴포넌트를 다시 마운트 될 때</p>\n</li>\n<li>\n<p>윈도우를 다시 포커스 할 때</p>\n</li>\n<li>\n<p>useQuery에서 반환되어 수동으로 리패칭을 실행할 때</p>\n</li>\n<li>\n<p>지정된 간격으로 리패칭을 자동 실행할 때(=polling)</p>\n</li>\n<li>\n<p>Mutation을 생성한 뒤 쿼리를 무효화할 시, 클라이언트 데이터가 서버의 데이터와 불일치 할 때 리패칭 트리거</p>\n</li>\n</ul>\n<br>\n<hr>\n<h3 id=\"query로-데이터를-미리-채우는-방법들\" style=\"position:relative;\"><a href=\"#query%EB%A1%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EB%AF%B8%EB%A6%AC-%EC%B1%84%EC%9A%B0%EB%8A%94-%EB%B0%A9%EB%B2%95%EB%93%A4\" aria-label=\"query로 데이터를 미리 채우는 방법들 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Query로 데이터를 미리 채우는 방법들</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3dd632d8c07ca671c5e4a0e049943a49/5c1e2/queryClient_method.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 61.979166666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACxElEQVQoz02P60uTYRjG34LAmdve103dwTlz7uSctqVpTec2Wx5WO7nNRWyZZSWVIBRB2ArFiGYU1IeI6EN/QFBfCoJIO30oqv/oF8/jij5cXNd9PffhepRo8hzVpRrLq/epXlrn/EqdysVN5hfWmCleZ3Fli/mlTQqL6yyuPqRy9QFXas9ZqT3n4q0XXLjzkptPXlGtPSNx4ylKb2CW4NAckckzDIyUOHhknp6+FN5QnsHRMqGxisTRqUsksqvEc9eYPrXG6OwKqcpt4uUameU6M5frDFZuo/ijZ9F7sujdaYy+HHpvBoMng9qXxxwsogUKGP15jP45tEARta+AGiii9Zf+Qe0vYQ6fpiNURgnPb9CdXac3v4ErtyHZU9hk5OwDDi9sMbywha90V/qHqnUiSw8JV+q4cusET90jvvyYoep9Iucf4T65huIfO0NbYA5LsCDR3j+H6kljGyzhPlKhM1xG82YkTP4cjnAZkz8ra9HX6stiHSiiih5PGsUdymGwTaA54rR2JTB2xtDbojj7UrgGMjh8sxjsEzS1HaXFGqXdlWS/ZRxde4SmtgjNHWOYnJPyvdkyhuIK5VGdk7QeSGLqSaJ2TdJij9EVOIlvuIizP43BkaDZOkGLPY7FMyN5vy3W8GKYeo6ja2i50OhI0Np9TEJofefuYKc/RXvv1H8LY1i9s+jtcVk3W6LSa3NNobNE5RHFc6ggU5lEwgaaOsbpcE/jGypgcU/LZl1jWCQX/NcTi//OCK30hvLo7TE08W2RsCshB2y+lFxo96VkIpFawNxzHENDiz7BmvOY1OInitV7gn3mcXSWGC32BPvMERT9kPx6dzAtDymGwxJ7tVHMB5KSd71hqcWBvdoIe9QRlI8f3/P27WvevXsjefvzdz59+83255982PnB9peffPr6S2Ln6y/p7zTqf96XXU/gDzooqsNZe4jYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/3dd632d8c07ca671c5e4a0e049943a49/a59e9/queryClient_method.webp 192w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/0ca9f/queryClient_method.webp 384w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/dc9b9/queryClient_method.webp 768w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/e2c2f/queryClient_method.webp 1152w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/f3efb/queryClient_method.webp 1536w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/d38a2/queryClient_method.webp 1812w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/3dd632d8c07ca671c5e4a0e049943a49/3b721/queryClient_method.png 192w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/66595/queryClient_method.png 384w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/fe486/queryClient_method.png 768w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/d2d74/queryClient_method.png 1152w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/e8464/queryClient_method.png 1536w,\n/static/3dd632d8c07ca671c5e4a0e049943a49/5c1e2/queryClient_method.png 1812w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/3dd632d8c07ca671c5e4a0e049943a49/fe486/queryClient_method.png\"\n            alt=\"queryClient의 메서드\"\n            title=\"queryClient의 메서드\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">queryClient의 메서드</figcaption>\n  </figure></p>\n<p>사용자에게 보여주고 싶은 정보가 있을 때 캐시에 아직 데이터가 없을 경우, 미리 데이터를 채울 수 있어요.</p>\n<p>데이터는 클라이언트 또는 서버에서 올 수 있겠죠. 간단히 말하면 <strong>미리 채우기 ‘옵션’들</strong>이라고 보시면 될 거 같아요.</p>\n<br>\n<p><strong>prefetchQuery</strong></p>\n<p>만약, 우리 제조도 홈페이지에서 통계적으로 많이 접속하는 페이지가 ‘잉재 라이브러리’라고 가정 해볼게요.</p>\n<p>제조도 첫 페이지에 접속하자마자, 잉재 라이브러리 데이터를 미리 prefetchQuery로 요청하고 받아온 데이터를 캐시에\n저장해둬요. (default 시간은 5분이에요, 5분 내에 들어가지않으면 가비지컬렉터에 의해 제거되어요.)</p>\n<p>5분이내, 사용자가 잉재라이브러리에 들어갔을 때 캐시되어 있는 데이터를 미리 띄워줘요.\n(서버로부터 데이터 받아올 동안, 기다릴 필요 x)</p>\n<p>만약, 캐시된 데이터와 서버의 데이터가 다를 경우엔, 캐시된 데이터를 먼저 띄워놓고 그 사이에 서버에 요청<br>\n→ 데이터를 업데이트 시켜줘요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// useHooks.tsx</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">usePrefetchTreatments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token keyword\">void</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token function\">useQueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">prefetchQuery</span><span class=\"token punctuation\">(</span>queryKeys<span class=\"token punctuation\">.</span>treatments<span class=\"token punctuation\">,</span> getTreatments<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    staleTime<span class=\"token operator\">:</span> <span class=\"token number\">600000</span><span class=\"token punctuation\">,</span>\n    cacheTime<span class=\"token operator\">:</span> <span class=\"token number\">900000</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">/*\n    prefetchQuery에 사용되는 key는 캐시에서 어느 useQuery가 이 데이터를 찾아야 하는지 알려주기 때문에 매우매우 중요.\n    그리고 캐시에 있는 이 데이터가 이 useQuery 호출과 일치한다고 알려주는 것.\n    이후엔 useQuery 호출과 같은 방법을 사용할 것\n  */</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Home.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> usePrefetchTreatments <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../treatments/hooks/useTreatments'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">Home</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> ReactElement <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">usePrefetchTreatments</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n     <span class=\"token comment\">//...</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<p><strong>setQueryData / removeQueries</strong></p>\n<p>→ useQuery를 실행하지 않고, 쿼리 데이터를 캐시에 추가하는 또 다른 방법이에요.</p>\n<p>위 prefetchQuery와 다른 점은 서버에서 데이터를 가져오는데 반해, 이건 client에서 데이터를 가져와요.</p>\n<p>즉, useMutation으로 서버의 데이터 변경이 이루어졌을 때, 그에 대한 응답으로 나온 데이터를 캐시에 넣을 수 있어요.</p>\n<p>다르게는 쿼리 키와 값을 가져와서 쿼리 캐시에 해당 키에 대한 값을 설정해줄 수도 있는데요.</p>\n<p>쿼리함수의 작동방식과 유사하지만, 쿼리 함수 없이 직접 설정도 가능합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useUpdatePhotoList</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token function\">useQueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">updatePhotoList</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>newData<span class=\"token operator\">:</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">setQueriesData</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>queryKeys<span class=\"token punctuation\">.</span>photoList<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> newData<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> updatePhotoList <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 설정해주면, newData라고 작성해뒀지만, null값을 넣어볼건데요.</p>\n<p>넣고 나면, photoList의 Data가 null로 변경됩니다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/16fdf40c231140a9fadca7de20912e8d/617a2/PhotoList.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB5klEQVQoz52T32tSYRjHT1CblYqONN2P0JiLGa252nS6OV1ua62LFt51E9RVdxFRUA2C8M4x/LekutF274+jHs85Hl06DccndtTh1WB74cPzfr8PfHkeXl4hnU4jiiKaplGv1y+MqqooisLR0RGpVAohm81yfHxMo9HQzYvSbrcZnGQyiZDJZGi1WpeesNP5R7fb1QP39/d7gc1m89KBrWaTk5MTPfDg4KC3crt9/srn9bSaSqfTQdNqJBIJhJ+/fqOoNcoViYpU7SPpWvcqEoqqIisKVVmhWpXPkE+1LFPT6vw5POTrtz2E5/HXhGK7hDfjhLfiBNdfsPvqDV9+JPn4+TvvP+3x9t0HAmvPmPOvsxDc4NEQi6tPdZYjO3h9Kwj35gJct05itrkx2VwYb7kw291YndM6lttuxia93L2/iN0xjXHMxah1CkOfUcsUBssUI+YJrOMzCHdm5rlyw8aI2ck10wAHV40OvZ72nOOzxEJRVjzzuJyzGOweTHYPxiFu2qaxTngRNnbiPHgcxheIMu+PDBHF54/ycClCcHWD7e2XhFY2WQo+wbccY2FAsMep51/bRiiXyxSLov5bcvk8olgiXyhQKBQQSyWKxaKuJVlGkiT9ns/nyeVylEql/mv/Pav/ASSjhwFp4VJPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/16fdf40c231140a9fadca7de20912e8d/a59e9/PhotoList.webp 192w,\n/static/16fdf40c231140a9fadca7de20912e8d/0ca9f/PhotoList.webp 384w,\n/static/16fdf40c231140a9fadca7de20912e8d/dc9b9/PhotoList.webp 768w,\n/static/16fdf40c231140a9fadca7de20912e8d/e2c2f/PhotoList.webp 1152w,\n/static/16fdf40c231140a9fadca7de20912e8d/f3efb/PhotoList.webp 1536w,\n/static/16fdf40c231140a9fadca7de20912e8d/90d1c/PhotoList.webp 1728w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/16fdf40c231140a9fadca7de20912e8d/3b721/PhotoList.png 192w,\n/static/16fdf40c231140a9fadca7de20912e8d/66595/PhotoList.png 384w,\n/static/16fdf40c231140a9fadca7de20912e8d/fe486/PhotoList.png 768w,\n/static/16fdf40c231140a9fadca7de20912e8d/d2d74/PhotoList.png 1152w,\n/static/16fdf40c231140a9fadca7de20912e8d/e8464/PhotoList.png 1536w,\n/static/16fdf40c231140a9fadca7de20912e8d/617a2/PhotoList.png 1728w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/16fdf40c231140a9fadca7de20912e8d/fe486/PhotoList.png\"\n            alt=\"PhotoList Modal창 checkBox에 check하면 data가 null로 변경되도록 했어요.\"\n            title=\"PhotoList Modal창 checkBox에 check하면 data가 null로 변경되도록 했어요.\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">PhotoList Modal창 checkBox에 check하면 data가 null로 변경되도록 했어요.</figcaption>\n  </figure></p>\n<p>참고로 useQuery와 queryClient.setQueryData 실행 이후 onSuccess가 실행되어요.</p>\n<br>\n<p><strong>placeholderData</strong></p>\n<p>이건 useQuery에 대한 옵션이에요.</p>\n<p>useQuery를 실행할 때, 데이터를 제공하기 때문에 클라이언트에서 데이터를 가져오고, 캐시에는 추가하지 않습니다.</p>\n<p>마치 고정값처럼 사용하면 좋을 것 같아요.</p>\n<br>\n<p><strong>initialData</strong></p>\n<p>이것 또한 useQuery 옵션이에요.</p>\n<p>placeholder와 유사하지만 차이점이라면 캐시에 추가해야하는 데이터입니다.</p>\n<p>즉, 초기 데이터를 캐시에 추가하고 싶을 때 사용해요</p>\n<p>placeholder나, fallback은 모두 캐시에 추가되지는 않습니다.</p>\n<br>\n<hr>\n<h3 id=\"select\" style=\"position:relative;\"><a href=\"#select\" aria-label=\"select permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>select</h3>\n<p>useQuery 메서드 중에서 select라고 있어요. restAPI로 데이터를 받았을 때 오버페칭되었다면 그 오버페칭 내에서 필요한 데이터만 select할 수도 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useGetPhotoListQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>searchQuery<span class=\"token punctuation\">,</span> setSearchQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> fallback<span class=\"token operator\">:</span> Photo<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> photoList <span class=\"token operator\">=</span> fallback <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span>queryKeys<span class=\"token punctuation\">.</span>photoList<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getPhotoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> search<span class=\"token operator\">:</span> <span class=\"token function\">searchParams</span><span class=\"token punctuation\">(</span>searchQuery<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      select<span class=\"token operator\">:</span> searchQuery\n        <span class=\"token operator\">?</span> data <span class=\"token operator\">=></span>\n            data<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">:</span> Photo<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n              <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">.*</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>searchQuery<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'i'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>item<span class=\"token operator\">?.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">)</span>\n        <span class=\"token operator\">:</span> data <span class=\"token operator\">=></span> data<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">,</span>\n      suspense<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> photoList<span class=\"token punctuation\">,</span> searchQuery<span class=\"token punctuation\">,</span> setSearchQuery <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>여기서 select 옵션으로 searchQuery가 true일 땐 data.photo.filter로 검색 filter를 걸 수 있었어요.</p>\n<p>또는 data의 photo만 빼올 수도 있고요.</p>\n<p>하지만 이때, useCallback으로 감싸주는게 필요할 것 같아요.. filter 함수를 매 번 실행시켜줄 필요는 없으니까요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useGetPhotoListQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>searchQuery<span class=\"token punctuation\">,</span> setSearchQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> fallback<span class=\"token operator\">:</span> Photo<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">const</span> filterByPhotoList <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\n    data <span class=\"token operator\">=></span>\n      data<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>photo<span class=\"token operator\">:</span> Photo<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">.*</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>searchQuery<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'i'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>photo<span class=\"token operator\">?.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>searchQuery<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> photoList <span class=\"token operator\">=</span> fallback <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span>queryKeys<span class=\"token punctuation\">.</span>photoList<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getPhotoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> search<span class=\"token operator\">:</span> <span class=\"token function\">searchParams</span><span class=\"token punctuation\">(</span>searchQuery<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      select<span class=\"token operator\">:</span> searchQuery <span class=\"token operator\">?</span> <span class=\"token function-variable function\">filterByPhotoList</span> <span class=\"token operator\">:</span> data <span class=\"token operator\">=></span> data<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">,</span>\n      suspense<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> photoList<span class=\"token punctuation\">,</span> searchQuery<span class=\"token punctuation\">,</span> setSearchQuery <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 수정해줘도 될 것 같아요. 참고로, select를 사용할 때마다 재요청이 가지 않습니다.</p>\n<p>→ 캐시 해놓은 데이터를 이용해서 select해요.</p>\n<br>\n<hr>\n<h3 id=\"refetching\" style=\"position:relative;\"><a href=\"#refetching\" aria-label=\"refetching permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>refetching</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// queryClient.ts</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  defaultOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    queries<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      onError<span class=\"token operator\">:</span> queryErrorHandler<span class=\"token punctuation\">,</span>\n      staleTime<span class=\"token operator\">:</span> <span class=\"token number\">600000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 10 minutes</span>\n      cacheTime<span class=\"token operator\">:</span> <span class=\"token number\">900000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 15 minutes</span>\n\n      refetchOnMount<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      refetchOnWindowFocus<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      refetchOnReconnect<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n    mutations<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      onError<span class=\"token operator\">:</span> queryErrorHandler<span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>위와 같이 default로 refetch Option을 모두 끈 상태에 staleTime과 cacheTime 모두 길게 줬다면, PhotoData를 어떻게\n실시간 데이터를 어떻게 받아올까요?</p>\n<p>→ 아래 처럼 useQuery 내 option들을 객체로 받게 되는데, 수정해주면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// useGetPhotoListQuery.ts</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">useGetPhotoListQuery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>searchQuery<span class=\"token punctuation\">,</span> setSearchQuery<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> fallback<span class=\"token operator\">:</span> Photo<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token keyword\">const</span> filterByPhotoList <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span>data<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> photo<span class=\"token operator\">:</span> Photo<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      data<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>photo<span class=\"token operator\">:</span> Photo<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n        <span class=\"token keyword\">new</span> <span class=\"token class-name\">RegExp</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">.*</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>searchQuery<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token string\">'i'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>photo<span class=\"token operator\">?.</span>name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">[</span>searchQuery<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> photoList <span class=\"token operator\">=</span> fallback <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span>queryKeys<span class=\"token punctuation\">.</span>photoList<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getPhotoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> search<span class=\"token operator\">:</span> <span class=\"token function\">searchParams</span><span class=\"token punctuation\">(</span>searchQuery<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      select<span class=\"token operator\">:</span> searchQuery <span class=\"token operator\">?</span> <span class=\"token function-variable function\">filterByPhotoList</span> <span class=\"token operator\">:</span> data <span class=\"token operator\">=></span> data<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">,</span>\n      suspense<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n      staleTime<span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n      cacheTime<span class=\"token operator\">:</span> <span class=\"token number\">300000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 5분</span>\n\n      refetchOnMount<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      refetchOnWindowFocus<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      refetchOnReconnect<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> photoList<span class=\"token punctuation\">,</span> searchQuery<span class=\"token punctuation\">,</span> setSearchQuery <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<hr>\n<h3 id=\"polling\" style=\"position:relative;\"><a href=\"#polling\" aria-label=\"polling permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>polling</h3>\n<p>useQuery의 옵션 중 <code class=\"language-text\">refetchOnInterval</code> 이 있는데요. 이건 boolean type이 아닌 time 즉, ms(밀리세컨)이에요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// queryClient의 default option으로 refetch 3가지 옵션을 모두 false로 주고, stale, cache Time을</span>\n<span class=\"token comment\">// 각각 10분 15분 준 상태.</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> photoList <span class=\"token operator\">=</span> fallback <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">[</span>queryKeys<span class=\"token punctuation\">.</span>photoList<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getPhotoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> search<span class=\"token operator\">:</span> <span class=\"token function\">searchParams</span><span class=\"token punctuation\">(</span>searchQuery<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      select<span class=\"token operator\">:</span> searchQuery <span class=\"token operator\">?</span> <span class=\"token function-variable function\">filterByPhotoList</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> data<span class=\"token punctuation\">.</span>photo<span class=\"token punctuation\">,</span>\n      suspense<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n      refetchInterval<span class=\"token operator\">:</span> <span class=\"token number\">60000</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 1분 마다 서버로 data를 업데이트</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> photoList<span class=\"token punctuation\">,</span> searchQuery<span class=\"token punctuation\">,</span> setSearchQuery <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cb4c13e53287e0a835e133da7e7ba7d5/617a2/data_updated.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75.52083333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB/UlEQVQ4y53Sy04TYRiA4VFrhAKdTinT+TspU3oYOj1ymNb0gHTQWkA5TEBiSIgxujOycWfiwltw5zVJQkoNyDVw8BJe0wHjDhgXT778yfet/lda295j5rFDudqmUmt705fBjb1Iqe6w920fyW44jE0kCYxqBEIxHoY0HsnCl8CYQFV1Nj52kDobb8jPLhBPFZicmkckyoR1i4iev5NxPU8oblGYKvK80kRqv/rKlrtJt1PDtV/TyD4hKExvWfEhJHJEjRJSvb1KwpwjLKYZU9PIWpawMAlrPgjTu1ONIlLRXkRLFpC1DMFxg+HI5H8wGFImkUUGaWv3Pc2ldYq2Q36u7bF88m5mF7Fry0h77z6wtOJeWf5r0wcXp7uJ88Jl//tnpFrrGXIsxb3hCe6PqDwYUQmMxvwZUZmIxln9tIzUWdvFLNeJGRbCqKAmCih6joiXzu0U3SKq55hPF3AqdaSW+4X1tZd0O1Vce4dGdoGgyF5nY92dmEYMfrnd3caaaRJN5BgXOSJi+iobH5S4iSxM1GQJqTDXQjXyXjaDBIaUxL8clKsZjBg3u85N1tJIGztvqS6skC23yJQaZEpN0sWGZ/BOFesYVo3kLYxclUrtKdLp6SnHx8ccHfXo9XocHPyg/7NPv9/n8PCQk18nnF9ccHZ2ztn5zS4vf/MHYXncSOmtedEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cb4c13e53287e0a835e133da7e7ba7d5/a59e9/data_updated.webp 192w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/0ca9f/data_updated.webp 384w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/dc9b9/data_updated.webp 768w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/e2c2f/data_updated.webp 1152w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/f3efb/data_updated.webp 1536w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/90d1c/data_updated.webp 1728w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cb4c13e53287e0a835e133da7e7ba7d5/3b721/data_updated.png 192w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/66595/data_updated.png 384w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/fe486/data_updated.png 768w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/d2d74/data_updated.png 1152w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/e8464/data_updated.png 1536w,\n/static/cb4c13e53287e0a835e133da7e7ba7d5/617a2/data_updated.png 1728w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cb4c13e53287e0a835e133da7e7ba7d5/fe486/data_updated.png\"\n            alt=\"1분마다 서버에서 data를 알아서 업데이트 해요.\"\n            title=\"1분마다 서버에서 data를 알아서 업데이트 해요.\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">1분마다 서버에서 data를 알아서 업데이트 해요.</figcaption>\n  </figure></p>\n<br>\n<hr>\n<h3 id=\"usequery-data\" style=\"position:relative;\"><a href=\"#usequery-data\" aria-label=\"usequery data permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useQuery data</h3>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">useUser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> UseUser <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> user <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>queryKeys<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getUser</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 작성된 코드는 어떻게 돌아갈까요?</p>\n<p>→ 순환적인 것처럼 보이지만, 기존 user의 값을 이용해서 user의 값을 업데이트하는 것입니다.</p>\n<br>\n<hr>\n<h3 id=\"dependent-query\" style=\"position:relative;\"><a href=\"#dependent-query\" aria-label=\"dependent query permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dependent query</h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> userAppointments <span class=\"token operator\">=</span> fallback <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useQuery</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">[</span>queryKeys<span class=\"token punctuation\">.</span>appointments<span class=\"token punctuation\">,</span> queryKeys<span class=\"token punctuation\">.</span>user<span class=\"token punctuation\">,</span> user<span class=\"token operator\">?.</span>id<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">getUserAppointments</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">enabled</span><span class=\"token operator\">:</span> <span class=\"token operator\">!</span><span class=\"token operator\">!</span>user<span class=\"token punctuation\">,</span> <span class=\"token comment\">// 참고로 user는 User type이기 때문에 !!를 붙여 boolean Type으로 변경.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Dependent Query는 user가 true일 때, useQuery가 실행되도록 구현한 것이에요.</p>\n<p>이 부분은 <a href=\"https://tanstack.com/query/latest/docs/react/guides/dependent-queries?from=reactQueryV3&#x26;original=https%3A%2F%2Ftanstack.com%2Fquery%2Fv3%2Fdocs%2Fguides%2Fdependent-queries\" target=\"_blank\" rel=\"nofollow\">공식문서</a> 내용에 잘 설명되어있어요.</p>\n<br>\n<hr>\n<h3 id=\"usemutation\" style=\"position:relative;\"><a href=\"#usemutation\" aria-label=\"usemutation permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>useMutation</h3>\n<p>useQuery와 유사하지만 몇 가지 차이점이 존재해요.</p>\n<ol>\n<li>\n<p>useQuery와 다르게, cache Data가 없습니다. 즉, useMutation은 일회성이에요. 재시도가 없습니다.</p>\n<p>useQuery는 fetching과 re-fetching이 있지만, mutation은 그렇지 않아요.</p>\n</li>\n<li>\n<p>isLoading과 isFetching을 구분할 필요 없습니다.</p>\n<p>위에서 언급드렸듯, isFetching은 데이터를 불러오는 과정이고,\nisLoading은 isFetching이 true이면서 cacheData가 없을 때 true가 된다고 말씀드렸었습니다.</p>\n<p>하지만 mutation은 cache Data가 없으니, isLoading과 isFetching을 구분할 필요없습니다. only isFetching 입니다.</p>\n</li>\n</ol>\n<p>그리고 useMutation에서 typescript 하나만 설명드리려고 해요.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">UseMutateFunction<span class=\"token operator\">&lt;</span>TData<span class=\"token punctuation\">,</span> TError<span class=\"token punctuation\">,</span> TVariables<span class=\"token punctuation\">,</span> TContext<span class=\"token operator\">></span>\n<span class=\"token comment\">// 순서대로, 반환된 데이터 / 발생할 것으로 예상되는 에러 / mutate 함수가 예상하는 변수 유형(selectedPhotoIds)</span>\n\n<span class=\"token comment\">// 마지막은 optimistic update의 경우에 해당하는건데, 추후 알아보고 다시 작성해놓겠습니다.</span>\n<span class=\"token comment\">// 위 내용을 토대로 photoList를 삭제하는 useDeletePhotoListQuery.ts를 작성하면 다음과 같습니다.</span>\n\n<span class=\"token comment\">// useDeletePhotoListQuery.ts</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> useDeletePhotoListQuery <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> UseMutateFunction<span class=\"token operator\">&lt;</span>\n  <span class=\"token keyword\">void</span><span class=\"token punctuation\">,</span>\n  <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span> selectedPhotoIds<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token builtin\">unknown</span>\n<span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> mutate <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> selectedPhotoIds <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> selectedPhotoIds<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      <span class=\"token function\">deletePhotoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> selectedPhotoIds <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> mutate\n<span class=\"token punctuation\">}</span></code></pre></div>\n<br>\n<hr>\n<h3 id=\"invalidatequeries\" style=\"position:relative;\"><a href=\"#invalidatequeries\" aria-label=\"invalidatequeries permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>invalidateQueries</h3>\n<p>위 useDeletePhotoListQuery.ts를 이용해서 photoList를 삭제하려고 하면, 서버쪽에 요청이 가지만 실제로 데이터는 ‘즉각 변경되지는 않습니다.’</p>\n<p>관련된 쿼리를 무효화하여 데이터가 최신이 아님을 query에 알려줘야해요.</p>\n<p>이때 사용하는 method가 invalidateQueries입니다.</p>\n<p>-쿼리를 만료(stale)로 표시하고,</p>\n<p>-쿼리가 현재 렌더링 중이면 re-fetch를 트리거 합니다.</p>\n<p>일반적으로 mutate 내에 onSuccess 메서드 내에서 관련 쿼리를 무효화하고, 데이터 re-fetch를 트리거합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> useDeletePhotoListQuery <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> UseMutateFunction<span class=\"token operator\">&lt;</span>\n  <span class=\"token keyword\">void</span><span class=\"token punctuation\">,</span>\n  <span class=\"token builtin\">unknown</span><span class=\"token punctuation\">,</span>\n  selectedPhotoIdsProps<span class=\"token punctuation\">,</span>\n  <span class=\"token builtin\">unknown</span>\n<span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> <span class=\"token function\">useQueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> mutate <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useMutation</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> selectedPhotoIds <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> selectedPhotoIdsProps<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n      <span class=\"token function\">deletePhotoList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> selectedPhotoIds <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token function-variable function\">onSuccess</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>queryKeys<span class=\"token punctuation\">.</span>photoList<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span>\n\n  <span class=\"token keyword\">return</span> mutate\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이 코드를 보면 photoList에서 체크박스에 체크를 하고 ‘삭제’ 버튼을 눌렀다고 가정해볼게요.</p>\n<p>그럼 여기서 useMutation()가 실행되겠죠.</p>\n<p>useMutation()은 selectedPhotoIds 인자로 넘겨주어요. 그리고 deletePhotoList로 api fetch를 보냅니다.\n위 과정이 성공했으면 onSuccess가 발동해요.</p>\n<p>queryClient.invalidateQueries([쿼리 키]), 여기서 쿼리 키에 해당하는 모든 쿼리를 무효화 시켜요.\n그리고 업데이트 된 캐시를 다시 받아옵니다.</p>\n<p>즉, delete → get 순으로 돌아가는거죠.\ninvalidateQueries 외에도 캐시를 직접건드리는 setQueryData가 있긴 합니다.</p>\n<p>하지만, react-query 메인테이너는 이를 권장하지 않는다고 해요.\n<a href=\"https://tkdodo.eu/blog/mastering-mutations-in-react-query#direct-updates\" target=\"_blank\" rel=\"nofollow\">웬만하면 invalidateQueries로 모두 해결가능하다고 이야기합니다.</a></p>\n<p>그리고 위 코드를 보면 return을 붙였는데요. 붙였을 때와 붙이지 않았을 때 차이가 존재합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 메인테이너 @TkDodo의 블로그 예시 코드를 그대로 가져왔습니다.</span>\n<span class=\"token comment\">// https://tkdodo.eu/blog/mastering-mutations-in-react-query#awaited-promises</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 🎉 will wait for query invalidation to finish</span>\n  <span class=\"token function-variable function\">onSuccess</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">'comments'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 🚀 fire and forget - will not wait</span>\n  <span class=\"token function-variable function\">onSuccess</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    queryClient<span class=\"token punctuation\">.</span><span class=\"token function\">invalidateQueries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'posts'</span><span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> <span class=\"token string\">'comments'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>invalidateQueries는 Promise를 반환합니다.\n관련 쿼리가 업데이트 되는 동안 변환을 loading 상태로 유지하려면 콜백에서 invalidateQueries 결과를 반환해야해요.</p>\n<p>→ 즉 invalidateQueries로 캐시가 업데이트 되고 난 이후, 동작을 수행하려면 return을 붙여야한다고 이해했어요.</p>\n<br>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<p><a href=\"https://www.udemy.com/course/learn-react-query/\" target=\"_blank\" rel=\"nofollow\">React Query / TanStack Query: React Server State Management</a></p>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#query-dev-tools\">query Dev tools</a></p>\n</li>\n<li>\n<p><a href=\"#folder\">folder</a></p>\n</li>\n<li>\n<p><a href=\"#fetching-error-indicator-%EC%A0%84%EC%97%AD%EC%9C%BC%EB%A1%9C-%EA%B4%80%EB%A6%AC\">fetching Error indicator 전역으로 관리</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B7%B8-%EC%99%B8-%EC%A7%A7%EC%9D%80-%EC%A7%80%EC%8B%9D\">그 외 짧은 지식.</a></p>\n<ul>\n<li><a href=\"#isloading-isfetching\">isLoading, isFetching</a></li>\n<li><a href=\"#why-dont-refresh\">Why don’t refresh?</a></li>\n<li><a href=\"#query%EB%A1%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EB%AF%B8%EB%A6%AC-%EC%B1%84%EC%9A%B0%EB%8A%94-%EB%B0%A9%EB%B2%95%EB%93%A4\">Query로 데이터를 미리 채우는 방법들</a></li>\n<li><a href=\"#select\">select</a></li>\n<li><a href=\"#refetching\">refetching</a></li>\n<li><a href=\"#polling\">polling</a></li>\n<li><a href=\"#usequery-data\">useQuery data</a></li>\n<li><a href=\"#dependent-query\">Dependent query</a></li>\n<li><a href=\"#usemutation\">useMutation</a></li>\n<li><a href=\"#invalidatequeries\">invalidateQueries</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Tanstack-query에 대해 학습해보자","summary":"-","date":"2023.05.05.","categories":["개발"]}}}]}},"pageContext":{"slug":"/blog/2023/5/5/tanstack-query/"}},"staticQueryHashes":["1629908903"]}