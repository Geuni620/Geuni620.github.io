{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2023/5/1/next 13 app dir revalidate/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h3 id=\"next-13-app-directory\" style=\"position:relative;\"><a href=\"#next-13-app-directory\" aria-label=\"next 13 app directory permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>next 13 app Directory</h3>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> getInstagramFeedIds <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span>InstagramFeedProps<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.instagram.com/me?fields=media&amp;access_token=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">INSTAGRAM_KEY</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> next<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> revalidate<span class=\"token operator\">:</span> <span class=\"token number\">30</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> feed <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>response<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>feed<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> feed<span class=\"token punctuation\">.</span>media<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>next 13에선 getStaticProps, getServerSideProps 등을 사용할 수 없다.</li>\n<li>대신, fetch로 api를 바로 쏘면 된다. client 환경으로 변경하려면 ‘use client’를 맨 위에 적어주면 된다.</li>\n</ul>\n<br>\n<h3 id=\"revalidate\" style=\"position:relative;\"><a href=\"#revalidate\" aria-label=\"revalidate permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>revalidate</h3>\n<ul>\n<li>revalidate를 설정하지 않은 상태에서 insta feed를 올리니, 데이터가 업데이트 되지 않았다.</li>\n<li>캐싱된 데이터를 그대로 사용하다가 일정 시간이 지나면 캐싱된 데이터를 무효화하고 새롭게 데이터를 가져오는 것 같다.</li>\n<li>그래서 revalidate Time을 다음과 같이 설정해준 뒤 신선한 데이터를 가져올 수 있었다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">const</span> getInstagramFeeds <span class=\"token operator\">=</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span>id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> <span class=\"token builtin\">Promise</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">any</span><span class=\"token operator\">></span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> url <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">https://graph.instagram.com/</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>id<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">?fields=media_type,media_url,timestamp,permalink&amp;access_token=</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">INSTAGRAM_KEY_JEJODO</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> response <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>next<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>revalidate<span class=\"token operator\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> feed <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>response<span class=\"token punctuation\">.</span>ok<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Error</span><span class=\"token punctuation\">(</span>feed<span class=\"token punctuation\">.</span>error<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> feed<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<ul>\n<li>하지만 현재는 layout.tsx에 다음과 같이 지정해준 상태다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> revalidate <span class=\"token operator\">=</span> <span class=\"token number\">3600</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> dynamic <span class=\"token operator\">=</span> <span class=\"token string\">'force-static'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<ul>\n<li>dynamic이라는게 있는데 공식문서 설명은 다음과 같다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> dynamic <span class=\"token operator\">=</span> <span class=\"token string\">'auto'</span>\n<span class=\"token comment\">// 'auto' | 'force-dynamic' | 'error' | 'force-static'</span></code></pre></div>\n<ul>\n<li>해당 속성은 공식문서에 자세히 나와있다.</li>\n<li>내가 사용하려고 했던 것은 force-static이다. 정적 블로그 사이트를 배포해야하기 때문에 실시간으로 데이터를 fetch 할 필요가 없었다.</li>\n<li>또한, 실시간으로 데이터를 fetch하면 페이지와 페이지 사이의 전환이 너무 느렸다.</li>\n<li>force-static으로 정적페이지가 빌드되도록 했다.\n<ul>\n<li>여기서 error와 force-static은 같은 정적페이지를 만드는데. 둘의 큰 차이는 모르겠다.</li>\n</ul>\n</li>\n</ul>\n<br>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a80bf52b12ea74f514ff34a78549b88c/2d81a/force-dynamic.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACDklEQVQoz21T6XKiYBDkTXbXJJtLBZRbkEPuQwSREI1l9v0fordmXKlUbX408F39zXQ3gh0X0PwY67TCk2Lh98L4Dw+yzu97SYNsB7DCnMeKG0H1YhibFFaUYao7EJy0grnJoHkxH/w1W+JOVEeSr6B53U+QND2sKMfcdCFaHjZNgWzYQnZdCKobIdy2qIcPrOKCK9X8hAkJ9wRJ4++JqPLFUd1hU7U8R5d4TYTsI4fsriEYQQovr3kD3Zy1b0iaA5ykBMmhehFeNBszY81VLl0fm6aEUyR4XJp4kHQ8KSZeDQuPSwOCuPJQHN6v6AgDqv6E9njB/vSJ/ccnV2SGGV7UFRZOgLTteXyThTuRrh0J0spjAkLZH7nC8nBEe7qgHs7jGklBlSpuyHvmlvetzgI97H/tBWXDoHbjukNQ7lgKkoTmiHBqrNlVPUhGDSdzBZP51UiByGgDHSLHfkwX+Dlbjm9ynQ7QQYK08jk2RECGGkECJyuxzkrMTAeCHZfI9wOcpIJs+yw+gTL1qtksPBGNsdlEyA4d5LXL6ySZt80You1AIE3IXSIlbaJ6j+78B1V/ZA1pjtqjS6gqPQyR9S20MMCdpHKkbtVzyxTOvBuQtm+cRXKU9EubHrv3M5rjZSSmCGlegmTXQ7T87015ViwONMEvdtw6ReJmBLlLmpHOz+qKK6WKifzrb3kj/AvG954WW+b65wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a80bf52b12ea74f514ff34a78549b88c/a59e9/force-dynamic.webp 192w,\n/static/a80bf52b12ea74f514ff34a78549b88c/0ca9f/force-dynamic.webp 384w,\n/static/a80bf52b12ea74f514ff34a78549b88c/dc9b9/force-dynamic.webp 768w,\n/static/a80bf52b12ea74f514ff34a78549b88c/a1057/force-dynamic.webp 840w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a80bf52b12ea74f514ff34a78549b88c/3b721/force-dynamic.png 192w,\n/static/a80bf52b12ea74f514ff34a78549b88c/66595/force-dynamic.png 384w,\n/static/a80bf52b12ea74f514ff34a78549b88c/fe486/force-dynamic.png 768w,\n/static/a80bf52b12ea74f514ff34a78549b88c/2d81a/force-dynamic.png 840w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a80bf52b12ea74f514ff34a78549b88c/fe486/force-dynamic.png\"\n            alt=\"force-dynamic\"\n            title=\"force-dynamic\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">force-dynamic</figcaption>\n  </figure></p>\n<ul>\n<li>force-dynamic</li>\n<li>λ가 있는데, 동적페이지를 의미하는 듯 하다.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cde82153108c13898e44bce764d479d4/2d81a/force-static.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.8125%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACFElEQVQoz21T2XaiQBTkTyYx+7iAyr4jS9uCKKhIjJmZ/P9H1Jx7HXNyzuShoLvprr63qlD8ooSZFAiXazzrLh5n9n94mFr8vtdMTP0F3GzFcz3KYcQF7HQJN5cYWQEULy/hpBJmXPDB2/Ecd6rxSfIVtG4lAsumg5uvMHEiqG6MtCkh+xrTKIIyC1Kk6xab/gyvKLlSMxFMSLgnaCaPB6oBI86R1S2foTW6JG5yyPMK0yiEYi0E4tWGN4img2yPEM0BgahAchDB0PQxtkM8zhxofoigFIynuYMHzcKz7mBou3ia21BUL0Z5eL1gT+ix7t7Qvv3G7u0P9ucP5PUOTibxYniYBQvI3ZHnV1m4E+3SkaJ5MRMQqu6EZXtEdTihOf1iGWhcH88sxU/Thx5l3MXEjb/VWaGH/6+9RdUw6DBJEMkaoax5HDChh5Edsqsk1VXDwUTHYHIxUiEy2kA6kmM/RjPcjOe4Gc3Ycdp8O9H5IEHzEo4NERhRDnshEMgKoawwdgIoflFhtesRiDWmfsLiE4ZWwGaQ8ET0GZs0hzzsMQ0j/k6SxbVkqH4AhTQhd4mUtMk3O+zfP1jTTf/OBlB7dAlVZWUZZNfCzBa40wyO1LV6bpnCudr3bAaZQIRie+DoEOH29QK6jCJkxgJi20F1k+9NedFdDjQhKbecP4oEmUBaXcekM8WGKqWKifzrb3kl/Asgop3EqVeEdQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/cde82153108c13898e44bce764d479d4/a59e9/force-static.webp 192w,\n/static/cde82153108c13898e44bce764d479d4/0ca9f/force-static.webp 384w,\n/static/cde82153108c13898e44bce764d479d4/dc9b9/force-static.webp 768w,\n/static/cde82153108c13898e44bce764d479d4/a1057/force-static.webp 840w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/cde82153108c13898e44bce764d479d4/3b721/force-static.png 192w,\n/static/cde82153108c13898e44bce764d479d4/66595/force-static.png 384w,\n/static/cde82153108c13898e44bce764d479d4/fe486/force-static.png 768w,\n/static/cde82153108c13898e44bce764d479d4/2d81a/force-static.png 840w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/cde82153108c13898e44bce764d479d4/fe486/force-static.png\"\n            alt=\"force-static\"\n            title=\"force-static\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">force-static</figcaption>\n  </figure></p>\n<ul>\n<li>force-static</li>\n<li>o는 정적페이지를 의미하는 듯 하다.</li>\n</ul>\n<br>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<ul>\n<li><a href=\"https://beta.nextjs.org/docs/data-fetching/revalidating\" target=\"_blank\" rel=\"nofollow\">Revalidating Data</a></li>\n<li><a href=\"https://beta.nextjs.org/docs/api-reference/segment-config#dynamic\" target=\"_blank\" rel=\"nofollow\">dynamic</a></li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"#next-13-app-directory\">next 13 app Directory</a></li>\n<li><a href=\"#revalidate\">revalidate</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></li>\n</ul>","frontmatter":{"title":"next 13 app dir revalidate","summary":"-","date":"2023.05.01.","categories":["개발"]}}}]}},"pageContext":{"slug":"/blog/2023/5/1/next 13 app dir revalidate/"}},"staticQueryHashes":["1629908903"]}