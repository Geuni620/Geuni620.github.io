{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2023/11/1/provider/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<blockquote>\n<p>기록이 서비스에서 첫 번째 기록은 인트로를 진행할 때 작성하게 된다.<br>\n첫 기록은 수정과 삭제가 불가능하게 하자고 권했고 받아들여져서 수정해주었다.<br>\n메시지 내에서 첫 기록일 경우, DB에 isFirstRecord를 true로 저장하였고, query로 받아와서 뿌려줬다.<br>\n뿌려줄 때 isFristRecord라면 MoreButton이 보이지 않도록 처리했다.<br>\nTest code도 작성해주면 좋겠다는 생각에 적용했다. 하지만 다음과 같은 에러 메시지가 떴다.</p>\n</blockquote>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/14db85a823e240d37fa87204ab328084/d6170/useSession-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiUlEQVQoz22S6ZLaMBCE/SjJZg8OY5vFlyRfwpgY7AUTIMlW9kfy/g/xbUl4q5Kq/OhqTWvUmhnJ8USJm+YsszWzSLFIC3xZYfR5krEQJQtRWD3ItGWT58nS5n3A5E8jhSPqHXG1RTWdPZzWLeXugNHNJSaOqgax2aG7gbBsrB7rLWrbkay/2r103drCnHlaYOClBZuXgaJ9sSaxbnhYxnz2Qr74keVP7jN3Y2xw5408xvfLBGepNH62Jixr5LbFsy2UeKKwcJOcWSRZJBm+0rcRpDlPzymP/4EzDSWTUPK4kkxlzTzJCVRlTUxrgdLMY8VKlgQGSrNUldU+qjJGDyM7QV7boc6zmuT0RrEf2By+kW1bmuMFveuodr3V1v2JzfHK/voL3Z1Y5Ro3Vv+YOkFW31402yAuv8n3A/vzT85vf6j7gajU9N/fOFxOvL729MeWy7VjOLU05x8UxyuzUHAfjBVOxpYnkWKWlszizH4Ng9v8FK5dKwIhcWOBn0r8VPx1RvG0ErbCd/e9DEYWIB51AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/14db85a823e240d37fa87204ab328084/a59e9/useSession-error.webp 192w,\n/static/14db85a823e240d37fa87204ab328084/0ca9f/useSession-error.webp 384w,\n/static/14db85a823e240d37fa87204ab328084/dc9b9/useSession-error.webp 768w,\n/static/14db85a823e240d37fa87204ab328084/16274/useSession-error.webp 850w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/14db85a823e240d37fa87204ab328084/3b721/useSession-error.png 192w,\n/static/14db85a823e240d37fa87204ab328084/66595/useSession-error.png 384w,\n/static/14db85a823e240d37fa87204ab328084/fe486/useSession-error.png 768w,\n/static/14db85a823e240d37fa87204ab328084/d6170/useSession-error.png 850w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/14db85a823e240d37fa87204ab328084/fe486/useSession-error.png\"\n            alt=\"다음과 같은 에러가 떴다.\"\n            title=\"다음과 같은 에러가 떴다.\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">다음과 같은 에러가 떴다.</figcaption>\n  </figure></p>\n<p>기록이 서비스에 로그인을 구현할 때 next-auth를 사용했다.<br>\nnext-auth는 내부적으로 contextAPI를 사용하는 듯하고 (명확하지 않다. 추측일 뿐이다.), 이로인해, Provider를 감싸주어야한다.</p>\n<p>유닛테스트의 경우 최대한, 순수하게 작성해줘야했으나, 컴포넌트 테스트의 경우, Provider까지 고려해야하는 것 같다.\n그래서 단순히, 테스트코드 내에서 Provider로 감싸주면 되는 줄 알았다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// 잘못된 방식</span>\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;MoreButton />'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'showEditButton이 true일 경우, MoreButton이 렌더링되어야 한다.'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">SessionProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MoreButton</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">SessionProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> imageElement <span class=\"token operator\">=</span> screen<span class=\"token punctuation\">.</span><span class=\"token function\">getByAltText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'more-btn'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>imageElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeInTheDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>이렇게 했을 때 두 가지 에러가 났는데, 첫 번째는 여전히 <code class=\"language-text\">useSession</code>에 관한 에러이고, 두 번째는 <code class=\"language-text\">useQuery</code>에 관한 에러였다.</li>\n<li>useQuery 역시, Provider를 감싸주어야한다. 그래서 이번에도 단순히, QueryProvider를 감싸주면 되는 줄 알았다.</li>\n</ul>\n<br>\n<p>하지만 문제는 해결되지 않았다. 그래서 크게 두 가지를 해결해야겠다.</p>\n<ol>\n<li>next-auth provider</li>\n<li>tanstack-query provider</li>\n</ol>\n<br>\n<p>그리고 번외로, API Mocking 테스트를 할 때, <code class=\"language-text\">MSW</code>를 쓰는 경우를 블로그에서 많이 봤다.<br>\n그래서, <strong>MSW도 필요한 건가?</strong> 염두만 해둔 채, 위 두 가지부터 해결하려고 했다.</p>\n<br>\n<h3 id=\"next-auth-provider\" style=\"position:relative;\"><a href=\"#next-auth-provider\" aria-label=\"next auth provider permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>next-auth provider</h3>\n<p>next-auth 공식문서, 또는 next-auth github의 issue 탭부터 찾아보고 검색해보는 편인데, 이번엔 Discussions에서 발견했다.<br>\n사실 next-auth의 메인테이너는 MSW를 권하는 댓글을 달았으나, 이걸 적용해서 어떻게 테스트한다는 건지 이해하진 못한 상태였다.</p>\n<p><a href=\"https://github.com/nextauthjs/next-auth/discussions/4185\" target=\"_blank\" rel=\"nofollow\">How to mock useSession with v4? #4185</a><br>\nDiscussion에서 발견한 글은 위와 같다.<br>\nMocking을 하는 방법이 었는데, 예시를 다음과 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\">jest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"next-auth/react\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> originalModule <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">requireActual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'next-auth/react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> mockSession <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    expires<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">86400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    user<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> username<span class=\"token operator\">:</span> <span class=\"token string\">\"admin\"</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    __esModule<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>originalModule<span class=\"token punctuation\">,</span>\n    useSession<span class=\"token operator\">:</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>data<span class=\"token operator\">:</span> mockSession<span class=\"token punctuation\">,</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'authenticated'</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>말그대로 useSession으로 제공받을 데이터를 mockSession으로 제공하는 것이었다.</li>\n<li>이를 적용하니, useSession에 관한 에러는 해결할 수 있었다.</li>\n</ul>\n<br>\n<h3 id=\"tanstack-query-provider\" style=\"position:relative;\"><a href=\"#tanstack-query-provider\" aria-label=\"tanstack query provider permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tanstack-query provider</h3>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a6bf85a67afdc7b27a1f916daa9db597/61b91/tanstack-query-error.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 34.895833333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABPUlEQVQoz12P2XLjIBRE9S/jVbZVlpBYBALtsp3k/z/nTEEyU0keTt2mKbovWVlbehkI0tPUlltlsE2Hrh1S2KTb2qXpZaCTnlK0DLpnMSOjHlCyw0ifyArpCNMTPz4w/YpwI9rP2GGji35kftLPL2xYcP2KCgul7LiJNnERJnEVLdm+0tz9xK0N6OmBHDeOdctZWnLlOEtHLj9n9E+NTeddpflTKna/yA6lomgHCu0w04oIC6cY2FgOleYc9Tf28eFdcqhUuv9Ndqw0l8amkGNjU1D+tUVeG26qS/oiHVfVsS81u7v6pFSpIHqxIOosttXDxkV7iv5J1W/Y5UXlJ2o/4h8ftMuLOswcSslVmv/kjeEk/oV9bbhPX+7Thte2x8wvuu0dNa649S1hpi35wjmGxSf81OHGQKHtj8C/fv7lqiUc20oAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/a6bf85a67afdc7b27a1f916daa9db597/a59e9/tanstack-query-error.webp 192w,\n/static/a6bf85a67afdc7b27a1f916daa9db597/0ca9f/tanstack-query-error.webp 384w,\n/static/a6bf85a67afdc7b27a1f916daa9db597/dc9b9/tanstack-query-error.webp 768w,\n/static/a6bf85a67afdc7b27a1f916daa9db597/64775/tanstack-query-error.webp 984w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/a6bf85a67afdc7b27a1f916daa9db597/3b721/tanstack-query-error.png 192w,\n/static/a6bf85a67afdc7b27a1f916daa9db597/66595/tanstack-query-error.png 384w,\n/static/a6bf85a67afdc7b27a1f916daa9db597/fe486/tanstack-query-error.png 768w,\n/static/a6bf85a67afdc7b27a1f916daa9db597/61b91/tanstack-query-error.png 984w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/a6bf85a67afdc7b27a1f916daa9db597/fe486/tanstack-query-error.png\"\n            alt=\"useSession Mocking 후 위 에러를 만났다.\"\n            title=\"useSession Mocking 후 위 에러를 만났다.\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">useSession Mocking 후 위 에러를 만났다.</figcaption>\n  </figure></p>\n<p>두 번째 에러를 만나고, 가장 먼저 떠올랐던 글은 공식문서도 아닌, TkDodo의 <a href=\"https://tkdodo.eu/blog/testing-react-query\" target=\"_blank\" rel=\"nofollow\">Testing React Query</a> 글이었다.\n위 글에선 어떻게 테스트를 작성하는지, 소개해주는데 나의 경우엔 이 글을 읽고, 실천방안으론, react-query 수업을 들었던 유데미의 <a href=\"https://www.udemy.com/course/react-query-react/\" target=\"_blank\" rel=\"nofollow\">React Query : React로 서버 상태 관리하기</a>의 강의를 다시 참고했다.</p>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token comment\">// test-utils.tsx</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> QueryClient<span class=\"token punctuation\">,</span> QueryClientProvider <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@tanstack/react-query'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> render<span class=\"token punctuation\">,</span> RenderResult <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@testing-library/react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> ReactElement <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">generateQueryClient</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">QueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">renderWithQueryClient</span><span class=\"token punctuation\">(</span>\n  ui<span class=\"token operator\">:</span> ReactElement<span class=\"token punctuation\">,</span>\n  client<span class=\"token operator\">?</span><span class=\"token operator\">:</span> QueryClient<span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">)</span><span class=\"token operator\">:</span> RenderResult <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> queryClient <span class=\"token operator\">=</span> client <span class=\"token operator\">??</span> <span class=\"token function\">generateQueryClient</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">QueryClientProvider</span></span> <span class=\"token attr-name\">client</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>queryClient<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>ui<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">QueryClientProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>위와 같이 <code class=\"language-text\">renderWithQueryClient</code>를 만들어주었다.</li>\n<li>이 만들어준 renderWithQueryClient를 test code를 작성할 때, render를 대신해서 불러오는 것이다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"tsx\"><pre class=\"language-tsx\"><code class=\"language-tsx\"><span class=\"token keyword\">import</span> <span class=\"token string\">'@testing-library/jest-dom'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> screen <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@testing-library/react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> renderWithQueryClient <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../../../utils/testUtils'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> MoreButton <span class=\"token keyword\">from</span> <span class=\"token string\">'./MoreButton'</span><span class=\"token punctuation\">;</span>\n\njest<span class=\"token punctuation\">.</span><span class=\"token function\">mock</span><span class=\"token punctuation\">(</span><span class=\"token string\">'next-auth/react'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> originalModule <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">requireActual</span><span class=\"token punctuation\">(</span><span class=\"token string\">'next-auth/react'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> mockSession <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    expires<span class=\"token operator\">:</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span>Date<span class=\"token punctuation\">.</span><span class=\"token function\">now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">+</span> <span class=\"token number\">2</span> <span class=\"token operator\">*</span> <span class=\"token number\">86400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toISOString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    user<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> username<span class=\"token operator\">:</span> <span class=\"token string\">'admin'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n    __esModule<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token operator\">...</span>originalModule<span class=\"token punctuation\">,</span>\n    useSession<span class=\"token operator\">:</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> data<span class=\"token operator\">:</span> mockSession<span class=\"token punctuation\">,</span> status<span class=\"token operator\">:</span> <span class=\"token string\">'authenticated'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;MoreButton />'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'showEditButton이 true일 경우, MoreButton이 렌더링되어야 한다.'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//...</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// render → renderWithQueryClient</span>\n    <span class=\"token function\">renderWithQueryClient</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MoreButton</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token operator\">...</span>props<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> imageElement <span class=\"token operator\">=</span> screen<span class=\"token punctuation\">.</span><span class=\"token function\">getByAltText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'more-btn'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>imageElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toBeInTheDocument</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>이렇게 했을 때 렌더링된 쿼리 데이터를 테스트하는 것은 아니기에, 테스트는 온전히 통과하게 된다.</li>\n</ul>\n<br>\n<h3 id=\"궁금증에-대한-답\" style=\"position:relative;\"><a href=\"#%EA%B6%81%EA%B8%88%EC%A6%9D%EC%97%90-%EB%8C%80%ED%95%9C-%EB%8B%B5\" aria-label=\"궁금증에 대한 답 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>궁금증에 대한 답</h3>\n<p>처음 위 에러를 만나서 크게 궁금했던 두 가지,</p>\n<ol>\n<li>next-auth provider</li>\n<li>tanstack-query provider</li>\n</ol>\n<p>는 모두 해결할 수 있었다.</p>\n<p>번외로 궁금했던 MSW 같은 경우, 현재 나의 프로덕트에선 사용하지 않아도 될 것 같다.<br>\nMSW를 찾아봤을 때, 결국 <strong>서버에서 보내주는 데이터를 Mocking 해주기 위해서 사용하는 것</strong>이다.<br>\n즉, 백엔드 API가 온전히 완성되지 않은 상태에서, 빠르게 프론트엔드 개발자가 UI 및 기능을 완성하고, API가 필요할 때, Mocking으로 MSW를 사용하는 것 같다.</p>\n<p>하지만 현재 나의 경우엔, 클라이언트와 서버 모두 내가 핸들링 할 수 있기 때문에, 필요하다면 서버에서 API를 뚫고, 클라이언트로 데이터를 보내주면 된다.<br>\n즉, (아직까진) 나의 프로덕트에선 필요성을 느끼진 못했다.</p>\n<br>\n<h3 id=\"참고자료\" style=\"position:relative;\"><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\" aria-label=\"참고자료 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고자료</h3>\n<p><a href=\"https://tkdodo.eu/blog/testing-react-query#for-components\" target=\"_blank\" rel=\"nofollow\">Testing React Query</a><br>\n<a href=\"https://www.udemy.com/course/react-query-react/\" target=\"_blank\" rel=\"nofollow\">React Query : React로 서버 상태 관리하기</a></p>","tableOfContents":"<ul>\n<li><a href=\"#next-auth-provider\">next-auth provider</a></li>\n<li><a href=\"#tanstack-query-provider\">Tanstack-query provider</a></li>\n<li><a href=\"#%EA%B6%81%EA%B8%88%EC%A6%9D%EC%97%90-%EB%8C%80%ED%95%9C-%EB%8B%B5\">궁금증에 대한 답</a></li>\n<li><a href=\"#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C\">참고자료</a></li>\n</ul>","frontmatter":{"title":"'No QueryClient set, use QueryClientProvider to set one' 에러 해결하기","summary":"지금 상황에 MSW가 필요할까?","date":"2023.11.01.","categories":["개발"]}}}]}},"pageContext":{"slug":"/blog/2023/11/1/provider/"}},"staticQueryHashes":["1629908903"]}