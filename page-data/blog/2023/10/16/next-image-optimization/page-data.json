{"componentChunkName":"component---src-templates-post-template-tsx","path":"/blog/2023/10/16/next-image-optimization/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<blockquote>\n<p><a href=\"https://geuni620.github.io/blog/2023/10/13/next-image-optimization/\" target=\"_blank\" rel=\"nofollow\">이전에 작성한 블로그 글</a>에 이어서 추가로 몇 가지 더 작성해보려고 한다.</p>\n</blockquote>\n<h3 id=\"performance로-측정해보자\" style=\"position:relative;\"><a href=\"#performance%EB%A1%9C-%EC%B8%A1%EC%A0%95%ED%95%B4%EB%B3%B4%EC%9E%90\" aria-label=\"performance로 측정해보자 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>performance로 측정해보자</h3>\n<p>이전에 작성한 블로그 글에서는 계속 lighthouse만을 통해서 성능을 검증했다. 하지만 위 글에서도 언급했듯이, 근본적으로 해결하고 싶던 문제는 다음과 같다.</p>\n<p>사용자가 이미지를 업로드했을 때, 이미지가 <strong>최소한의 로딩시간</strong> 후 렌더링 되는 것이다.</p>\n<p>이미지 용량 다운, loading처리, 심지어 CDN까지 많은 것을 고려했지만,<br>\n결국 원인은 Image 컴포넌트 내부에 있었다.</p>\n<br>\n<p>참고로 회사 인터넷 속도가 빨라서 이를 기준으로 측정했다.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 718px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/dc3c64edbd4da4b4167f010d68a952c5/ab030/internet-speed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 147.91666666666669%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAACXBIWXMAABYlAAAWJQFJUiTwAAACyElEQVRIx+1Uy27TQBTNEvEnLFjzS7BFLBESghVfgliWBWKDUIGqaQgE0jpNH07s+BGPn2N7/Ersg2ZSp06aNlSwgysdzdhz58yZ43vd8mgIk9iY2g4s2wVxPVjOYnQDiiCKEYTRYtwAP4xAYwbDImJfS5ta2P2yh3ani/bXLrq9HzjofsOnvX2cnI8QsgQejcTGGlxEE5QlOJVHUHUDrTBmCBlDxBiyYoYsL5BkGeIkRcQSiPUG+Ls0z5Fe5LGUIxUj39Oqqgo8ZrMZZHmE4fAUxLZhWQRxzMQaz6nKUsyzLIOqTiDLY5jTKWzbget6i7yyvCTMshz77Q4+fNzF4ZEERZ2sEl7kMZaIvM97+/jZP4Q0OMZYUZd5rTq5LEs4rosgCKAbBigNV8iapDFjsB0H5tSC7wcreUuFPDhpWVbL+TpZ8/D5fC6wntfim3NucpoiLwrhURzHSzWbCNfjCqHn+1AnEwHTNGHbtvhItZom+XU21CEIi6IAYwyO4yCMImyKmxQ3iQUh/wCapglCPtaQZRm6rgsLtvm6QhhFEQghgpCP3ALf98X1Pc8THv9OLD3kpTLRNBBi4+zsXKjjxUsphaIo0HVDKFVVFYZhYjLRMBgMoOm6WD8+HiIMo0uFrutCkgYYjxUcHUno9XrieTg8Qb/fhyRJGI3GYo0XsesHcL0ANIwRRrGY85ZdEvKS4Wq4V/X1+TM/lY8cSZKIdkxYdO2Vy/XCXo8kTcVhnGzRhhX0oMKTNwFe7FC8fEvx6l2Ix699vD9MLxVu7IaqgkUIphaBYZrQDBPVLMGBnOPuIx33nlq4/8zCg5cEdx4aeL5DF4TbyuCK6rzEdyVHZ5ThQM7QljN05AyEzrcT1r29QClU82vf6CFuGZxzXlYC/D+SFzOYUwJal81NCreh9r/5l7q1wk39faVT/oRsYy//zfhP+C8Q/gJpvxkQnNHJygAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/dc3c64edbd4da4b4167f010d68a952c5/a59e9/internet-speed.webp 192w,\n/static/dc3c64edbd4da4b4167f010d68a952c5/0ca9f/internet-speed.webp 384w,\n/static/dc3c64edbd4da4b4167f010d68a952c5/3b4cc/internet-speed.webp 718w\"\n              sizes=\"(max-width: 718px) 100vw, 718px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/dc3c64edbd4da4b4167f010d68a952c5/3b721/internet-speed.png 192w,\n/static/dc3c64edbd4da4b4167f010d68a952c5/66595/internet-speed.png 384w,\n/static/dc3c64edbd4da4b4167f010d68a952c5/ab030/internet-speed.png 718w\"\n            sizes=\"(max-width: 718px) 100vw, 718px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/dc3c64edbd4da4b4167f010d68a952c5/ab030/internet-speed.png\"\n            alt=\"인터넷 속도는 다음과 같다.\"\n            title=\"인터넷 속도는 다음과 같다.\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">인터넷 속도는 다음과 같다.</figcaption>\n  </figure></p>\n<br>\n<h3 id=\"이미지-최적화-이전\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%9D%B4%EC%A0%84\" aria-label=\"이미지 최적화 이전 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이미지 최적화 이전</h3>\n<p>이전 블로그를 기준으로 이미지를 최적화하기 위해 크게 두 가지를 변경했었다.</p>\n<ol>\n<li>이미지 용량 압축(browser-image-compression lib)</li>\n<li>이미지 포맷을 webp → avif로 변경</li>\n</ol>\n<br>\n<p>그럼 변경하기 전과 변경하고 난 후에 lighthouse performance 점수는 45 → 70으로 25 증가했었다.</p>\n<br>\n<p>하지만 performance를 확인해보자</p>\n<ul>\n<li>먼저 record를 불러오는데 → 251.45ms</li>\n<li>이미지를 submit해서 서버에서 이미지를 s3에 업로드하고, db에 저장하는데까지 → 397.04ms</li>\n<li>record 데이터를 refresh 시켜서 useQuery가 다시 불러오는데 → 140.24ms</li>\n<li>그리고 이미지를 Image컴포넌트에 src로 지정해주는데, 이때 next.js 자체 서버에 cache 및 re-size 등등을 수행하는 듯하다. → <code class=\"language-text\">620.26ms</code></li>\n<li>총 1408.99ms 걸린다.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d0fa70e2075fd48dedef9da72a130479/b49e7/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 6.770833333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAQ0lEQVQI1yWJQQ6AMAgE/f8PPdlCgRbRGj+whnqY7GxmG/MGu4HdscsFihccD6gbqgqKCsh0bRt9UfPL39KTozEsTnyyk0nXVMqy6QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/d0fa70e2075fd48dedef9da72a130479/a59e9/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.webp 192w,\n/static/d0fa70e2075fd48dedef9da72a130479/0ca9f/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.webp 384w,\n/static/d0fa70e2075fd48dedef9da72a130479/dc9b9/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.webp 768w,\n/static/d0fa70e2075fd48dedef9da72a130479/e2c2f/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.webp 1152w,\n/static/d0fa70e2075fd48dedef9da72a130479/77b97/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.webp 1314w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/d0fa70e2075fd48dedef9da72a130479/3b721/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.png 192w,\n/static/d0fa70e2075fd48dedef9da72a130479/66595/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.png 384w,\n/static/d0fa70e2075fd48dedef9da72a130479/fe486/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.png 768w,\n/static/d0fa70e2075fd48dedef9da72a130479/d2d74/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.png 1152w,\n/static/d0fa70e2075fd48dedef9da72a130479/b49e7/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.png 1314w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/d0fa70e2075fd48dedef9da72a130479/fe486/%EC%B5%9C%EC%A0%81%ED%99%94_%EC%A0%84_2.0mb.png\"\n            alt=\"최적화 이전 performance 측정, Image 컴포넌트에 src를 지정해줄 때\"\n            title=\"최적화 이전 performance 측정, Image 컴포넌트에 src를 지정해줄 때\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">최적화 이전 performance 측정, Image 컴포넌트에 src를 지정해줄 때</figcaption>\n  </figure></p>\n<br>\n<h3 id=\"이미지-최적화-이후\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%9D%B4%ED%9B%84\" aria-label=\"이미지 최적화 이후 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이미지 최적화 이후</h3>\n<p>위에서 언급했듯이, 최적화 이후엔 용량압축, 포맷을 webp → avif로 변경했다.\n<a href=\"https://nextjs.org/docs/app/api-reference/components/image#formats\" target=\"_blank\" rel=\"nofollow\">webp에서 avif로 변경한 이유는 압축율이 20% 더 좋다</a>는 vercel 공식문서를 참고했다.</p>\n<br>\n<p>동일하게 performance를 측정해봤다.</p>\n<ul>\n<li>record를 불러오는데 → 226.85ms</li>\n<li>이미지를 submit해서 서버에서 이미지를 s3에 업로드하고, db에 저장하는데까지 → 225.36ms</li>\n<li>record 데이터를 refresh 시켜서 useQuery가 다시 불러오는데 → 140.33ms</li>\n<li>Image 컴포넌트 src에 이미지를 지정하는데 → <code class=\"language-text\">921.52ms</code></li>\n<li>여긴 하나 더 추가되는게, 이미지를 압축하는 browser-image-compression이 추가된다. → 132.22ms</li>\n<li>총 1646.28ms 걸린다.</li>\n</ul>\n<p>오히려 이미지를 업로드하고 불러오는데 더 많은 시간이 걸린다.\n하지만 light-house 점수는 더 높게 나왔었다.</p>\n<br>\n<h3 id=\"webp로-다시-변경-후-sharp-설치\" style=\"position:relative;\"><a href=\"#webp%EB%A1%9C-%EB%8B%A4%EC%8B%9C-%EB%B3%80%EA%B2%BD-%ED%9B%84-sharp-%EC%84%A4%EC%B9%98\" aria-label=\"webp로 다시 변경 후 sharp 설치 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>webp로 다시 변경 후, sharp 설치</h3>\n<p>나는 Image 컴포넌트에 src를 입혀줄 때 cache, resize 등을 수행하는데, 이게 너무 오래걸리는 것을 performance를 통해 확인했다.\n그래서 Image컴포넌트를 제거하고, img 태그를 바로 적용하면 어떨까하는 생각을 했고 실제로 적용해봤다.</p>\n<br>\n<ul>\n<li>하지만 이렇게 했을 때, jpg 파일이나, png 파일이 그대로 s3에 올라가게 되는 점</li>\n<li>browser-image-compression로 압축을 한 번 했지만, Image 컴포넌트에서 최적화를 한 번 더 해줘서 최종적으로 용량을 줄일 수 있었는데 이를 누릴 수 없는 점\n<ul>\n<li>이는 업로드 기능과는 큰 연관이 없을지 모르나, record+image를 모두 불러올 때 이점을 상쇄시킨다.</li>\n</ul>\n</li>\n<li>Image 컴포넌트는 cache를 해주는데, img 태그는 별도 cache를 해줘야한다는 점.</li>\n</ul>\n<br>\n<blockquote>\n<p>잠깐 번외<br>\n실제로 img 태그를 사용하고 백엔드에서 sharp library를 설치해서 이미지 파일을 avif로 변환해보았다.\n그때 performance로 성능을 검사해보니 역시 avif로 변환하는데 시간이 오래 걸렸다.</p>\n</blockquote>\n<ul>\n<li>결국 <strong>webp를 사용하기로 했고</strong>, <strong>minimalCacheTTL을 1년으로 지정</strong>해줬다.</li>\n<li>또한 sharp를 설치해줬다.</li>\n<li>그 결과 다음과 같은 성능 개선이 있었다.</li>\n</ul>\n<br>\n<ul>\n<li>record 불러오는데 → 242.86ms</li>\n<li>이미지를 submit해서 서버에서 이미지를 s3에 업로드하고, db에 저장하는데까지 → 229.49ms</li>\n<li>record 데이터를 refresh 시켜서 useQuery가 다시 불러오는데 → 129.20ms</li>\n<li>Image 컴포넌트 src에 이미지를 저장하는데 → 124.14ms</li>\n<li>browser-image-compression 압축하는데 → 79.90ms</li>\n<li>총 805.59ms 걸린다.</li>\n</ul>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/49c2cc465443ff72f8f92bf3e57cba80/af70e/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 9.375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAdUlEQVQI12XKXQuCMACFYf//fyskMpxs5dbmZmWB0cU+4g2Fuuni5eHAqd6lIIRiu2vY1HvqRtBJRSsVh1YQBkcphZwzKaVfMca/ll81vyLKz+jLE+0nOj1wtB5pFgO99RjrGa93rB85u7Dur71xqyfjuE0PPj4ClUTg3X67AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/49c2cc465443ff72f8f92bf3e57cba80/a59e9/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.webp 192w,\n/static/49c2cc465443ff72f8f92bf3e57cba80/0ca9f/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.webp 384w,\n/static/49c2cc465443ff72f8f92bf3e57cba80/dc9b9/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.webp 768w,\n/static/49c2cc465443ff72f8f92bf3e57cba80/e2c2f/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.webp 1152w,\n/static/49c2cc465443ff72f8f92bf3e57cba80/ab6d7/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.webp 1184w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/49c2cc465443ff72f8f92bf3e57cba80/3b721/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.png 192w,\n/static/49c2cc465443ff72f8f92bf3e57cba80/66595/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.png 384w,\n/static/49c2cc465443ff72f8f92bf3e57cba80/fe486/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.png 768w,\n/static/49c2cc465443ff72f8f92bf3e57cba80/d2d74/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.png 1152w,\n/static/49c2cc465443ff72f8f92bf3e57cba80/af70e/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.png 1184w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/49c2cc465443ff72f8f92bf3e57cba80/fe486/%EC%B5%9C%EC%A0%81%ED%99%94_%ED%9B%84_%EC%B6%94%EA%B0%80_2.0mb.png\"\n            alt=\"최적화 이후 performance\"\n            title=\"최적화 이후 performance\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\">최적화 이후 performance</figcaption>\n  </figure></p>\n<br>\n<h3 id=\"결론\" style=\"position:relative;\"><a href=\"#%EA%B2%B0%EB%A1%A0\" aria-label=\"결론 permalink\" class=\"headerElement before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>결론</h3>\n<ul>\n<li>이미지 업로드부터 불러와서 이미지가 눈 앞에 렌더링 되기까지 1646.28ms → 805.59ms로 개선되었다. (약 51.1% 개선)</li>\n<li>기술적으로 대부분의 블로그에선 avif가 webp보다 압축율이 더 뛰어나다고 이야기한다.</li>\n<li>하지만, 내가 만들고 있는 서비스에선, avif로 압축할 때 시간이 오래걸려서 사용자의 이미지가 렌더링되기까지 시간이 소요된다.</li>\n<li>그래서 결국 과감하게 빼버렸다. 이를 통해 아무리 좋은 기술이고, 뛰어난 기술력이더라도 현재 프로덕트, 만들고 있는 기능에 맞지 않다면 과감히 빼는 선택도 필요하다는 생각이 들었다.</li>\n<li>‘우리가 만든 제품은 기술적으로 이렇게 뛰어납니다.’ 한들 사용자가 불편해서 쓰지 않는다면, 그 기술은 쓸모가 없다.</li>\n<li>말로만 듣던 걸 이번에 몸소 체험하게 됐다.</li>\n</ul>","tableOfContents":"<ul>\n<li><a href=\"#performance%EB%A1%9C-%EC%B8%A1%EC%A0%95%ED%95%B4%EB%B3%B4%EC%9E%90\">performance로 측정해보자</a></li>\n<li><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%9D%B4%EC%A0%84\">이미지 최적화 이전</a></li>\n<li><a href=\"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%9D%B4%ED%9B%84\">이미지 최적화 이후</a></li>\n<li><a href=\"#webp%EB%A1%9C-%EB%8B%A4%EC%8B%9C-%EB%B3%80%EA%B2%BD-%ED%9B%84-sharp-%EC%84%A4%EC%B9%98\">webp로 다시 변경 후, sharp 설치</a></li>\n<li><a href=\"#%EA%B2%B0%EB%A1%A0\">결론</a></li>\n</ul>","frontmatter":{"title":"이미지 최적화의 진실: 성능 개선의 경험에서 얻은 교훈","summary":"avif로 압축율이 좋긴 했는데, 로딩 시간 때문에 결국 webp로 돌아갔습니다. 🤷‍♂️","date":"2023.10.16.","categories":["개발"]}}}]}},"pageContext":{"slug":"/blog/2023/10/16/next-image-optimization/"}},"staticQueryHashes":["1629908903"]}