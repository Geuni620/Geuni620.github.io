<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.3"/><meta data-react-helmet="true" name="description" content="토큰을 데이터베이스에 저장하지 않고 인증 및 인가 처리 구현하기"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="next-auth를 활용한 인증 및 인가 이해하기"/><meta data-react-helmet="true" property="og:description" content="토큰을 데이터베이스에 저장하지 않고 인증 및 인가 처리 구현하기"/><meta data-react-helmet="true" property="og:image"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:site_name" content="next-auth를 활용한 인증 및 인가 이해하기"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="next-auth를 활용한 인증 및 인가 이해하기"/><meta data-react-helmet="true" name="twitter:description" content="토큰을 데이터베이스에 저장하지 않고 인증 및 인가 처리 구현하기"/><meta data-react-helmet="true" name="twitter:image"/><meta data-react-helmet="true" name="twitter:site" content="@Geuni620"/><meta data-react-helmet="true" name="twitter:creator" content="@Geuni620"/><meta data-react-helmet="true" name="google-site-verification" content="bHJqVdOg6rrFDK-dWGOElA4Egv3IPQlc-COuY76j678"/><meta data-react-helmet="true" name="naver-site-verification" content="1c3c437586a7b1a24609a56a8bf7adbb6ba019c2"/><meta data-react-helmet="true" name="msapplication-TileColor" content="#da532c"/><meta data-react-helmet="true" name="theme-color" content="#ffffff"/><meta data-react-helmet="true" name="google-adsense-account" content="ca-pub-9901489090188954"/><style data-href="/styles.710ba525502dd431a17c.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XWJMDQNM9B"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-XWJMDQNM9B', {"send_page_view":false});
      }
      </script><link rel="canonical" href="https://geuni620.github.io/blog/2024/1/17/authorization/" data-baseprotocol="https:" data-basehost="geuni620.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><title data-react-helmet="true">next-auth를 활용한 인증 및 인가 이해하기</title><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png"/><link data-react-helmet="true" rel="manifest" href="assets/favicon/site.webmanifest"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .headerElement.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .headerElement.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .headerElement svg,
    h2 .headerElement svg,
    h3 .headerElement svg,
    h4 .headerElement svg,
    h5 .headerElement svg,
    h6 .headerElement svg {
      visibility: hidden;
    }
    h1:hover .headerElement svg,
    h2:hover .headerElement svg,
    h3:hover .headerElement svg,
    h4:hover .headerElement svg,
    h5:hover .headerElement svg,
    h6:hover .headerElement svg,
    h1 .headerElement:focus svg,
    h2 .headerElement:focus svg,
    h3 .headerElement:focus svg,
    h4 .headerElement:focus svg,
    h5 .headerElement:focus svg,
    h6 .headerElement:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 17q84ie">.css-17q84ie{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}@media (max-width: 768px){.css-17q84ie{width:90%;margin:0 auto;}}</style><main class="css-17q84ie e1strnqo0"><style data-emotion="css-global 16rkkz4">@import url('<https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap>');*{padding:0;margin:0;box-sizing:border-box;font-family:'Jua',sans-serif;}html,body,#___gatsby{height:100%;}a,a:hover{color:inherit;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}</style><style data-emotion="css kxznun">.css-kxznun{position:fixed;width:100%;top:0px;left:0;color:#ffffff;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);box-shadow:rgb(0 0 0 / 8%) 0px 0px 8px;opacity:1;-webkit-transition:top 0.5s ease 0s,opacity 0.5s ease 0s;transition:top 0.5s ease 0s,opacity 0.5s ease 0s;z-index:999;}</style><header class="css-kxznun e7v9byn3"><style data-emotion="css rwmuo">.css-rwmuo{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0 auto;padding:10px 60px;}@media (max-width: 768px){.css-rwmuo{padding:10px 20px;}}</style><div class="css-rwmuo e7v9byn2"><a href="/"><style data-emotion="css chhkyo">.css-chhkyo{width:50px;height:50px;padding:5px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;border-radius:50%;isolation:isolate;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-chhkyo e1n1u3tj0"><div style="max-width:120px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;120&#x27; width=&#x27;120&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC0ElEQVQ4y3XQOY/bRhTA8fk6qVO5TJkyadzGhQFXMYwcRQpL5urelcjhfYjHkOI15PCU5F0du/loxsxItmDAwMN088P/PTDV86mOJ1ox0fBYLcZqMVLykZLfyZkAMwHm/P0EkyGMB1I0lOKhGA/E+KMYgrlZzIxyZhQznTAlZ5OOVTojJb2TEzaZAFMBbgSYDqVsKKVDKQULu5ibZG4Wc6uYmXhm4JmRT/V8ouGJlo01TiQjhb6CEt/JMWvJPsEUPKzLB6e8d4qFgxc2nlt4ZuK5eSX0bKJlPIcqHJITQU4FJQMrr1q6ZLmm/++d4mFd3DvlwsYLO2cb4amRc2jK/l/WUZORlgDo1SuvktYE+o0S9QPRHyzdpUtoi40XFp4zhUPU0vlRsomWAtlvNNSPYfj67T/LdfnnYPXu34mdH1hFyUIKBhUUsvCtAtSg1VH/YOG/BfnN+8FPr379+Zff/puZS4/Qddgwpbwq304DjKhXUWdEvRb2fw2k3/94/+Gj+GEoLV0i+rXoVyuvutzlRuEEMDc7I9wa0Ra6BK6Jkz4a8U5P9hC1UtBIfgP9WvJq0a+/EhfFKYGd7K14Z8ZbK97ZyV4POz3s1KBVUaeiDqJWCVrFb2SfQqJXi+zAoktWLgFO+tlO9pxgys7cbI2oN6Jej3o17OigjhIBawloC6RKBdbZ4zp7dNLPfKhyhawrpIedFnZK2MqogaiRGSEFDfDwwc2f+NxCtznGZmtutjo9Kg2RUQtRKwcNCMqjX1zmR5CV7M2vITcKQOQYlMegPAXl6aocPPzk5ofviMtSLIRfBITVOaxOITmF5BgQSgQ/CLn9zwkQ189xdY6r86Y6RZQ4IXJGNyEe5iHfE3ayB2nzkjYvSf28aZ7jmitnqpQnREOOQXkIigPbhS/yjQBZ+5K2/2eMiJlC/9fnqDpvCG1B5BiWR1Qe/JITTx7mt9h/AXx87LWuwqpGAAAAAElFTkSuQmCC" alt=""/><picture><source type="image/webp" data-srcset="/static/da11a08871bbdad7fcdece0ebc7459ce/2b147/profile-image.webp 30w,/static/da11a08871bbdad7fcdece0ebc7459ce/caa3b/profile-image.webp 60w,/static/da11a08871bbdad7fcdece0ebc7459ce/b15f9/profile-image.webp 120w,/static/da11a08871bbdad7fcdece0ebc7459ce/b5014/profile-image.webp 240w" sizes="(min-width: 120px) 120px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 120px) 120px, 100vw" decoding="async" loading="lazy" data-src="/static/da11a08871bbdad7fcdece0ebc7459ce/bbf83/profile-image.jpg" data-srcset="/static/da11a08871bbdad7fcdece0ebc7459ce/a8e5a/profile-image.jpg 30w,/static/da11a08871bbdad7fcdece0ebc7459ce/bea51/profile-image.jpg 60w,/static/da11a08871bbdad7fcdece0ebc7459ce/bbf83/profile-image.jpg 120w,/static/da11a08871bbdad7fcdece0ebc7459ce/7793c/profile-image.jpg 240w" alt="Profile Image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/da11a08871bbdad7fcdece0ebc7459ce/2b147/profile-image.webp 30w,/static/da11a08871bbdad7fcdece0ebc7459ce/caa3b/profile-image.webp 60w,/static/da11a08871bbdad7fcdece0ebc7459ce/b15f9/profile-image.webp 120w,/static/da11a08871bbdad7fcdece0ebc7459ce/b5014/profile-image.webp 240w" sizes="(min-width: 120px) 120px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 120px) 120px, 100vw" decoding="async" loading="lazy" src="/static/da11a08871bbdad7fcdece0ebc7459ce/bbf83/profile-image.jpg" srcSet="/static/da11a08871bbdad7fcdece0ebc7459ce/a8e5a/profile-image.jpg 30w,/static/da11a08871bbdad7fcdece0ebc7459ce/bea51/profile-image.jpg 60w,/static/da11a08871bbdad7fcdece0ebc7459ce/bbf83/profile-image.jpg 120w,/static/da11a08871bbdad7fcdece0ebc7459ce/7793c/profile-image.jpg 240w" alt="Profile Image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a><style data-emotion="css 129macj">.css-129macj{position:absolute;top:2rem;left:7rem;padding:0.5rem 1rem;background-color:white;border-radius:0.5rem;box-shadow:0 8px 16px rgba(0, 0, 0, 0.1);-webkit-animation:float 2s ease-in-out infinite;animation:float 2s ease-in-out infinite;}.css-129macj::before{content:'';position:absolute;left:-8px;top:20%;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);border:4px solid transparent;border-right-color:white;rotate:10deg;}@-webkit-keyframes float{0%,100%{-webkit-transform:translateY(0);-moz-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}50%{-webkit-transform:translateY(-4px);-moz-transform:translateY(-4px);-ms-transform:translateY(-4px);transform:translateY(-4px);}}@keyframes float{0%,100%{-webkit-transform:translateY(0);-moz-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}50%{-webkit-transform:translateY(-4px);-moz-transform:translateY(-4px);-ms-transform:translateY(-4px);transform:translateY(-4px);}}@media (max-width: 768px){.css-129macj{left:4.5rem;}}</style><div class="css-129macj e7v9byn1"><style data-emotion="css 11cmwhy">.css-11cmwhy{display:block;margin-top:0.25rem;font-size:0.75rem;color:#3182ce;-webkit-text-decoration:none;text-decoration:none;-webkit-transition:color 0.2s;transition:color 0.2s;}.css-11cmwhy:hover{color:#2c5282;}</style><a href="https://www.geuni.me/" target="_blank" class="css-11cmwhy e7v9byn0">블로그를 옮겼어요.</a></div></div></header><style data-emotion="css 1xpwfc9">.css-1xpwfc9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-1xpwfc9 e6b6ljm1"><style data-emotion="css 1vsj6bx">@media (max-width: 768px){.css-1vsj6bx{width:100%;}}</style><div class="css-1vsj6bx e6b6ljm0"><style data-emotion="css pw7jst">.css-pw7jst{position:relative;width:100%;}</style><div class="css-pw7jst e1opi4mu0"><style data-emotion="css 16n2vrb">.css-16n2vrb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding:100px 0px 60px 0px;color:#ffffff;}@media (max-width: 768px){.css-16n2vrb{width:100%;}}</style><div class="css-16n2vrb e1st1jau2"><style data-emotion="css 1qqkx4z">.css-1qqkx4z{margin-top:20px;color:black;font-size:45px;font-weight:800;}@media (max-width: 768px){.css-1qqkx4z{font-size:28px;}}</style><div class="css-1qqkx4z e1st1jau1">next-auth를 활용한 인증 및 인가 이해하기</div><style data-emotion="css vpbqf9">.css-vpbqf9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:black;margin-top:10px;font-size:18px;font-weight:700;}</style><div class="css-vpbqf9 e1st1jau0"><div>개발</div><div>2024.01.21.</div></div></div></div><style data-emotion="css u9yaza">.css-u9yaza{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding-bottom:50px;word-break:break-all;font-size:18px;font-weight:400;}.css-u9yaza p{padding:3px 0;margin-bottom:1.5rem;line-height:1.6em;}.css-u9yaza h1,.css-u9yaza h2,.css-u9yaza h3{font-weight:800;margin-bottom:1.5rem;}.css-u9yaza *+h1,.css-u9yaza *+h2,.css-u9yaza *+h3{margin-top:0.5rem;}.css-u9yaza hr+h1,.css-u9yaza hr+h2,.css-u9yaza hr+h3{margin-top:0;}.css-u9yaza h1{font-size:50px;}.css-u9yaza h2{font-size:40px;}.css-u9yaza h3{font-size:30px;}.css-u9yaza blockquote{padding:20px;border-left:5px solid #a3aaae;font-weight:400;font-style:normal;line-height:28px;font-size:18px;color:#000;background-color:#f7f7f7;margin-bottom:1.5rem;}.css-u9yaza blockquote p{margin:10px 0;}.css-u9yaza ol,.css-u9yaza ul{margin-bottom:1.5rem;margin-left:20px;}.css-u9yaza ul>li:has(input[type='checkbox']){list-style:none;}.css-u9yaza .contains-task-list{margin-left:0;}.css-u9yaza li{margin-bottom:0.5em;}.css-u9yaza hr{border:1px solid rgb(233, 236, 239);margin-bottom:48px;}.css-u9yaza a{color:#0687f0;font-weight:500;-webkit-transition:all 0.3s ease-in-out;transition:all 0.3s ease-in-out;}.css-u9yaza a:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-u9yaza pre[class*='language-']{margin:0 0 30px 0;padding:15px;font-size:15px;}.css-u9yaza code[class*='language-'],.css-u9yaza pre[class*='language-']{tab-size:2;font-size:14px;}.css-u9yaza li code,.css-u9yaza p code{color:#eb5757;background-color:hsla(44, 6%, 50%, 0.15);}.css-u9yaza figcaption{font-size:14px;margin-top:5px;text-align:center;color:#888;}.css-u9yaza p strong{font-weight:700;}.css-u9yaza input[type='checkbox']{width:18px;height:18px;vertical-align:middle;margin-right:5px;}@media (max-width: 768px){.css-u9yaza{width:100%;line-height:1.6;font-size:14px;}.css-u9yaza h1{font-size:23px;}.css-u9yaza h2{font-size:20px;}.css-u9yaza h3{font-size:17px;}.css-u9yaza img{width:100%;}.css-u9yaza hr{margin:50px 0;}}</style><div class="css-u9yaza e1ijh0y10"><ul>
<li>작성했던 관련 글<br>
<a href="https://geuni620.github.io/blog/2023/8/18/next-auth/" target="_blank" rel="nofollow">next-auth token 관리하기-1</a><br>
<a href="https://geuni620.github.io/blog/2023/8/24/next-auth/" target="_blank" rel="nofollow">next-auth token 관리하기-2</a><br>
<a href="https://geuni620.github.io/blog/2023/8/28/next-auth/" target="_blank" rel="nofollow">next-auth token 관리하기-3</a><br>
<a href="https://geuni620.github.io/blog/2023/9/10/next-auth/" target="_blank" rel="nofollow">next-auth token 관리하기-4</a></li>
</ul>
<br/>
<h1 id="1-token의-필요성" style="position:relative;"><a href="#1-token%EC%9D%98-%ED%95%84%EC%9A%94%EC%84%B1" aria-label="1 token의 필요성 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. Token의 필요성</h1>
<p>사이드프로젝트를 진행하다가 의문점이 하나 생겼다.<br>
next-auth를 사용해 로그인을 했는데(=인증),<br>
<strong>API요청시 Token을 header에 포함시켜서 요청을 보내지 않는다.</strong>(=인가)</p>
<p>요청을 보낼 때 유저를 구분하는 기준이 <code class="language-text">userId</code>이다.<br>
<strong>즉, Token을 전혀 사용하고 있지 않다.</strong></p>
<br/>
<p>머리속에 의문점이 떠올랐다.</p>
<blockquote>
<p>💬 userId를 다른 사용자가 알고 있다면, postman이나, thunder-client로 DB 데이터를 꺼내오거나,<br>
수정할 수 있는 거 아닌가? 심지어 삭제까지.</p>
</blockquote>
<p>그래서 확인해보고 싶어졌다. 과연, userId를 알고 있다면 DB에 데이터를 보낼 수 있을까?</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/f58547be52f058831a14fd4aef3010b4/3f8e8/thuner-client.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXElEQVQoz22R2W7bMBBF9SupNrtBHK1cRIm0KMtxEjgv/f9vOQUpIW6LPlxyBrxzcAdMTuaMvLzT+xtiuaGvnzTnlbxRHOWEfL9zlCOdW/lpDZmRhJmjHSgHHetiUGSNJKslyaE3cbDsBqpp4WTmWB/FRHgrWh17dfmgmnyEl/1I3htKYTiI0A9bADGShKNoh6g8DhvK/qHtXfP0KmjMgLtYGj0i1UjZKNJKkNcyAp/lRBIiHzpN2SryelNWbfGLYFIhvSarFb2dIlDOjuW60FlL0ekIC/64srCG+5fHf3jc18r860Z9djtkB7cbcPIT/uoYlhl584g3T+3sNzDcyUkbhB15GSfa5YxYZ561IW8fpgBMa8VytXzeZ8wyI7yj8Y6y19++mDCtJU+vkrSS/DiJqHRf+U9g1iiqweBWixwnFut46Ybo/Sth3mzF//QAqvhh8fP2vtyV/TPzG1YSAlFSNOw+AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/f58547be52f058831a14fd4aef3010b4/a59e9/thuner-client.webp 192w,
/static/f58547be52f058831a14fd4aef3010b4/0ca9f/thuner-client.webp 384w,
/static/f58547be52f058831a14fd4aef3010b4/dc9b9/thuner-client.webp 768w,
/static/f58547be52f058831a14fd4aef3010b4/e2c2f/thuner-client.webp 1152w,
/static/f58547be52f058831a14fd4aef3010b4/f3efb/thuner-client.webp 1536w,
/static/f58547be52f058831a14fd4aef3010b4/4c6e1/thuner-client.webp 1976w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/f58547be52f058831a14fd4aef3010b4/3b721/thuner-client.png 192w,
/static/f58547be52f058831a14fd4aef3010b4/66595/thuner-client.png 384w,
/static/f58547be52f058831a14fd4aef3010b4/fe486/thuner-client.png 768w,
/static/f58547be52f058831a14fd4aef3010b4/d2d74/thuner-client.png 1152w,
/static/f58547be52f058831a14fd4aef3010b4/e8464/thuner-client.png 1536w,
/static/f58547be52f058831a14fd4aef3010b4/3f8e8/thuner-client.png 1976w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/f58547be52f058831a14fd4aef3010b4/fe486/thuner-client.png"
            alt="큰일이다;"
            title="큰일이다;"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">큰일이다;</figcaption>
  </figure></p>
<p>위 이미지처럼 vercel로 임시 배포한 상태로 thunder-client에 데이터를 요청해봤다.<br>
<code class="language-text">userId</code>와 <code class="language-text">recipientId</code>는 사용자가 다른사람에게 공유하기 위해, 노출되는 부분이다.<br>
즉, 누구나 쉽게 확인 가능하다.</p>
<p>그렇다면 <code class="language-text">userId</code>나, <code class="language-text">recipientId</code>만 알고 있다면 누구나 DB 데이터를 요청할 수 있고, 삭제도 가능하다는 것이다. 만약 DB의 데이터를 보호해야한다면, <code class="language-text">userId</code>만으로 서버 데이터를 반환하기엔 무리가 있다고 생각되었다.</p>
<p><strong>이때 Token이 필요하다.</strong></p>
<blockquote>
<p>참고로 기획 특성상, 사이드프로젝트에선 Token이 필요하지 않다. 익명으로 누구나 글을 쓸 수 있도록 했고, Delete API는 존재하지 않기 때문이다.</p>
</blockquote>
<br/>
<h1 id="2-next-auth-token-관리-방법" style="position:relative;"><a href="#2-next-auth-token-%EA%B4%80%EB%A6%AC-%EB%B0%A9%EB%B2%95" aria-label="2 next auth token 관리 방법 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. next-auth Token 관리 방법</h1>
<p>next-auth의 token을 관리하는 방법에 대해서 알아보자.<br>
next-auth에선 크게 Token을 관리하는 방법을 <a href="https://next-auth.js.org/getting-started/upgrade-v4#session-strategy" target="_blank" rel="nofollow">2가지</a> 소개한다.<br>
첫번째는, <strong>JWT로 관리하는 방법</strong>이고, 두 번째는 <strong>DB에서 관리하는 방법</strong>이다.</p>
<p>이전 글을 쓸 당시엔, <strong>DB에 token 정보를 담고 싶지 않았다.</strong><br>
(당시엔 임시로그인 성향이 강했다. 변경될 여지가 많았기 때문에, DB에서 관리하고 싶지 않았다.)</p>
<p>그래서 JWT를 사용했다.<br>
JWT가 아닌, DB에서 Token을 관리하려면 next-auth에선 편하게 <a href="https://next-auth.js.org/adapters" target="_blank" rel="nofollow">adapter</a>를 제공해준다.</p>
<p>JWT로 Token을 관리할 때 크게 session, access, refresh token을 사용했다.<br>
여기서 session은 인증을, access와 refresh는 인가에 사용했다.</p>
<br/>
<h2 id="2-1-인증authentication과-인가authorization가-뭘까" style="position:relative;"><a href="#2-1-%EC%9D%B8%EC%A6%9Dauthentication%EA%B3%BC-%EC%9D%B8%EA%B0%80authorization%EA%B0%80-%EB%AD%98%EA%B9%8C" aria-label="2 1 인증authentication과 인가authorization가 뭘까 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2-1. 인증(Authentication)과 인가(Authorization)가 뭘까?</h2>
<p>초반에는 둘의 개념이 너무 헷갈렸다.
이를 가장 잘 설명해준 <a href="https://youtu.be/y0xMXlOAfss?si=6oSS8O34KMrJhaS3&#x26;t=62" target="_blank" rel="nofollow">영상</a>을 찾았다.</p>
<p>해당 영상의 설명을 조금 빌려서 이야기해보자면,<br>
(나는.. 이상하게 군대밖에 생각나지 않는다.)</p>
<p>휴가를 다녀온 21살의 나, 첫 휴가 복귀할 때 위병소에서 휴가증을 보여주며 복귀를 알린다.
이때 나의 신원을 조회하는 헌병들, 휴가복귀자임을 확인한 후 위병소를 통과시켜준다.
이게 인증이라고 이해했다.</p>
<br/>
<p>복귀하고 일 주일 후, 훈련에 참여하게 된 나.<br>
내일 있을 사격훈련을 위해 미리 연습한다는 선임<br>
나에게 총기를 가져오라고 시킨다. 나는, 총기보관함에 뚜벅뚜벅 걸어가지만, 그 앞에 서있는 경계병들.<br>
그들은 나에게 신원을 확인하지만, 총기보관함에서 총기를 가져갈 권한이 없는 나는 그대로 돌아오게 된다.<br>
이게 인가라고 이해했다.</p>
<br/>
<p>즉 다시 정리해보면 다음과 같다.</p>
<blockquote>
<p>인증(Authentication): 서비스에 등록된 유저의 신원을 입증하는 과정 (=로그인)<br>
인가(Authorization): 인증된 사용자에 대한 자원 접근 권한 확인 (=API 요청에 따른 해당 유저의 데이터 반환)</p>
</blockquote>
<br/>
<h1 id="3-next-auth는-인증을-어떻게-유지할까" style="position:relative;"><a href="#3-next-auth%EB%8A%94-%EC%9D%B8%EC%A6%9D%EC%9D%84-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9C%A0%EC%A7%80%ED%95%A0%EA%B9%8C" aria-label="3 next auth는 인증을 어떻게 유지할까 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. next-auth는 인증을 어떻게 유지할까?</h1>
<p>next-auth로 간단히 login을 구현해보자.<br>
이번에도 DB에 Token을 저장하지 않고, <strong>JWT를 사용했다.</strong><br>
그리고 이를 위해, google oauth를 사용했다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// app/api/auth/[...nextauth].ts</span>
<span class="token keyword">import</span> NextAuth <span class="token keyword">from</span> <span class="token string">'next-auth/next'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> GoogleProvider <span class="token keyword">from</span> <span class="token string">'next-auth/providers/google'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">NextAuth</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  secret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXTAUTH_SECRET</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">GoogleProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GOOGLE_CLIENT_ID</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
      clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GOOGLE_CLIENT_SECRET</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  session<span class="token operator">:</span> <span class="token punctuation">{</span>
    strategy<span class="token operator">:</span> <span class="token string">'jwt'</span><span class="token punctuation">,</span>
    <span class="token comment">// Seconds - How long until an idle ses</span>
    maxAge<span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 30 days</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> handler <span class="token keyword">as</span> <span class="token constant">GET</span><span class="token punctuation">,</span> handler <span class="token keyword">as</span> <span class="token constant">POST</span> <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>인증과정을 거쳐서 로그인이 됐다!</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/b6eb989c6ef285e148aa3371b54b58b0/5e075/success-login.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 45.833333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABPklEQVQoz52RS1PCMBSF8///kAudcUGRogio4wB9lz5om6SFAm3VxXHuhTJsXMjim5ucSXLuuRF39w94HBgYvUwwME2sPB8r17sZYZhjDMfPWDgOFrYD2w9uJwghoiRFua0hdYVCaeSFYrJc/otcKoRRApHlBeIkxTpKoFSJen9kmvbrwrHpmMOxxeHQnmvD7M80TceNCF1tkecSk9cZojiF7XhYLC1IVTKF1Ki2Ncpqx0b9w71Jb9p235C6hKCDhDF8guP6WK5sTKdzNhiZYxjDEWbzN7x/fLJZkmaIkw2CMIIfrOF6PizbhesFrAmpNDZZwZEpPnW0jmKeC3VMOtUeSpNucuZaJyOqgmLRJc8PeAbkbtkOa5blwPPDi0aVol3H7Pdt94NdvYeI6DN0dZkZocvT/lrv15TgbxR+AeMAl5WgbFUcAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/b6eb989c6ef285e148aa3371b54b58b0/a59e9/success-login.webp 192w,
/static/b6eb989c6ef285e148aa3371b54b58b0/0ca9f/success-login.webp 384w,
/static/b6eb989c6ef285e148aa3371b54b58b0/dc9b9/success-login.webp 768w,
/static/b6eb989c6ef285e148aa3371b54b58b0/e2c2f/success-login.webp 1152w,
/static/b6eb989c6ef285e148aa3371b54b58b0/f3741/success-login.webp 1338w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/b6eb989c6ef285e148aa3371b54b58b0/3b721/success-login.png 192w,
/static/b6eb989c6ef285e148aa3371b54b58b0/66595/success-login.png 384w,
/static/b6eb989c6ef285e148aa3371b54b58b0/fe486/success-login.png 768w,
/static/b6eb989c6ef285e148aa3371b54b58b0/d2d74/success-login.png 1152w,
/static/b6eb989c6ef285e148aa3371b54b58b0/5e075/success-login.png 1338w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/b6eb989c6ef285e148aa3371b54b58b0/fe486/success-login.png"
            alt="로그인이 됐다!"
            title="로그인이 됐다!"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">로그인이 됐다!</figcaption>
  </figure></p>
<p>하지만 next-auth는 이 로그인을 어떻게 유지하는걸까?<br>
페이지를 닫았다가, 열어도 로그인이 유지된다.</p>
<p>단, 다른 브라우저로 열거나 크롬의 시크릿모드로 열었을 땐, 로그인이 유지되지 않는다.<br>
즉, 브라우저 어딘가에서 유저 정보를 저장하고 있는 것 같다.</p>
<br/>
<h2 id="3-1-로그인-했을-때-브라우저에-저장되는-정보" style="position:relative;"><a href="#3-1-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%96%88%EC%9D%84-%EB%95%8C-%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%EC%97%90-%EC%A0%80%EC%9E%A5%EB%90%98%EB%8A%94-%EC%A0%95%EB%B3%B4" aria-label="3 1 로그인 했을 때 브라우저에 저장되는 정보 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3-1. 로그인 했을 때 브라우저에 저장되는 정보</h2>
<p>크게 로그인 정보는 <code class="language-text">localStorage</code>나 <code class="language-text">SessionStorage</code>, 또는 <code class="language-text">cookie</code>에 저장할 수 있다.<br>
구글 시크릿모드로 열어서, <strong>로그인 하기전에</strong> localStorage와 SessionStorage, cookie를 확인해보자.</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/dc7a9b1c5902eff00f4236ef2cd62392/89066/local-storage.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 42.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABVUlEQVQoz42Q3U7jMBCF8/5P1AWkveJmVRYu2CgrqnZLkobEjhP/tEnz9yGbgpDgYkf6dEZnPB6Po+3qBw+3ax5v79g8JFR/npCPMVkpybKCSiqOpzPWdbhjT6Mdh6KieKkoShE0P7yQH0pa7YiK3/esV1fcX/9kvbrh3687bCmxxxPWuoCx9pJbjFd3xDr3FeuItNH8TWJ22w0nZ5nGM/0w0rYtWusvtN94n4mUUux2O4SULMA8z3TdmbbVGGO+aTKBUHuvX9R7kXOOLMsoioI0TfED+n4Ih6zHr2lsUI/3zSfe6uZjeCSEIEkS4jhmv9/DstCfR4RQqEYjahWGCFlTVjJ4sm5QTUvTGupLXpYCYxyRXy1NM7Isp64VPiZApSXV0zP5Zkv6XFCJOvzrMAz0fR/U03XdhzdNE5G/yJPnh/BsH/MCyzgzuo6hH7CnkWnmv+IVrb1e7iX2O7UAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/dc7a9b1c5902eff00f4236ef2cd62392/a59e9/local-storage.webp 192w,
/static/dc7a9b1c5902eff00f4236ef2cd62392/0ca9f/local-storage.webp 384w,
/static/dc7a9b1c5902eff00f4236ef2cd62392/dc9b9/local-storage.webp 768w,
/static/dc7a9b1c5902eff00f4236ef2cd62392/e2c2f/local-storage.webp 1152w,
/static/dc7a9b1c5902eff00f4236ef2cd62392/95f20/local-storage.webp 1440w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/dc7a9b1c5902eff00f4236ef2cd62392/3b721/local-storage.png 192w,
/static/dc7a9b1c5902eff00f4236ef2cd62392/66595/local-storage.png 384w,
/static/dc7a9b1c5902eff00f4236ef2cd62392/fe486/local-storage.png 768w,
/static/dc7a9b1c5902eff00f4236ef2cd62392/d2d74/local-storage.png 1152w,
/static/dc7a9b1c5902eff00f4236ef2cd62392/89066/local-storage.png 1440w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/dc7a9b1c5902eff00f4236ef2cd62392/fe486/local-storage.png"
            alt="Local Storage"
            title="Local Storage"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">Local Storage</figcaption>
  </figure><br>
<figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e2b3de320acb50e8b893d01ec4ff3940/89066/session-storage.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 42.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA80lEQVQoz5WRbUvDQBCE8///jwhCqPgGldL6wcYETSHpXSOmiTUGqeZuH0nTSJpQxYGBvdvbuRnWycOAeDomuZ/x+vSASSJs+Y4REBFsj8YKxtjBfUtHuS63oytm5zdMRtcs7jy2gQ/W0EDoQg6PAzjxxSXjkzMmpy7xdI6ezSnDxU5I9i5b1rCduttr6ayzNeFjwMvzClt98rX9oDK28SXy4+iY4MBhWZYorUmSBKUUeZ5jpX08HP5TME1TfN/H8zyiKELEYixUZr+Af9LZbN5YLhVKabIs3/1SN/pRf6sPHNZCNbVeURRFE8sOY/UXcWzj34+2bdzuVyqWAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e2b3de320acb50e8b893d01ec4ff3940/a59e9/session-storage.webp 192w,
/static/e2b3de320acb50e8b893d01ec4ff3940/0ca9f/session-storage.webp 384w,
/static/e2b3de320acb50e8b893d01ec4ff3940/dc9b9/session-storage.webp 768w,
/static/e2b3de320acb50e8b893d01ec4ff3940/e2c2f/session-storage.webp 1152w,
/static/e2b3de320acb50e8b893d01ec4ff3940/95f20/session-storage.webp 1440w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/e2b3de320acb50e8b893d01ec4ff3940/3b721/session-storage.png 192w,
/static/e2b3de320acb50e8b893d01ec4ff3940/66595/session-storage.png 384w,
/static/e2b3de320acb50e8b893d01ec4ff3940/fe486/session-storage.png 768w,
/static/e2b3de320acb50e8b893d01ec4ff3940/d2d74/session-storage.png 1152w,
/static/e2b3de320acb50e8b893d01ec4ff3940/89066/session-storage.png 1440w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e2b3de320acb50e8b893d01ec4ff3940/fe486/session-storage.png"
            alt="Session Storage"
            title="Session Storage"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">Session Storage</figcaption>
  </figure><br>
<figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2d89f9bc6eb8b50454ec57960da3ef9e/89066/cookie.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 42.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABLElEQVQoz52Py04CQRBF+f8/0oUL40aNAlEHGc3oKAgMMN1V3fOSxzHdRnTjQis5ya1K163bPe89SZKQZRnOOUJZ1/KY5Tw9v7AuhfvxA5PpnNXaslwZktEYX7WURqnqjmJVYsVTrB09YyyBzWbLV1XtDlEf587XiDrUeeqmpapbVB1tt4m6e99S1Q1N22FdQ68oChaLBapKXdfs9zvEN1hRqsrH5ZA8IKqRqEXjofAu7AZWpdALIk1T8jyPeOdQ31Aai6rEBRGJBP3d66H/nCnLdTB0jvvRiIc05SXPUbFo1VEaiVdFfuen2cHQ9C8YnRzxen4Gs1eYZLinDBO/In83tKfHZIMrpsNr3m6HLO+G+P4l1tr/JdQs5e1mwCyYjRN28wluNsdY+VfCD2hsXZKmKiwLAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/2d89f9bc6eb8b50454ec57960da3ef9e/a59e9/cookie.webp 192w,
/static/2d89f9bc6eb8b50454ec57960da3ef9e/0ca9f/cookie.webp 384w,
/static/2d89f9bc6eb8b50454ec57960da3ef9e/dc9b9/cookie.webp 768w,
/static/2d89f9bc6eb8b50454ec57960da3ef9e/e2c2f/cookie.webp 1152w,
/static/2d89f9bc6eb8b50454ec57960da3ef9e/95f20/cookie.webp 1440w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/2d89f9bc6eb8b50454ec57960da3ef9e/3b721/cookie.png 192w,
/static/2d89f9bc6eb8b50454ec57960da3ef9e/66595/cookie.png 384w,
/static/2d89f9bc6eb8b50454ec57960da3ef9e/fe486/cookie.png 768w,
/static/2d89f9bc6eb8b50454ec57960da3ef9e/d2d74/cookie.png 1152w,
/static/2d89f9bc6eb8b50454ec57960da3ef9e/89066/cookie.png 1440w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/2d89f9bc6eb8b50454ec57960da3ef9e/fe486/cookie.png"
            alt="Cookie"
            title="Cookie"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">Cookie</figcaption>
  </figure></p>
<p>Session Storage에는 아무것도 존재하지 않는다.<br>
하지만 Local Storage와 Cookie에는 next-auth의 정보가 저장된다.</p>
<h3 id="local-storage에-저장되는-정보" style="position:relative;"><a href="#local-storage%EC%97%90-%EC%A0%80%EC%9E%A5%EB%90%98%EB%8A%94-%EC%A0%95%EB%B3%B4" aria-label="local storage에 저장되는 정보 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Local Storage에 저장되는 정보</h3>
<p>먼저, LocalStorage에는 정보가 저장될거라 예상못했는데, 확인해보자.<br>
자세히 보니, <code class="language-text">getSession</code>이라는 단어가 가장 먼저 눈에 띄었다.<br>
next-auth에서 <a href="https://next-auth.js.org/getting-started/client#getsession" target="_blank" rel="nofollow">getSession</a>이라는 API를 제공하는데 그 역할이 무엇인지 확인해봤다.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">When called, getSession() will send a request to /api/auth/session
and returns a promise with a session object, or null if no session exists.

호출되면 getSession()은 /api/auth/session으로 요청을 보내고
세션 객체가 있는 프로미스를 반환하거나 세션이 존재하지 않는 경우 null을 반환합니다.</code></pre></div>
<p>세션정보를 요청하고, 세션객체가 있다면 세션에 담긴 정보를, 세션이 없다면 null을 반환하는 걸로 보인다.</p>
<br/>
<p>그 다음엔 어떻게 했을 때, localStorage에 이 정보가 저장되는지 확인해봤다.<br>
next-auth를 사용하기 위해선, 다음과 같이 SessionProvider를 감싸줘야한다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> SessionProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next-auth/react'</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Props</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  children<span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> AuthContext<span class="token operator">:</span> React<span class="token punctuation">.</span><span class="token constant">FC</span><span class="token operator">&lt;</span>Props<span class="token operator">></span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SessionProvider</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">SessionProvider</span></span><span class="token punctuation">></span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>SessionProvider로 감싸줘야, useSession hook을 클라이언트 환경에서 사용할 수 있기 때문이다.<br>
(참고로, 서버에서 사용하려면, <a href="https://next-auth.js.org/configuration/nextjs#getserversession" target="_blank" rel="nofollow">getServerSession</a>을 사용한다.)</p>
<br/>
<p>근데 이 provider를 감싸지 않으니, localStorage에 더 이상 정보가 저장되지 않았다.<br>
그래서 <a href="https://github.com/nextauthjs/next-auth/blob/a595ca72595b2bd350b23068f9e437726cef9a9d/packages/next-auth/src/react.tsx#L337" target="_blank" rel="nofollow">SessionProvider 내부</a>를 한 번 확인해봤다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getSession</span><span class="token punctuation">(</span>params<span class="token operator">?</span><span class="token operator">:</span> GetSessionParams<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token generic-function"><span class="token function">fetchData</span><span class="token generic class-name"><span class="token operator">&lt;</span>Session<span class="token operator">></span></span></span><span class="token punctuation">(</span>
    <span class="token string">"session"</span><span class="token punctuation">,</span>
    __NEXTAUTH<span class="token punctuation">,</span>
    logger<span class="token punctuation">,</span>
    params
  <span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token operator">?.</span>broadcast <span class="token operator">??</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">broadcast</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// broadcast???</span>
      event<span class="token operator">:</span> <span class="token string">"session"</span><span class="token punctuation">,</span>
      data<span class="token operator">:</span> <span class="token punctuation">{</span> trigger<span class="token operator">:</span> <span class="token string">"getSession"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> session
<span class="token punctuation">}</span></code></pre></div>
<p>SessionProvider 내부에 getSession이 존재하고, getSession에서 broadcast가 존재한다.<br>
이 broadcast를 찾아보니, localStorage에 저장하는 로직을 발견했다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// node_modules/next-auth/src/client/_utils.ts</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">BroadcastChannel</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"nextauth.message"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">/** Get notified by other tabs/windows. */</span>
    <span class="token function">receive</span><span class="token punctuation">(</span><span class="token function-variable function">onReceive</span><span class="token operator">:</span> <span class="token punctuation">(</span>message<span class="token operator">:</span> BroadcastMessage<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> StorageEvent<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>key <span class="token operator">!==</span> name<span class="token punctuation">)</span> <span class="token keyword">return</span>
        <span class="token keyword">const</span> message<span class="token operator">:</span> BroadcastMessage <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>newValue <span class="token operator">??</span> <span class="token string">"{}"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token operator">?.</span>event <span class="token operator">!==</span> <span class="token string">"session"</span> <span class="token operator">||</span> <span class="token operator">!</span>message<span class="token operator">?.</span>data<span class="token punctuation">)</span> <span class="token keyword">return</span>

        <span class="token function">onReceive</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"storage"</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">"storage"</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/** Notify other tabs/windows. */</span>
    <span class="token function">post</span><span class="token punctuation">(</span>message<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> window <span class="token operator">===</span> <span class="token string">"undefined"</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span> <span class="token comment">// 이 부분</span>
          name<span class="token punctuation">,</span>
          <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">...</span>message<span class="token punctuation">,</span> timestamp<span class="token operator">:</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">{</span>
        <span class="token comment">/**
         * The localStorage API isn't always available.
         * It won't work in private mode prior to Safari 11 for example.
         * Notifications are simply dropped if an error is encountered.
         */</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>즉, 정리해보면</p>
<blockquote>
<p>localStorage에 저장되는 정보는, session의 상태가 변경될 때마다, broadcast를 통해 localStorage에 저장한다.<br>
그리고 다른 탭이나, 윈도우에서도 localStorage에 저장된 정보를 받아서, 세션 정보를 업데이트한다.</p>
</blockquote>
<br/>
<h3 id="cookie에-저장되는-정보" style="position:relative;"><a href="#cookie%EC%97%90-%EC%A0%80%EC%9E%A5%EB%90%98%EB%8A%94-%EC%A0%95%EB%B3%B4" aria-label="cookie에 저장되는 정보 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Cookie에 저장되는 정보</h3>
<p>다음으로, Cookie에 저장되는 정보를 확인해보자.<br>
이번엔 <strong>로그인을 한 후에</strong> 확인해보자.</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2f70140e00371fc2e9f3db92107982cf/4ab23/saved-cookie.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 12.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAr0lEQVQI1x2N0XKDIBBF/f+fq02TtjPtdKoEiYJEAUHU9HTCvuzeO2fOVks6CGknxI3Jr/y2HX7JhLjT3UaM9UilS//90yJkjx4dUpmyh3Gm1xPaupKr8/mduj5xlQrnI6e3Cy/1K9pYmlZi7468Pfj4/OIqO1yILGlDqh4fEn9QmCf/nErdhiKLKRPXDSEkTSMwdmIwtjxZ80ErJNPsi2DNO/fZs8TM8aAwswvl/gcDmOKpZOxSlAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/2f70140e00371fc2e9f3db92107982cf/a59e9/saved-cookie.webp 192w,
/static/2f70140e00371fc2e9f3db92107982cf/0ca9f/saved-cookie.webp 384w,
/static/2f70140e00371fc2e9f3db92107982cf/dc9b9/saved-cookie.webp 768w,
/static/2f70140e00371fc2e9f3db92107982cf/e2c2f/saved-cookie.webp 1152w,
/static/2f70140e00371fc2e9f3db92107982cf/13d4d/saved-cookie.webp 1462w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/2f70140e00371fc2e9f3db92107982cf/3b721/saved-cookie.png 192w,
/static/2f70140e00371fc2e9f3db92107982cf/66595/saved-cookie.png 384w,
/static/2f70140e00371fc2e9f3db92107982cf/fe486/saved-cookie.png 768w,
/static/2f70140e00371fc2e9f3db92107982cf/d2d74/saved-cookie.png 1152w,
/static/2f70140e00371fc2e9f3db92107982cf/4ab23/saved-cookie.png 1462w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/2f70140e00371fc2e9f3db92107982cf/fe486/saved-cookie.png"
            alt="cookie에 저장된 정보들"
            title="cookie에 저장된 정보들"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">cookie에 저장된 정보들</figcaption>
  </figure></p>
<p><strong>💬 <code class="language-text">next-auth.callback-url</code>은 인증을 완료한 뒤, 리다이렉트할 url이다.</strong><br>
예를들어, 로그인을 하고, <code class="language-text">/posts</code>로 리다이렉트하고 싶다면, 다음과 같이 설정하면 된다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// app/page.tsx</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>session <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">환영합니다, </span><span class="token punctuation">{</span>session<span class="token punctuation">.</span>user<span class="token operator">?.</span>name<span class="token punctuation">}</span><span class="token plain-text">!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
          //...
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">로그인을 해주세요.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
            <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
              <span class="token function">signIn</span><span class="token punctuation">(</span><span class="token string">'google'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
                callbackUrl<span class="token operator">:</span> <span class="token string">'http://localhost:3000/posts'</span><span class="token punctuation">,</span> <span class="token comment">// callbackUrl 설정</span>
              <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span></span>
          <span class="token punctuation">></span></span><span class="token plain-text">
            Google로 로그인하기
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>callbackUrl을 지정하고 로그인이 완료되면, 쿠키에 다음과 같이 저장된다.</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/fd364df417af607d3d5b2d57b3d9493f/5040b/cookie-callback-url.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 52.60416666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABWElEQVQoz42Q3U7CQBCF+/6P5I3RaNQLNcYftIBYipRSurttaaHQnc9YCm1MVDY5mdkzZ2fOjjOZzgkjTTBX6LRg8D7mm1Mmx/MDojhl5E157vUZfkyYxwmePyNSGeHCMA1jYpMThIokK3HuXzxun0Y89Hw+4y2PbsD1nYvraV5HCwJt6fuGR3dKoKpa0x+bmp8ZYeAbogxcTzEOVzgLZYhVgk4yyq2gTEYUa0yao5Mlq7IiSQtinbCpqO9Zvq7juqmVGyHNCpbFBofOEZE2b6K10uYiWNnVal7kkH+fyoJTkwe0QitttJ26yI+6bYaIUFnZOdw5a4V7N92He91Pvjuwadg8kG5D+bWh/NdQaL7ScfCXQznGYbOcDuxhyH6nRzfU/R7L4Rv5u0s2eCNxXyi8IXb4SrUuqYRaeAy2leCENxdEV2fMG8wuTwmvz8nPT2C9OqziWHwBFWhXJIpJblwAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/fd364df417af607d3d5b2d57b3d9493f/a59e9/cookie-callback-url.webp 192w,
/static/fd364df417af607d3d5b2d57b3d9493f/0ca9f/cookie-callback-url.webp 384w,
/static/fd364df417af607d3d5b2d57b3d9493f/dc9b9/cookie-callback-url.webp 768w,
/static/fd364df417af607d3d5b2d57b3d9493f/e2c2f/cookie-callback-url.webp 1152w,
/static/fd364df417af607d3d5b2d57b3d9493f/55fcb/cookie-callback-url.webp 1468w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/fd364df417af607d3d5b2d57b3d9493f/3b721/cookie-callback-url.png 192w,
/static/fd364df417af607d3d5b2d57b3d9493f/66595/cookie-callback-url.png 384w,
/static/fd364df417af607d3d5b2d57b3d9493f/fe486/cookie-callback-url.png 768w,
/static/fd364df417af607d3d5b2d57b3d9493f/d2d74/cookie-callback-url.png 1152w,
/static/fd364df417af607d3d5b2d57b3d9493f/5040b/cookie-callback-url.png 1468w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/fd364df417af607d3d5b2d57b3d9493f/fe486/cookie-callback-url.png"
            alt="encode → decode해보면, localhost:3000/posts가 저장되어 있음"
            title="encode → decode해보면, localhost:3000/posts가 저장되어 있음"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">encode → decode해보면, localhost:3000/posts가 저장되어 있음</figcaption>
  </figure></p>
<br/>
<p><strong>💬 그럼, <code class="language-text">next-auth.csrf-token</code>는 무엇일까?</strong><br>
이 부분은 설명이 너무 길어질 것 같아서, <a href="https://youtu.be/cUmIB2sjjdw?si=btICVO6EFSewEf5M" target="_blank" rel="nofollow">다른 영상</a>로 대체하려 한다.<br>
간략히, 보안을 강화하기 위해 하나의 검증수단으로 token을 더 두는 것이다.</p>
<p>참고로, 나는 따로 설정을 해주진 않았다.<br>
<code class="language-text">4-1. 주의할 점</code>에서도 설명하겠지만, 이 예시에선 서버와 클라이언트 도메인이 일치하기에 sameSite로 인해<br>
CSRF를 방지할 수 있다고 판단했다.</p>
<br/>
<p><strong>💬 그럼 마지막으로 <code class="language-text">next-auth.session-token</code>은 무엇일까?</strong><br>
next-auth로 로그인을 하면, JWT을 사용하여 세션을 만들 수 있다.<br>
즉, 사용자가 로그인하면 HttpOnly 쿠키에 JWT가 생성된다.</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6c3ea4f39507260110bfd71bc6a47007/4ab23/next-auth-session-tokne.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 59.895833333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABzklEQVQoz62RO3PaQBSF9f+r9OlTp0kKp3AA2wHzCMbYmKd4CmxA2l09VgJPvoxWEsZxm+Kbe+45Z3c1I6vTdxjNXSZLge0obMen1bWZbXwGM5fe5IUne0e9M6bRmTCcezyMNmam9Kc7xitluosXjbXYKDqPNr+7Y4bTZ57dmNb9iE5vynTlMVsLdvKVbn+Osw1wgz/M15L1XiMimDkCN8B4zjbE8oMQ1/NwXY8wjIjjA3vXwxMCqXzSPE4O7PcucZJwPL4ShhodJxwOR3w/JEmOBGFEpDWWOeSnBCjlI6QyOvXSTOae8gOkUkZLmXlG53k6lVJYWUGe8e8uKTpKZXm2q1zLk0475sKimL5QhOdanLzzwx85feH/vVBIZPoDckShZTpl7mVTyaInT9mblighsJRO8LVGRQUxvo5RoUaGEdLMTKt3+0fSu6xdq8623UQ83OF127j3bfZ3LaJBj3jcJxr20KOn9wwzouHbHo366E4T6/HiG7ValdurCrVKmZvST25Kl1QrZcOvconb6yvqN9dmL/Q51dIllWqNwedPWL0f32k1Gjy0mmzmM5ypzfNywWpqs7InZi7tiSHN13nHyXPj2WNWL1vcr1/4C5ZAfiWiURbFAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/6c3ea4f39507260110bfd71bc6a47007/a59e9/next-auth-session-tokne.webp 192w,
/static/6c3ea4f39507260110bfd71bc6a47007/0ca9f/next-auth-session-tokne.webp 384w,
/static/6c3ea4f39507260110bfd71bc6a47007/dc9b9/next-auth-session-tokne.webp 768w,
/static/6c3ea4f39507260110bfd71bc6a47007/e2c2f/next-auth-session-tokne.webp 1152w,
/static/6c3ea4f39507260110bfd71bc6a47007/13d4d/next-auth-session-tokne.webp 1462w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/6c3ea4f39507260110bfd71bc6a47007/3b721/next-auth-session-tokne.png 192w,
/static/6c3ea4f39507260110bfd71bc6a47007/66595/next-auth-session-tokne.png 384w,
/static/6c3ea4f39507260110bfd71bc6a47007/fe486/next-auth-session-tokne.png 768w,
/static/6c3ea4f39507260110bfd71bc6a47007/d2d74/next-auth-session-tokne.png 1152w,
/static/6c3ea4f39507260110bfd71bc6a47007/4ab23/next-auth-session-tokne.png 1462w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/6c3ea4f39507260110bfd71bc6a47007/fe486/next-auth-session-tokne.png"
            alt="생성된 JWT 토큰"
            title="생성된 JWT 토큰"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">생성된 JWT 토큰</figcaption>
  </figure></p>
<p>이 쿠키는 HttpOnly로 만들어져 클라이언트에서 JS로 접근할 수 없다.<br>
또한, 이 JWT는 Secret키로 암호화되어있다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// app/api/auth/[...nextauth].ts</span>
<span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">NextAuth</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  secret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXTAUTH_SECRET</span><span class="token punctuation">,</span> <span class="token comment">// 여기 Secret Key</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">GoogleProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GOOGLE_CLIENT_ID</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
      clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GOOGLE_CLIENT_SECRET</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  session<span class="token operator">:</span> <span class="token punctuation">{</span>
    strategy<span class="token operator">:</span> <span class="token string">'jwt'</span><span class="token punctuation">,</span>
    maxAge<span class="token operator">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token comment">// 30 days</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>사용자가 로그아웃하면 쿠키에서 JWT가 삭제되고, 세션을 없애준다.</p>
<br/>
<p><strong>💬 근데, 아까부터 나오던 session이란건 뭘까?</strong><br>
next-auth에서 제시하는 session이란 한 문장으로 다음과 같다.</p>
<blockquote>
<p>‘사용자가 애플리케이션에 로그인하면 일정시간동안 로그인할 필요가 없도록 사용자 정보 저장방법’<br>
next-auth에선 세션으로 크게 <a href="https://authjs.dev/concepts/session-strategies" target="_blank" rel="nofollow">두 가지 전략</a>을 제시하고 있다.<br>
(위에서 언급했던 JWT, Database)</p>
</blockquote>
<br/>
<h2 id="3-2-next-auth-인증을-유지하는-방법" style="position:relative;"><a href="#3-2-next-auth-%EC%9D%B8%EC%A6%9D%EC%9D%84-%EC%9C%A0%EC%A7%80%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95" aria-label="3 2 next auth 인증을 유지하는 방법 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3-2. next-auth 인증을 유지하는 방법</h2>
<p>정리해보면, next-auth에서 인증을 유지하는 방법은, 두 가지가 있다. (JWT, DB)<br>
이 중, JWT로 인증을 유지하는 방법은, cookie에 저장된 정보(=<code class="language-text">next-auth.session-token</code>)를 통해 유지한다.</p>
<p>그리고 secret key로 암호화되어있기 때문에, 클라이언트에서는 접근할 수 없다.<br>
만약 만료시간이 끝났을 경우, 다시 로그인을 해야한다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token function">NextAuth</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  secret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXTAUTH_SECRET</span><span class="token punctuation">,</span>
  providers<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">GoogleProvider</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      clientId<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GOOGLE_CLIENT_ID</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
      clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GOOGLE_CLIENT_SECRET</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  session<span class="token operator">:</span> <span class="token punctuation">{</span>
    strategy<span class="token operator">:</span> <span class="token string">'jwt'</span><span class="token punctuation">,</span>
    maxAge<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// default 30일 -> 10초로 변경</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>위와 같이, JWT maxAge를 10초로 변경했을 경우, 로그인 이후 10초 뒤 로그아웃되고,<br>
cookie에 <code class="language-text">next-auth.session-token</code>는 삭제된다.</p>
<br/>
<h1 id="4-next-auth의-인가는-어떻게-이루어질까" style="position:relative;"><a href="#4-next-auth%EC%9D%98-%EC%9D%B8%EA%B0%80%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9D%B4%EB%A3%A8%EC%96%B4%EC%A7%88%EA%B9%8C" aria-label="4 next auth의 인가는 어떻게 이루어질까 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. next-auth의 인가는 어떻게 이루어질까?</h1>
<p>이제 인가에 대해서 알아보자.
간단하게, api를 하나 만들어보자</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token comment">// app/api/posts.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> NextRequest<span class="token punctuation">,</span> NextResponse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next/server'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getToken <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next-auth/jwt'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">//mocking...</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span>request<span class="token operator">:</span> NextRequest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">{</span> req<span class="token operator">:</span> request<span class="token punctuation">,</span> secret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SECRET</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// log를 확인</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>posts<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> NextResponse<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span> message<span class="token operator">:</span> <span class="token string">'Token을 확인해주세요.'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">401</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>로그인을 해서 cookie에 정보가 잘 저장됐다면,<br>
next-auth에서 제공하는 <a href="https://next-auth.js.org/tutorials/securing-pages-and-api-routes#using-gettoken" target="_blank" rel="nofollow">getToken</a> API를 사용해, 암호화된 쿠키 내 유저정보를 복호화할 수 있다.</p>
<br/>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// app/pages.tsx</span>
<span class="token string">'use client'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> signIn<span class="token punctuation">,</span> signOut<span class="token punctuation">,</span> useSession <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'next-auth/react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Home</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> session <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>posts<span class="token punctuation">,</span> setPosts<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">fetchPosts</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/api/posts'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'posts를 불러오는데 실패했어요!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setPosts</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function-variable function">renderSessionInfo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>overflow-auto bg-gray-100 p-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">></span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>p-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span>session <span class="token operator">?</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">환영합니다, </span><span class="token punctuation">{</span>session<span class="token punctuation">.</span>user<span class="token operator">?.</span>name<span class="token punctuation">}</span><span class="token plain-text">!</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">signOut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">로그아웃</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mt-4 border border-black<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token function">renderSessionInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">

          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fetchPosts<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Fetch Posts</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"> // 로그인 했을 때, posts를 불러오면?
          </span><span class="token punctuation">{</span>posts <span class="token operator">&amp;&amp;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>posts<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">로그인을 해주세요.</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token function">signIn</span><span class="token punctuation">(</span><span class="token string">'google'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Google로 로그인하기</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">

          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>fetchPosts<span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">Fetch Posts</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text"> // 로그인 안했을 때, posts를 불러오면?
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">></span></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/d7cbc799938ea69de17c73a23883b4d7/34cf9/fail-fetch.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 9.895833333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAc0lEQVQI123GywrCMBQA0f7/bylmW2oQBBdNLZTaZpFHU7W5GUHFlYvDTLVXit1BUR/1f1pTNw3mdObWDbSXgbGfWeeJu7WID5Tg8ZPDjo6qNYbu2uNjJKZEXNKn31/SigsB7xzkje3xRHKGUt6KyI9k4QXxE5WHQhsl8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/d7cbc799938ea69de17c73a23883b4d7/a59e9/fail-fetch.webp 192w,
/static/d7cbc799938ea69de17c73a23883b4d7/0ca9f/fail-fetch.webp 384w,
/static/d7cbc799938ea69de17c73a23883b4d7/dc9b9/fail-fetch.webp 768w,
/static/d7cbc799938ea69de17c73a23883b4d7/e2c2f/fail-fetch.webp 1152w,
/static/d7cbc799938ea69de17c73a23883b4d7/f3efb/fail-fetch.webp 1536w,
/static/d7cbc799938ea69de17c73a23883b4d7/c8d93/fail-fetch.webp 2858w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/d7cbc799938ea69de17c73a23883b4d7/3b721/fail-fetch.png 192w,
/static/d7cbc799938ea69de17c73a23883b4d7/66595/fail-fetch.png 384w,
/static/d7cbc799938ea69de17c73a23883b4d7/fe486/fail-fetch.png 768w,
/static/d7cbc799938ea69de17c73a23883b4d7/d2d74/fail-fetch.png 1152w,
/static/d7cbc799938ea69de17c73a23883b4d7/e8464/fail-fetch.png 1536w,
/static/d7cbc799938ea69de17c73a23883b4d7/34cf9/fail-fetch.png 2858w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/d7cbc799938ea69de17c73a23883b4d7/fe486/fail-fetch.png"
            alt="당연하겠지만, 로그인 하지 않은 상태에선 요청이 실패한다."
            title="당연하겠지만, 로그인 하지 않은 상태에선 요청이 실패한다."
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">당연하겠지만, 로그인 하지 않은 상태에선 요청이 실패한다.</figcaption>
  </figure><br>
cookie에 저장된 token이 없으니, 요청을 보내도 데이터를 반환하지 않고 Error를 던진다.</p>
<br/>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/e27497a0d2523095cbb03f1e11f90288/31384/success-token.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 31.770833333333332%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABEUlEQVQY03WQ23KCMBRF+ZSOVHsDAbFAKORiAOWmTDu1jk7L9P8/YncSVNqHPqw5J5lk56wYJKvAyw5eyuELjrtFDNMOYc7Dsf7GDjE5Y9rjWtVbJ4Thvqyw+/gCyQrUnw3y9wqbQ418X4J3a5B1BiehGi+l8DnHcjU8vmAMPmd6T/UWSWAEUqI5vqI67lAcamy/t2j7FtWpAdlIeJTpw25Kda/CAimGUBUuRnTgnDDEskTRCOxPJWSbwzlP8hQmuHkMrlzUJtao+UdfKduR0H/YvWXo+wqilJgnVKuoqbQaZ3qCh+cYM4/8y9SLYERcwAoorDiFQxnsOB2COL9qqqq075cxpm40XHbHEMXMHQJ/AL95x+r+RhuMAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/e27497a0d2523095cbb03f1e11f90288/a59e9/success-token.webp 192w,
/static/e27497a0d2523095cbb03f1e11f90288/0ca9f/success-token.webp 384w,
/static/e27497a0d2523095cbb03f1e11f90288/dc9b9/success-token.webp 768w,
/static/e27497a0d2523095cbb03f1e11f90288/91b06/success-token.webp 976w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/e27497a0d2523095cbb03f1e11f90288/3b721/success-token.png 192w,
/static/e27497a0d2523095cbb03f1e11f90288/66595/success-token.png 384w,
/static/e27497a0d2523095cbb03f1e11f90288/fe486/success-token.png 768w,
/static/e27497a0d2523095cbb03f1e11f90288/31384/success-token.png 976w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/e27497a0d2523095cbb03f1e11f90288/fe486/success-token.png"
            alt="쿠키를 복호화해 유저의 정보를 얻을 수 있다."
            title="쿠키를 복호화해 유저의 정보를 얻을 수 있다."
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">쿠키를 복호화해 유저의 정보를 얻을 수 있다.</figcaption>
  </figure></p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">{</span> req<span class="token operator">:</span> request<span class="token punctuation">,</span> secret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SECRET</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'token'</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// log를 확인</span></code></pre></div>
<p>getToken에 인자로 포함된 secret와 cookie를 통해 유저 정보를 복호화할 수 있다.</p>
<br/>
<h3 id="4-1-주의할-점" style="position:relative;"><a href="#4-1-%EC%A3%BC%EC%9D%98%ED%95%A0-%EC%A0%90" aria-label="4 1 주의할 점 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4-1. 주의할 점</h3>
<blockquote>
<p>몇 달전, 위와 같이 잘 되는걸 확인하고 즐거운 마음으로 퇴근했었다.<br>
하지만, 다음 날 절망했다.. 😩</p>
</blockquote>
<p>만약 클라이언트와 서버가 도메인이 각각 다르다면 추가적인 설정이 필요하다.<br>
관련 내용은 <a href="https://seob.dev/posts/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%BF%A0%ED%82%A4%EC%99%80-SameSite-%EC%86%8D%EC%84%B1/" target="_blank" rel="nofollow">이 글</a>에서 잘 설명해주신다.</p>
<p>간략히 정리해보자면,</p>
<blockquote>
<p>쿠키로 인증을 하는 경우, csrf 공격에 취약하다.<br>
그래서 이를 방지하기 위해 <a href="https://seob.dev/posts/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%BF%A0%ED%82%A4%EC%99%80-SameSite-%EC%86%8D%EC%84%B1/#samesite-%EC%BF%A0%ED%82%A4" target="_blank" rel="nofollow">SameSite</a>가 만들어졌다.</p>
<p>next-auth를 사용하는데, 클라이언트와 서버의 도메인이 각각 다르다면,<br>
<a href="https://next-auth.js.org/configuration/options#cookies" target="_blank" rel="nofollow">추가적인 설정</a>이 필요하다.</p>
</blockquote>
<p>이번의 예시에선, next-auth를 next.js에서만 사용했고,<br>
배포를 해도 동일한 도메인이기에 문제없이 잘 동작했다. 🍀</p>
<br/>
<h3 id="참고자료" style="position:relative;"><a href="#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C" aria-label="참고자료 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>참고자료</h3>
<ul>
<li>
<p>next-auth<br>
<a href="https://developer.mozilla.org/en-US/docs/Web/API/Broadcast_Channel_API" target="_blank" rel="nofollow">Broadcast Channel API</a><br>
<a href="https://authjs.dev/concepts/session-strategies" target="_blank" rel="nofollow">next-auth Session strategies</a></p>
</li>
<li>
<p>cookie<br>
<a href="https://seob.dev/posts/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%BF%A0%ED%82%A4%EC%99%80-SameSite-%EC%86%8D%EC%84%B1/" target="_blank" rel="nofollow">브라우저 쿠키와 SameSite 속성</a></p>
</li>
<li>
<p>csrf<br>
<a href="https://blog.logrocket.com/protecting-next-js-apps-csrf-attacks/" target="_blank" rel="nofollow">Protecting Next.js apps from CSRF attacks</a><br>
<a href="https://www.youtube.com/watch?v=cUmIB2sjjdw" target="_blank" rel="nofollow">링크만 클릭했는데 이게 된다고? | 웹 해킹 CSRF 공격 | CSRF 공격 이렇게 한다!</a></p>
</li>
</ul></div></div><style data-emotion="css ts6ysa">.css-ts6ysa{width:300px;position:-webkit-sticky;position:sticky;top:0;right:0;padding-top:130px;margin-left:5rem;overflow:auto;}@media (max-width: 1300px){.css-ts6ysa{display:none;}}</style><aside class="css-ts6ysa etse75s1"><style data-emotion="css 1fg89mx">.css-1fg89mx{position:-webkit-sticky;position:sticky;border-left:2px solid #ddd8d8;background-color:white;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}.css-1fg89mx ul{color:gray;padding-left:1rem;list-style:none;line-height:24px;scale:1;}.css-1fg89mx ul .active{color:black;font-weight:700;}</style><div id="post-toc" class="css-1fg89mx etse75s0"><ul>
<li>
<p><a href="#1-token%EC%9D%98-%ED%95%84%EC%9A%94%EC%84%B1">1. Token의 필요성</a></p>
</li>
<li>
<p><a href="#2-next-auth-token-%EA%B4%80%EB%A6%AC-%EB%B0%A9%EB%B2%95">2. next-auth Token 관리 방법</a></p>
<ul>
<li><a href="#2-1-%EC%9D%B8%EC%A6%9Dauthentication%EA%B3%BC-%EC%9D%B8%EA%B0%80authorization%EA%B0%80-%EB%AD%98%EA%B9%8C">2-1. 인증(Authentication)과 인가(Authorization)가 뭘까?</a></li>
</ul>
</li>
<li>
<p><a href="#3-next-auth%EB%8A%94-%EC%9D%B8%EC%A6%9D%EC%9D%84-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9C%A0%EC%A7%80%ED%95%A0%EA%B9%8C">3. next-auth는 인증을 어떻게 유지할까?</a></p>
<ul>
<li>
<p><a href="#3-1-%EB%A1%9C%EA%B7%B8%EC%9D%B8-%ED%96%88%EC%9D%84-%EB%95%8C-%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%EC%97%90-%EC%A0%80%EC%9E%A5%EB%90%98%EB%8A%94-%EC%A0%95%EB%B3%B4">3-1. 로그인 했을 때 브라우저에 저장되는 정보</a></p>
<ul>
<li><a href="#local-storage%EC%97%90-%EC%A0%80%EC%9E%A5%EB%90%98%EB%8A%94-%EC%A0%95%EB%B3%B4">Local Storage에 저장되는 정보</a></li>
<li><a href="#cookie%EC%97%90-%EC%A0%80%EC%9E%A5%EB%90%98%EB%8A%94-%EC%A0%95%EB%B3%B4">Cookie에 저장되는 정보</a></li>
</ul>
</li>
<li>
<p><a href="#3-2-next-auth-%EC%9D%B8%EC%A6%9D%EC%9D%84-%EC%9C%A0%EC%A7%80%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95">3-2. next-auth 인증을 유지하는 방법</a></p>
</li>
</ul>
</li>
<li>
<p><a href="#4-next-auth%EC%9D%98-%EC%9D%B8%EA%B0%80%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9D%B4%EB%A3%A8%EC%96%B4%EC%A7%88%EA%B9%8C">4. next-auth의 인가는 어떻게 이루어질까?</a></p>
<ul>
<li>
<ul>
<li><a href="#4-1-%EC%A3%BC%EC%9D%98%ED%95%A0-%EC%A0%90">4-1. 주의할 점</a></li>
<li><a href="#%EC%B0%B8%EA%B3%A0%EC%9E%90%EB%A3%8C">참고자료</a></li>
</ul>
</li>
</ul>
</li>
</ul></div></aside></div><div></div><style data-emotion="css 11u7q11">.css-11u7q11{display:grid;place-items:center;margin-top:auto;padding:70px 0;color:gray;font-size:15px;text-align:center;line-height:1.5;}@media (max-width: 768px){.css-11u7q11{font-size:12px;padding:50px 0;}}</style><footer class="css-11u7q11 e1oae0v80">© <!-- -->2025<!-- --> Geuni, Powered By Gatsby.</footer></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2024/1/17/authorization/";window.___webpackCompilationHash="f732bc29a34b2fd1854d";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c9fa82aa5b1f9c65f078.js"],"app":["/app-5f4028ff9c0e41abf41e.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-3d063b1ad72c7288ab1c.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-06fbe9ebade3fa4896dc.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-3f6da52bad5615a8b621.js"]};/*]]>*/</script><script src="/polyfill-c9fa82aa5b1f9c65f078.js" nomodule=""></script><script src="/app-5f4028ff9c0e41abf41e.js" async=""></script><script src="/framework-e3dc0f184baa7501f320.js" async=""></script><script src="/webpack-runtime-f3d05db4a414f4d46b70.js" async=""></script></body></html>