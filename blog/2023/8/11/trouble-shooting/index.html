<!DOCTYPE html><html lang="ko"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 4.25.3"/><meta data-react-helmet="true" name="description" content="대체 왜 google analytics의 views(조회수)는 revalidate time이 적용되지 않는걸까?"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" http-equiv="Content-Type" content="text/html;charset=UTF-8"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:title" content="작은 기능 중, 작은 이슈를 해결하기 위해 달렸던 3개월"/><meta data-react-helmet="true" property="og:description" content="대체 왜 google analytics의 views(조회수)는 revalidate time이 적용되지 않는걸까?"/><meta data-react-helmet="true" property="og:image"/><meta data-react-helmet="true" property="og:url"/><meta data-react-helmet="true" property="og:site_name" content="작은 기능 중, 작은 이슈를 해결하기 위해 달렸던 3개월"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="작은 기능 중, 작은 이슈를 해결하기 위해 달렸던 3개월"/><meta data-react-helmet="true" name="twitter:description" content="대체 왜 google analytics의 views(조회수)는 revalidate time이 적용되지 않는걸까?"/><meta data-react-helmet="true" name="twitter:image"/><meta data-react-helmet="true" name="twitter:site" content="@Geuni620"/><meta data-react-helmet="true" name="twitter:creator" content="@Geuni620"/><meta data-react-helmet="true" name="google-site-verification" content="bHJqVdOg6rrFDK-dWGOElA4Egv3IPQlc-COuY76j678"/><meta data-react-helmet="true" name="naver-site-verification" content="1c3c437586a7b1a24609a56a8bf7adbb6ba019c2"/><meta data-react-helmet="true" name="msapplication-TileColor" content="#da532c"/><meta data-react-helmet="true" name="theme-color" content="#ffffff"/><meta data-react-helmet="true" name="google-adsense-account" content="ca-pub-9901489090188954"/><style data-href="/styles.710ba525502dd431a17c.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XWJMDQNM9B"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-XWJMDQNM9B', {"send_page_view":false});
      }
      </script><link rel="canonical" href="https://geuni620.github.io/blog/2023/8/11/trouble-shooting/" data-baseprotocol="https:" data-basehost="geuni620.github.io"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><title data-react-helmet="true">작은 기능 중, 작은 이슈를 해결하기 위해 달렸던 3개월</title><link data-react-helmet="true" rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png"/><link data-react-helmet="true" rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png"/><link data-react-helmet="true" rel="manifest" href="assets/favicon/site.webmanifest"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){const t=e.target;if(void 0===t.dataset.mainImage)return;if(void 0===t.dataset.gatsbyImageSsr)return;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><style type="text/css">
    .headerElement.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .headerElement.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .headerElement svg,
    h2 .headerElement svg,
    h3 .headerElement svg,
    h4 .headerElement svg,
    h5 .headerElement svg,
    h6 .headerElement svg {
      visibility: hidden;
    }
    h1:hover .headerElement svg,
    h2:hover .headerElement svg,
    h3:hover .headerElement svg,
    h4:hover .headerElement svg,
    h5:hover .headerElement svg,
    h6:hover .headerElement svg,
    h1 .headerElement:focus svg,
    h2 .headerElement:focus svg,
    h3 .headerElement:focus svg,
    h4 .headerElement:focus svg,
    h5 .headerElement:focus svg,
    h6 .headerElement:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css 17q84ie">.css-17q84ie{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}@media (max-width: 768px){.css-17q84ie{width:90%;margin:0 auto;}}</style><main class="css-17q84ie e1strnqo0"><style data-emotion="css-global 16rkkz4">@import url('<https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&display=swap>');*{padding:0;margin:0;box-sizing:border-box;font-family:'Jua',sans-serif;}html,body,#___gatsby{height:100%;}a,a:hover{color:inherit;-webkit-text-decoration:none;text-decoration:none;cursor:pointer;}</style><style data-emotion="css kxznun">.css-kxznun{position:fixed;width:100%;top:0px;left:0;color:#ffffff;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);box-shadow:rgb(0 0 0 / 8%) 0px 0px 8px;opacity:1;-webkit-transition:top 0.5s ease 0s,opacity 0.5s ease 0s;transition:top 0.5s ease 0s,opacity 0.5s ease 0s;z-index:999;}</style><header class="css-kxznun e7v9byn3"><style data-emotion="css rwmuo">.css-rwmuo{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0 auto;padding:10px 60px;}@media (max-width: 768px){.css-rwmuo{padding:10px 20px;}}</style><div class="css-rwmuo e7v9byn2"><a href="/"><style data-emotion="css chhkyo">.css-chhkyo{width:50px;height:50px;padding:5px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;border-radius:50%;isolation:isolate;}</style><div data-gatsby-image-wrapper="" class="gatsby-image-wrapper gatsby-image-wrapper-constrained css-chhkyo e1n1u3tj0"><div style="max-width:120px;display:block"><img alt="" role="presentation" aria-hidden="true" src="data:image/svg+xml;charset=utf-8,%3Csvg height=&#x27;120&#x27; width=&#x27;120&#x27; xmlns=&#x27;http://www.w3.org/2000/svg&#x27; version=&#x27;1.1&#x27;%3E%3C/svg%3E" style="max-width:100%;display:block;position:static"/></div><img aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear" decoding="async" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC0ElEQVQ4y3XQOY/bRhTA8fk6qVO5TJkyadzGhQFXMYwcRQpL5urelcjhfYjHkOI15PCU5F0du/loxsxItmDAwMN088P/PTDV86mOJ1ox0fBYLcZqMVLykZLfyZkAMwHm/P0EkyGMB1I0lOKhGA/E+KMYgrlZzIxyZhQznTAlZ5OOVTojJb2TEzaZAFMBbgSYDqVsKKVDKQULu5ibZG4Wc6uYmXhm4JmRT/V8ouGJlo01TiQjhb6CEt/JMWvJPsEUPKzLB6e8d4qFgxc2nlt4ZuK5eSX0bKJlPIcqHJITQU4FJQMrr1q6ZLmm/++d4mFd3DvlwsYLO2cb4amRc2jK/l/WUZORlgDo1SuvktYE+o0S9QPRHyzdpUtoi40XFp4zhUPU0vlRsomWAtlvNNSPYfj67T/LdfnnYPXu34mdH1hFyUIKBhUUsvCtAtSg1VH/YOG/BfnN+8FPr379+Zff/puZS4/Qddgwpbwq304DjKhXUWdEvRb2fw2k3/94/+Gj+GEoLV0i+rXoVyuvutzlRuEEMDc7I9wa0Ra6BK6Jkz4a8U5P9hC1UtBIfgP9WvJq0a+/EhfFKYGd7K14Z8ZbK97ZyV4POz3s1KBVUaeiDqJWCVrFb2SfQqJXi+zAoktWLgFO+tlO9pxgys7cbI2oN6Jej3o17OigjhIBawloC6RKBdbZ4zp7dNLPfKhyhawrpIedFnZK2MqogaiRGSEFDfDwwc2f+NxCtznGZmtutjo9Kg2RUQtRKwcNCMqjX1zmR5CV7M2vITcKQOQYlMegPAXl6aocPPzk5ofviMtSLIRfBITVOaxOITmF5BgQSgQ/CLn9zwkQ189xdY6r86Y6RZQ4IXJGNyEe5iHfE3ayB2nzkjYvSf28aZ7jmitnqpQnREOOQXkIigPbhS/yjQBZ+5K2/2eMiJlC/9fnqDpvCG1B5BiWR1Qe/JITTx7mt9h/AXx87LWuwqpGAAAAAElFTkSuQmCC" alt=""/><picture><source type="image/webp" data-srcset="/static/da11a08871bbdad7fcdece0ebc7459ce/2b147/profile-image.webp 30w,/static/da11a08871bbdad7fcdece0ebc7459ce/caa3b/profile-image.webp 60w,/static/da11a08871bbdad7fcdece0ebc7459ce/b15f9/profile-image.webp 120w,/static/da11a08871bbdad7fcdece0ebc7459ce/b5014/profile-image.webp 240w" sizes="(min-width: 120px) 120px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 120px) 120px, 100vw" decoding="async" loading="lazy" data-src="/static/da11a08871bbdad7fcdece0ebc7459ce/bbf83/profile-image.jpg" data-srcset="/static/da11a08871bbdad7fcdece0ebc7459ce/a8e5a/profile-image.jpg 30w,/static/da11a08871bbdad7fcdece0ebc7459ce/bea51/profile-image.jpg 60w,/static/da11a08871bbdad7fcdece0ebc7459ce/bbf83/profile-image.jpg 120w,/static/da11a08871bbdad7fcdece0ebc7459ce/7793c/profile-image.jpg 240w" alt="Profile Image"/></picture><noscript><picture><source type="image/webp" srcSet="/static/da11a08871bbdad7fcdece0ebc7459ce/2b147/profile-image.webp 30w,/static/da11a08871bbdad7fcdece0ebc7459ce/caa3b/profile-image.webp 60w,/static/da11a08871bbdad7fcdece0ebc7459ce/b15f9/profile-image.webp 120w,/static/da11a08871bbdad7fcdece0ebc7459ce/b5014/profile-image.webp 240w" sizes="(min-width: 120px) 120px, 100vw"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="(min-width: 120px) 120px, 100vw" decoding="async" loading="lazy" src="/static/da11a08871bbdad7fcdece0ebc7459ce/bbf83/profile-image.jpg" srcSet="/static/da11a08871bbdad7fcdece0ebc7459ce/a8e5a/profile-image.jpg 30w,/static/da11a08871bbdad7fcdece0ebc7459ce/bea51/profile-image.jpg 60w,/static/da11a08871bbdad7fcdece0ebc7459ce/bbf83/profile-image.jpg 120w,/static/da11a08871bbdad7fcdece0ebc7459ce/7793c/profile-image.jpg 240w" alt="Profile Image"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1,e.parentNode.parentNode.querySelector("[data-placeholder-image]").style.opacity=0)}}</script></div></a><style data-emotion="css 129macj">.css-129macj{position:absolute;top:2rem;left:7rem;padding:0.5rem 1rem;background-color:white;border-radius:0.5rem;box-shadow:0 8px 16px rgba(0, 0, 0, 0.1);-webkit-animation:float 2s ease-in-out infinite;animation:float 2s ease-in-out infinite;}.css-129macj::before{content:'';position:absolute;left:-8px;top:20%;-webkit-transform:translateY(-50%);-moz-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);border:4px solid transparent;border-right-color:white;rotate:10deg;}@-webkit-keyframes float{0%,100%{-webkit-transform:translateY(0);-moz-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}50%{-webkit-transform:translateY(-4px);-moz-transform:translateY(-4px);-ms-transform:translateY(-4px);transform:translateY(-4px);}}@keyframes float{0%,100%{-webkit-transform:translateY(0);-moz-transform:translateY(0);-ms-transform:translateY(0);transform:translateY(0);}50%{-webkit-transform:translateY(-4px);-moz-transform:translateY(-4px);-ms-transform:translateY(-4px);transform:translateY(-4px);}}@media (max-width: 768px){.css-129macj{left:4.5rem;}}</style><div class="css-129macj e7v9byn1"><style data-emotion="css 11cmwhy">.css-11cmwhy{display:block;margin-top:0.25rem;font-size:0.75rem;color:#3182ce;-webkit-text-decoration:none;text-decoration:none;-webkit-transition:color 0.2s;transition:color 0.2s;}.css-11cmwhy:hover{color:#2c5282;}</style><a href="https://www.geuni.me/" target="_blank" class="css-11cmwhy e7v9byn0">블로그를 옮겼어요.</a></div></div></header><style data-emotion="css 1xpwfc9">.css-1xpwfc9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;-webkit-align-items:flex-start;-webkit-box-align:flex-start;-ms-flex-align:flex-start;align-items:flex-start;}</style><div class="css-1xpwfc9 e6b6ljm1"><style data-emotion="css 1vsj6bx">@media (max-width: 768px){.css-1vsj6bx{width:100%;}}</style><div class="css-1vsj6bx e6b6ljm0"><style data-emotion="css pw7jst">.css-pw7jst{position:relative;width:100%;}</style><div class="css-pw7jst e1opi4mu0"><style data-emotion="css 16n2vrb">.css-16n2vrb{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding:100px 0px 60px 0px;color:#ffffff;}@media (max-width: 768px){.css-16n2vrb{width:100%;}}</style><div class="css-16n2vrb e1st1jau2"><style data-emotion="css 1qqkx4z">.css-1qqkx4z{margin-top:20px;color:black;font-size:45px;font-weight:800;}@media (max-width: 768px){.css-1qqkx4z{font-size:28px;}}</style><div class="css-1qqkx4z e1st1jau1">작은 기능 중, 작은 이슈를 해결하기 위해 달렸던 3개월</div><style data-emotion="css vpbqf9">.css-vpbqf9{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:black;margin-top:10px;font-size:18px;font-weight:700;}</style><div class="css-vpbqf9 e1st1jau0"><div>개발</div><div>2023.08.11.</div></div></div></div><style data-emotion="css u9yaza">.css-u9yaza{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:768px;margin:0 auto;padding-bottom:50px;word-break:break-all;font-size:18px;font-weight:400;}.css-u9yaza p{padding:3px 0;margin-bottom:1.5rem;line-height:1.6em;}.css-u9yaza h1,.css-u9yaza h2,.css-u9yaza h3{font-weight:800;margin-bottom:1.5rem;}.css-u9yaza *+h1,.css-u9yaza *+h2,.css-u9yaza *+h3{margin-top:0.5rem;}.css-u9yaza hr+h1,.css-u9yaza hr+h2,.css-u9yaza hr+h3{margin-top:0;}.css-u9yaza h1{font-size:50px;}.css-u9yaza h2{font-size:40px;}.css-u9yaza h3{font-size:30px;}.css-u9yaza blockquote{padding:20px;border-left:5px solid #a3aaae;font-weight:400;font-style:normal;line-height:28px;font-size:18px;color:#000;background-color:#f7f7f7;margin-bottom:1.5rem;}.css-u9yaza blockquote p{margin:10px 0;}.css-u9yaza ol,.css-u9yaza ul{margin-bottom:1.5rem;margin-left:20px;}.css-u9yaza ul>li:has(input[type='checkbox']){list-style:none;}.css-u9yaza .contains-task-list{margin-left:0;}.css-u9yaza li{margin-bottom:0.5em;}.css-u9yaza hr{border:1px solid rgb(233, 236, 239);margin-bottom:48px;}.css-u9yaza a{color:#0687f0;font-weight:500;-webkit-transition:all 0.3s ease-in-out;transition:all 0.3s ease-in-out;}.css-u9yaza a:hover{-webkit-text-decoration:underline;text-decoration:underline;}.css-u9yaza pre[class*='language-']{margin:0 0 30px 0;padding:15px;font-size:15px;}.css-u9yaza code[class*='language-'],.css-u9yaza pre[class*='language-']{tab-size:2;font-size:14px;}.css-u9yaza li code,.css-u9yaza p code{color:#eb5757;background-color:hsla(44, 6%, 50%, 0.15);}.css-u9yaza figcaption{font-size:14px;margin-top:5px;text-align:center;color:#888;}.css-u9yaza p strong{font-weight:700;}.css-u9yaza input[type='checkbox']{width:18px;height:18px;vertical-align:middle;margin-right:5px;}@media (max-width: 768px){.css-u9yaza{width:100%;line-height:1.6;font-size:14px;}.css-u9yaza h1{font-size:23px;}.css-u9yaza h2{font-size:20px;}.css-u9yaza h3{font-size:17px;}.css-u9yaza img{width:100%;}.css-u9yaza hr{margin:50px 0;}}</style><div class="css-u9yaza e1ijh0y10"><blockquote>
<p>요번 주에 <a href="https://deep.jejodo.life/" target="_blank" rel="nofollow">제조도 블로그</a>를 만들면서 오랫동안 해결하지 못했던 문제를 해결했다.<br>
제조도 블로그의 사용자 데이터는 google analytics로 쌓고 있는데, 시리님께서 조회수기능이 필요하다고 말씀해주셨고, 기록을 보니 5월 4일이었다.<br>
제조도 블로그는 5월 1일부터 시작했는데, 4일 회의 때 조회수기능이 필요하다는 말씀을 하셨고, PR을 확인해보니 16일에 기능을 merge 했다.<br>
그리고 현재 8월 11일, 그 동안 여러 이슈들이 존재했는데, 조회수 기능이 revalidate time을 적용시켜놓아도 적용되지 않는 이슈가 있었다.<br>
Notion / Youtube / Insta까지 revalidate Time이 모두 잘 적용되는데도 불구하고, google analytics의 조회수 기능만 적용되지 않았다.
그래서 매번 re-deploy를 해주어야했다. 오늘 명확히 이 문제를 해결할 수 있었다.</p>
</blockquote>
<br>
<p>사실 다른 크리티컬한 이슈들이 많이 존재하기도 했고 version.2를 준비하고 있어서 신경쓰지 못했던 것도 있다. 당시엔 어드민 페이지도 작업하고 있었기데, 더 늦어지게 됐다. 그래도 기다려준 시리님께 정-말 감사하다.</p>
<p>어떻게 접근했는지 하나하나 기록으로 남겨보려 한다.</p>
<h3 id="revalidate-time이-적용되지-않는다" style="position:relative;"><a href="#revalidate-time%EC%9D%B4-%EC%A0%81%EC%9A%A9%EB%90%98%EC%A7%80-%EC%95%8A%EB%8A%94%EB%8B%A4" aria-label="revalidate time이 적용되지 않는다 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>revalidate time이 적용되지 않는다.</h3>
<p>현재 제조도 블로그는 app 디렉토리를 사용했다. app 디렉토리에선 fetch함수 내 revalidate 타입을 지정해 줄 수 있는데, 이 revalidate time을 지정해주면 일정 시간 후 re-generate 하게 된다. 근데, re-generate 하게 되면, 당연히 데이터로 refresh 되어야하는데, 이게 적용되지 않았다.<br>
그래서 조회수를 업데이트하기 위해선 re-deploy 해주어야했다.</p>
<br>
<h3 id="nextjs의-자체-오류인걸까" style="position:relative;"><a href="#nextjs%EC%9D%98-%EC%9E%90%EC%B2%B4-%EC%98%A4%EB%A5%98%EC%9D%B8%EA%B1%B8%EA%B9%8C" aria-label="nextjs의 자체 오류인걸까 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>next.js의 자체 오류인걸까?</h3>
<p>이 생각을 했던 이유가, app 디렉토리를 사용해서 개발할 당시엔 stable 단계가 아니었다. 그래서 사실 stable 단계가 되었을 때도 무슨 이슈가 발생하면 next.js github issue 탭부터 확인했다. 우연히 유튜브 알고리즘을 통해 <a href="https://youtu.be/25yjSzl6PsQ" target="_blank" rel="nofollow">이 영상</a>을 확인하게 되었는데, 더욱 의심을 가지게 되었다.</p>
<p>또한 Delete route handler가 적용되지 않는 <a href="https://github.com/vercel/next.js/issues/48096" target="_blank" rel="nofollow">이슈</a>도 확인했던 터라 의심의 의심을 불러일으켰다.
잘못 선택한 걸까… 그냥 page 디렉토리로 갔어야했나, 하는 생각도 들었다.</p>
<br>
<h3 id="그래도-해결해야한다" style="position:relative;"><a href="#%EA%B7%B8%EB%9E%98%EB%8F%84-%ED%95%B4%EA%B2%B0%ED%95%B4%EC%95%BC%ED%95%9C%EB%8B%A4" aria-label="그래도 해결해야한다 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>그래도 해결해야한다.</h3>
<p>손놓고 있을 순 없지않나, 해결방법을 고민했다. revalidate-time이 적용되지 않는다면, 그냥 client로 넘겨버리면 되지 않을까? 하는 생각이 들었다.
그래서 구글 애널리틱스 코드를 서버컴포넌트에서 클라이언트 컴포넌트로 변경했다. <code class="language-text">react-query</code>까지 설정하고, 보일러플레이트 작성하기 보단, <code class="language-text">useEffect</code>를 통해서 구현했다.(후엔 변경하게 되었지만.)
<a href="https://github.com/dohyeon2" target="_blank" rel="nofollow">주도님</a>께서 리뷰를 남겨주셨는데, useEffect로 fetch하는 코드를 보시곤, useQuery쓰는게 더 낫지 않냐는 말씀을 하셨는데, 당시엔 version.2를 만들생각을 하고 있었고, ‘그 정도 품을 들일 필요 있나 다시 만들게 될텐데..’ 하는 <strong>안일한 생각을 했다.</strong></p>
<ul>
<li>이때 하나 크게 배우게 되었는데, 프로덕트 중 특히, 내가 맡고 있는 주인의식을 가지고 있는 프로덕트에 품이 든다는 생각으로 안일하게 대처하면 <strong>오히려 더 큰 문제가 생기거나 시간이 걸린다는 사실을 알게되었다.</strong></li>
<li>그래도 당시엔, react-query의 보일러플레이트 작성하는 것보다, useEffect로 빠르게 조회수기능만 정상화 시킨 상태에서 version.2에 더 시간을 쓰려고 했던 마음도 있었다.</li>
<li>이러나 저라나 나에겐 모두 깨달음을 얻게 해주었다. <strong>결국 상황을 읽고 옳은 판단을 해야 리소스도 줄일 수 있고, 줄인 리소스를 더 나은 곳에 쓸 수 있다는 것이다.</strong> 왜냐하면 시간은 항상 한정되어 있으니.</li>
</ul>
<br>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx">  <span class="token keyword">const</span> <span class="token punctuation">[</span>isClient<span class="token punctuation">,</span> setIsClient<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>filteredView<span class="token punctuation">,</span> setFilteredView<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token generic-function"><span class="token function">useState</span><span class="token generic class-name"><span class="token operator">&lt;</span>ViewProps<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token function">setIsClient</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span>
          <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_ORIGIN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/api/google/views</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> postView <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>view<span class="token operator">:</span> ViewProps<span class="token punctuation">)</span> <span class="token operator">=></span> view<span class="token punctuation">.</span>title <span class="token operator">===</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">setFilteredView</span><span class="token punctuation">(</span>postView<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
          <span class="token string">'포스트의 조회수를 가져오는 과정에서 에러가 발생했어요.'</span><span class="token punctuation">,</span>
          error<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<br>
<p>역시 위 코드는 적용되지 않았다. 그래서 이상하다는 생각을 했는데, refresh 자체가 되지 않는 것 같았다.<br>
당시엔 ISG / SSR / SSG / CSR의 개념에 대해 명확히 이해하고 있지 못했다. 특히 데이터 fetch 해오는 과정을 말이다.
그래서 테스트를 해봐야겠다는 생각이 들어 4개의 보일러플레이트를 각각 만들고, build를 각각 해보았다. 서버는 간단히 express로 구현했다.
해당 내용은 <a href="https://geuni620.github.io/blog/2023/8/3/next-build-type/" target="_blank" rel="nofollow">여기</a>서 확인할 수 있다.</p>
<br>
<p>테스트를 통해 명확히 알게 되었다. 데이터를 가져올 때 SSG는 refresh 되지 않는다는 사실을. 하지만, 이때까지만 해도 근본적인 원인은 모르고 있었다.
그러다가, 잘 돌아가던 댓글기능이 한번 오류가 발생한 적이 있었는데, 이 과정에서 npm run build로 로컬에서 build후 dev로 띄워보았다.
이때 이걸 보게 되었다.</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/6e2618c8756cfff8a0b88c003c9f26ff/6648e/static-img.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 67.70833333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACLklEQVQ4y22U6VLicBDEeRZlFby4E0JCDkLuEwICIquWte//CL3VoxGz7oepyT816cz8epKWFeXQ3AjDuYvL3gS/BiquhtOvzGj3FdyqBqy4wK1iYGL7mLoh7DSH5oWN+pbuJ7DjAooTyI3uePZDlIJ3UxN+sYFfbnE90nCj6oj2CbwqwPXom6Di+PCKDZLNAV5eYZlX6HwT/RJU59C9GKyvX6bZBuzQbgrqXoJ8/4xFupIx2PHDzGqMT8F7zYSTrNAd63LujDVo4QLO+p8ODT8FOTLMMEOwepTrgbFAd6KLMONuamAehxg51leH3YmGgWU2GWrLCFG1R7TeIa72yHdHpNsnrI8vgoGG3SjGhylJhkVWCEMKMC57SoN5i1xWT7+R754lU2xzekP1/IrHl3dkj0cYQSoYwtUOnKgWqxk3OryfmlBsX4DPvFg4zpYx1EUgZ+aebktXw/lC4myWinZPxdXgLNpys7W4S37tgYqLhzEuPrkxaAAzR2YtuY4tT168LEuYSdzscB6ksoeqE2BkulLI1RiZS1kVFnVGGm5VHW6ZQfXOHfZN86cphp+g3J9Q7E8oDyfhd3j7I1EdX8X1emy/rGDGnwyH6ufISoNli8Xc/nC9kwXnWHQ33R6QbA9iEpn2dUd2lV9Ubcr/osXCeZiBoztJKZlnGmJFhSz62PoYnyjYQHcyk6+JQaZ1lg4pyF2k2+TGaz7I+zVPOkshmsEfQ33NqOuZ+R/4C9FT3ZmQEt86AAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/6e2618c8756cfff8a0b88c003c9f26ff/a59e9/static-img.webp 192w,
/static/6e2618c8756cfff8a0b88c003c9f26ff/0ca9f/static-img.webp 384w,
/static/6e2618c8756cfff8a0b88c003c9f26ff/dc9b9/static-img.webp 768w,
/static/6e2618c8756cfff8a0b88c003c9f26ff/1dd27/static-img.webp 948w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/6e2618c8756cfff8a0b88c003c9f26ff/3b721/static-img.png 192w,
/static/6e2618c8756cfff8a0b88c003c9f26ff/66595/static-img.png 384w,
/static/6e2618c8756cfff8a0b88c003c9f26ff/fe486/static-img.png 768w,
/static/6e2618c8756cfff8a0b88c003c9f26ff/6648e/static-img.png 948w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/6e2618c8756cfff8a0b88c003c9f26ff/fe486/static-img.png"
            alt="Static"
            title="Static"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">Static</figcaption>
  </figure></p>
<blockquote>
<p>○ (Static) automatically rendered as static HTML (uses no initial props)</p>
</blockquote>
<p>○ 이 표시는 Static하게 build 되었다는 의미인데, api 폴더 내에 google/views까지 static하게 build 되어있었다.<br>
그래서, 이것만 동적으로 풀어주면 되지 않을까? 하는 생각이 들어, 다음과 같이 수정해주었다.</p>
<p><figure class="gatsby-resp-image-figure" style="">
    <span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/5a3ca8550d46e4c4861ad17c3181b593/0c7a1/server-img.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 63.541666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACNklEQVQ4y22T61LbMBCF8yhtHAgpwbJjx/ebfJcdx7mQQICmQ2dop+//AKezgsC05MfOrqSdz3uO5IFbNDCTEmPTg6LZuJg5uJydsoORZsHiJZifQPM5rKSEXzVyTWeXb32nGMS5AC8bMMvHdGbjavYBPQHdTKDe7PHNCqB6Iep9A6fgGKpngC+Bgz9Vjt9pjOckxK85g66ZUGbuO9BOK/hliwvdwdiwwRuaNMSQnQEe4xBPKcdDHOIhiXFwLVwzE0PtY0KveJWosDnGpotgkcPgMZRzE0ZNj7y/Rdpt0O0fUWzuEFQdzCjHhW5DYRasNEO8ELgyXYw0G5O5K2s6/wRMRI/N4w/0908yrw9HHJ5fsPv+E3m3AfMS+EUrPRwbr5BTEOB/6GCeFMi6DcrVDulijXy5RbXeoVrv5f6NE8GIcgRl+w4YMUtOehYYiyWiusONG+PL1MBQNfH1LYbqXK7dXEgPaVq6IN51MGIu7fgkmaaiIOMJHNadBBhRhqkTyaagFuB9I58SydajCFPXf5/yHyA9h2Z7j2q1k5m8XB2OWN49ScmqG8MrBJKmf5PoSNC5C5FAkkAwsb2TgKK/hdjeyyAvCWjzCkG1wIiZUJgp84jNoain2sSIas3CgH4lL29Al0OynayWQbUZ53Kfeuyshp61YFxAS1uwMIfGBdSkhsoFWNrixuMYkF/0dT1IpZdhtZBAkkhnBKY96nHrHk7ZwamW8MoFwnYNPakwcRNcBxkmdoi/a4O4K7OwYwgAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/5a3ca8550d46e4c4861ad17c3181b593/a59e9/server-img.webp 192w,
/static/5a3ca8550d46e4c4861ad17c3181b593/0ca9f/server-img.webp 384w,
/static/5a3ca8550d46e4c4861ad17c3181b593/dc9b9/server-img.webp 768w,
/static/5a3ca8550d46e4c4861ad17c3181b593/e2393/server-img.webp 1090w"
              sizes="(max-width: 768px) 100vw, 768px"
              type="image/webp"
            />
          <source
            srcset="/static/5a3ca8550d46e4c4861ad17c3181b593/3b721/server-img.png 192w,
/static/5a3ca8550d46e4c4861ad17c3181b593/66595/server-img.png 384w,
/static/5a3ca8550d46e4c4861ad17c3181b593/fe486/server-img.png 768w,
/static/5a3ca8550d46e4c4861ad17c3181b593/0c7a1/server-img.png 1090w"
            sizes="(max-width: 768px) 100vw, 768px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/5a3ca8550d46e4c4861ad17c3181b593/fe486/server-img.png"
            alt="Dynamic"
            title="Dynamic"
            loading="lazy"
            decoding="async"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span>
    <figcaption class="gatsby-resp-image-figcaption">Dynamic</figcaption>
  </figure></p>
<blockquote>
<p>λ (Server) server-side renders at runtime (uses getInitialProps or getServerSideProps)</p>
</blockquote>
<p>λ으로 변경해주고 나니, 정상적으로 조회수가 업데이트 되었다.
물론 중간 과정에 useEffect로 작성했던 fetch코드는 react-query로 변경해준 상태였다.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@tanstack/react-query'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ViewProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'lib/google'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">getGoogleViews</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_ORIGIN</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/api/google/views</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Network response was not ok'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useGoogleViewsGetQuery</span> <span class="token operator">=</span> <span class="token punctuation">(</span>title<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">|</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> post <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'googleViews'</span><span class="token punctuation">,</span> title<span class="token punctuation">]</span><span class="token punctuation">,</span> getGoogleViews<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">select</span><span class="token operator">:</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> data<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span>post<span class="token operator">:</span> ViewProps<span class="token punctuation">)</span> <span class="token operator">=></span> post<span class="token punctuation">.</span>title <span class="token operator">===</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    post<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>위와 같이 변경을 해주니 google analytics의 조회수가 업데이트 될 때마다 refresh한 데이터를 가져온다.</p>
<p>그래서 시행착오를 다음과 같이 겪었다.</p>
<ol>
<li>server-components에서 client-components로 변경</li>
<li>useEffect → react-query로 변경 cache를 stale하게 만들면 되지 않을까 했다.</li>
<li>cronTab을 적용해서 일정 시간마다 re-deploy하려고 했다. (시도하진 않았다.)</li>
<li>결국 dynamic속성을 변경해주었다.</li>
</ol>
<br>
<p>그럼 여기서 의문이 드는게, 왜 처음 revalidate time은 적용되지 않았던 걸까?
내 생각엔, 이유는 api폴더에 있다.</p>
<div class="gatsby-highlight" data-language="ts"><pre class="language-ts"><code class="language-ts"><span class="token keyword">export</span> <span class="token keyword">const</span> dynamic <span class="token operator">=</span> <span class="token string">'force-static'</span><span class="token punctuation">;</span> <span class="token comment">// 이건 이해를 위해 추가해준 것.</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> dynamic <span class="token operator">=</span> <span class="token string">'force-dynamic'</span><span class="token punctuation">;</span> <span class="token comment">// 이렇게 변경해주어야한다.</span>


<span class="token keyword">const</span> analyticsDataClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BetaAnalyticsDataClient</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  credentials<span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ANALYTICS_CREDENTIALS</span> <span class="token operator">||</span> <span class="token string">'{}'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token constant">GET</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>response<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> analyticsDataClient<span class="token punctuation">.</span><span class="token function">runReport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    property<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">properties/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">ANALYTICS_PROPERTY_ID</span> <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    dateRanges<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        startDate<span class="token operator">:</span> <span class="token string">'2023-05-01'</span><span class="token punctuation">,</span>
        endDate<span class="token operator">:</span> <span class="token string">'today'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    dimensions<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'pageTitle'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    metrics<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        name<span class="token operator">:</span> <span class="token string">'screenPageViews'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> data <span class="token operator">=</span> response<span class="token punctuation">.</span>rows<span class="token operator">?.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>row<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      title<span class="token operator">:</span> row<span class="token punctuation">.</span>dimensionValues<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      views<span class="token operator">:</span> row<span class="token punctuation">.</span>metricValues<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NextResponse</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token number">200</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>이와 같이 사용하고 있는데, 이게 static으로 묶여버리니, 아무리 api를 요청하는 코드를 revalidate time을 걸거나, cache 타임을 조정하거나, 심지어 useEffect로 요청해봤자, api폴더 자체가 refetch 하지 않으면 소용이 없다.</p>
<br>
<p>지금 생각해보니 굳이굳이 api 폴더를 사용할 필요가 있었나 하는 생각도 든다. 그냥 Notion이나, Insta, Youtube처럼 해당 API로 바로 요청을 보내면 되었을 것 같은데, 왜 하필 api폴더를 만들었던 걸까 ㅠㅠ…</p>
<br>
<p>어찌됐건 결국 문제를 해결할 수 있었다. 블로그 내 다른 이슈들도 몇 가지 존재하고, docker내 에러들도 뜨는게 있는데, 차근차근 이슈를 줄여나가야겠다.</p>
<br>
<h3 id="번외" style="position:relative;"><a href="#%EB%B2%88%EC%99%B8" aria-label="번외 permalink" class="headerElement before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>번외</h3>
<p><a href="https://github.com/Geuni620/TIL/blob/main/BreadCrumbs/230725.md#server-component--client-component" target="_blank" rel="nofollow">TIL 내용 중 230725 기록</a></p>
<ul>
<li>이때 거의 다 힌트를 적어놓고서 왜 api 폴더가 static이라는 생각을 못했을까..ㅠㅠ</li>
</ul></div></div><style data-emotion="css ts6ysa">.css-ts6ysa{width:300px;position:-webkit-sticky;position:sticky;top:0;right:0;padding-top:130px;margin-left:5rem;overflow:auto;}@media (max-width: 1300px){.css-ts6ysa{display:none;}}</style><aside class="css-ts6ysa etse75s1"><style data-emotion="css 1fg89mx">.css-1fg89mx{position:-webkit-sticky;position:sticky;border-left:2px solid #ddd8d8;background-color:white;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;}.css-1fg89mx ul{color:gray;padding-left:1rem;list-style:none;line-height:24px;scale:1;}.css-1fg89mx ul .active{color:black;font-weight:700;}</style><div id="post-toc" class="css-1fg89mx etse75s0"><ul>
<li><a href="#revalidate-time%EC%9D%B4-%EC%A0%81%EC%9A%A9%EB%90%98%EC%A7%80-%EC%95%8A%EB%8A%94%EB%8B%A4">revalidate time이 적용되지 않는다.</a></li>
<li><a href="#nextjs%EC%9D%98-%EC%9E%90%EC%B2%B4-%EC%98%A4%EB%A5%98%EC%9D%B8%EA%B1%B8%EA%B9%8C">next.js의 자체 오류인걸까?</a></li>
<li><a href="#%EA%B7%B8%EB%9E%98%EB%8F%84-%ED%95%B4%EA%B2%B0%ED%95%B4%EC%95%BC%ED%95%9C%EB%8B%A4">그래도 해결해야한다.</a></li>
<li><a href="#%EB%B2%88%EC%99%B8">번외</a></li>
</ul></div></aside></div><div></div><style data-emotion="css 11u7q11">.css-11u7q11{display:grid;place-items:center;margin-top:auto;padding:70px 0;color:gray;font-size:15px;text-align:center;line-height:1.5;}@media (max-width: 768px){.css-11u7q11{font-size:12px;padding:50px 0;}}</style><footer class="css-11u7q11 e1oae0v80">© <!-- -->2025<!-- --> Geuni, Powered By Gatsby.</footer></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2023/8/11/trouble-shooting/";window.___webpackCompilationHash="f732bc29a34b2fd1854d";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c9fa82aa5b1f9c65f078.js"],"app":["/app-5f4028ff9c0e41abf41e.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-3d063b1ad72c7288ab1c.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-06fbe9ebade3fa4896dc.js"],"component---src-templates-post-template-tsx":["/component---src-templates-post-template-tsx-3f6da52bad5615a8b621.js"]};/*]]>*/</script><script src="/polyfill-c9fa82aa5b1f9c65f078.js" nomodule=""></script><script src="/app-5f4028ff9c0e41abf41e.js" async=""></script><script src="/framework-e3dc0f184baa7501f320.js" async=""></script><script src="/webpack-runtime-f3d05db4a414f4d46b70.js" async=""></script></body></html>